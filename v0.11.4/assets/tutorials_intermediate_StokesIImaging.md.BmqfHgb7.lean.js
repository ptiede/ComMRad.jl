import{_ as a,c as n,a5 as i,o as e}from"./chunks/framework.BmjlC9hS.js";const p="/Comrade.jl/v0.11.4/assets/StokesIImaging-45.Cy7a3yzM.png",l="/Comrade.jl/v0.11.4/assets/StokesIImaging-47.B3T65PgV.png",t="/Comrade.jl/v0.11.4/assets/StokesIImaging-49.DcLr0sJi.png",h="/Comrade.jl/v0.11.4/assets/StokesIImaging-52.urFOKEz_.png",k="/Comrade.jl/v0.11.4/assets/StokesIImaging-64.DyVuDchB.png",r="/Comrade.jl/v0.11.4/assets/StokesIImaging-66.BqTLNzK9.png",d="/Comrade.jl/v0.11.4/assets/StokesIImaging-68.e41cvXCU.png",C=JSON.parse('{"title":"Stokes I Simultaneous Image and Instrument Modeling","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/intermediate/StokesIImaging.md","filePath":"tutorials/intermediate/StokesIImaging.md","lastUpdated":null}'),o={name:"tutorials/intermediate/StokesIImaging.md"};function c(g,s,E,y,m,u){return e(),n("div",null,s[0]||(s[0]=[i(`<h1 id="Stokes-I-Simultaneous-Image-and-Instrument-Modeling" tabindex="-1">Stokes I Simultaneous Image and Instrument Modeling <a class="header-anchor" href="#Stokes-I-Simultaneous-Image-and-Instrument-Modeling" aria-label="Permalink to &quot;Stokes I Simultaneous Image and Instrument Modeling {#Stokes-I-Simultaneous-Image-and-Instrument-Modeling}&quot;">​</a></h1><p>In this tutorial, we will create a preliminary reconstruction of the 2017 M87 data on April 6 by simultaneously creating an image and model for the instrument. By instrument model, we mean something akin to self-calibration in traditional VLBI imaging terminology. However, unlike traditional self-cal, we will solve for the gains each time we update the image self-consistently. This allows us to model the correlations between gains and the image.</p><p>To get started we load Comrade.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pyehtim</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LinearAlgebra</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/PythonCall/Nr75f/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/Pyehtim/Za8ac/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Resolving changes</span></span>
<span class="line"><span>             + ehtim (pip)</span></span>
<span class="line"><span>             + libstdcxx-ng</span></span>
<span class="line"><span>             + numpy</span></span>
<span class="line"><span>             + numpy (pip)</span></span>
<span class="line"><span>             + openssl</span></span>
<span class="line"><span>             + pandas</span></span>
<span class="line"><span>             + pynfft</span></span>
<span class="line"><span>             + python</span></span>
<span class="line"><span>             + setuptools (pip)</span></span>
<span class="line"><span>             + uv</span></span>
<span class="line"><span>    CondaPkg Creating environment</span></span>
<span class="line"><span>             │ /home/runner/.julia/artifacts/7973f2c7725e2d0eef7a95159454c4145f0945a2/bin/micromamba</span></span>
<span class="line"><span>             │ -r /home/runner/.julia/scratchspaces/0b3b1443-0f03-428d-bdfb-f27f9c1191ea/root</span></span>
<span class="line"><span>             │ create</span></span>
<span class="line"><span>             │ -y</span></span>
<span class="line"><span>             │ -p /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/StokesIImaging/.CondaPkg/env</span></span>
<span class="line"><span>             │ --override-channels</span></span>
<span class="line"><span>             │ --no-channel-priority</span></span>
<span class="line"><span>             │ libstdcxx-ng[version=&#39;&gt;=3.4,&lt;13.0&#39;]</span></span>
<span class="line"><span>             │ numpy[version=&#39;&gt;=1.24, &lt;2.0&#39;]</span></span>
<span class="line"><span>             │ openssl[version=&#39;&gt;=3, &lt;3.1&#39;]</span></span>
<span class="line"><span>             │ pandas[version=&#39;&lt;2&#39;]</span></span>
<span class="line"><span>             │ pynfft[version=&#39;&gt;1.0&#39;]</span></span>
<span class="line"><span>             │ python[version=&#39;&gt;=3.8,&lt;4&#39;,channel=&#39;conda-forge&#39;,build=&#39;*cpython*&#39;]</span></span>
<span class="line"><span>             │ python[version=&#39;&gt;=3.6,&lt;=3.10&#39;]</span></span>
<span class="line"><span>             │ uv[version=&#39;&gt;=0.4&#39;]</span></span>
<span class="line"><span>             └ -c conda-forge</span></span>
<span class="line"><span>conda-forge/linux-64                                        Using cache</span></span>
<span class="line"><span>conda-forge/noarch                                          Using cache</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Transaction</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Prefix: /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/StokesIImaging/.CondaPkg/env</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Updating specs:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   - libstdcxx-ng[version=&#39;&gt;=3.4,&lt;13.0&#39;]</span></span>
<span class="line"><span>   - numpy[version=&#39;&gt;=1.24, &lt;2.0&#39;]</span></span>
<span class="line"><span>   - openssl[version=&#39;&gt;=3, &lt;3.1&#39;]</span></span>
<span class="line"><span>   - pandas[version=&#39;&lt;2&#39;]</span></span>
<span class="line"><span>   - pynfft[version=&#39;&gt;1.0&#39;]</span></span>
<span class="line"><span>   - conda-forge::python[version=&#39;&gt;=3.8,&lt;4&#39;,build=*cpython*]</span></span>
<span class="line"><span>   - python[version=&#39;&gt;=3.6,&lt;=3.10&#39;]</span></span>
<span class="line"><span>   - uv[version=&#39;&gt;=0.4&#39;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Package                 Version  Build                Channel           Size</span></span>
<span class="line"><span>────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span>  Install:</span></span>
<span class="line"><span>────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  + libstdcxx-ng           12.3.0  hc0a3c3a_7           conda-forge     Cached</span></span>
<span class="line"><span>  + _libgcc_mutex             0.1  conda_forge          conda-forge     Cached</span></span>
<span class="line"><span>  + python_abi               3.10  5_cp310              conda-forge     Cached</span></span>
<span class="line"><span>  + ca-certificates    2024.12.14  hbcca054_0           conda-forge     Cached</span></span>
<span class="line"><span>  + ld_impl_linux-64         2.43  h712a8e2_2           conda-forge     Cached</span></span>
<span class="line"><span>  + libgomp                14.2.0  h77fa898_1           conda-forge     Cached</span></span>
<span class="line"><span>  + _openmp_mutex             4.5  2_gnu                conda-forge     Cached</span></span>
<span class="line"><span>  + libgcc                 14.2.0  h77fa898_1           conda-forge     Cached</span></span>
<span class="line"><span>  + liblzma                 5.6.3  hb9d3cd8_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libzlib                 1.3.1  hb9d3cd8_2           conda-forge     Cached</span></span>
<span class="line"><span>  + libgfortran5           14.2.0  hd5240d6_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libstdcxx              14.2.0  hc0a3c3a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libgcc-ng              14.2.0  h69a702a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + xz-tools                5.6.3  hb9d3cd8_1           conda-forge     Cached</span></span>
<span class="line"><span>  + xz-gpl-tools            5.6.3  hbcc6ac9_1           conda-forge     Cached</span></span>
<span class="line"><span>  + liblzma-devel           5.6.3  hb9d3cd8_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libsqlite              3.47.2  hee588c1_0           conda-forge     Cached</span></span>
<span class="line"><span>  + libgfortran            14.2.0  h69a702a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + uv                     0.5.11  h0f3a69f_0           conda-forge     Cached</span></span>
<span class="line"><span>  + tk                     8.6.13  noxft_h4845f30_101   conda-forge     Cached</span></span>
<span class="line"><span>  + ncurses                   6.5  he02047a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libuuid                2.38.1  h0b41bf4_0           conda-forge     Cached</span></span>
<span class="line"><span>  + libnsl                  2.0.1  hd590300_0           conda-forge     Cached</span></span>
<span class="line"><span>  + libffi                  3.4.2  h7f98852_5           conda-forge     Cached</span></span>
<span class="line"><span>  + bzip2                   1.0.8  h4bc722e_7           conda-forge     Cached</span></span>
<span class="line"><span>  + openssl                3.0.14  h4ab18f5_0           conda-forge     Cached</span></span>
<span class="line"><span>  + xz                      5.6.3  hbcc6ac9_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libgfortran-ng         14.2.0  h69a702a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libopenblas            0.3.28  pthreads_h94d23a6_1  conda-forge     Cached</span></span>
<span class="line"><span>  + readline                  8.2  h8228510_1           conda-forge     Cached</span></span>
<span class="line"><span>  + fftw                   3.3.10  nompi_hf1063bd_110   conda-forge     Cached</span></span>
<span class="line"><span>  + libblas                 3.9.0  26_linux64_openblas  conda-forge     Cached</span></span>
<span class="line"><span>  + sqlite                 3.47.2  h9eae976_0           conda-forge     Cached</span></span>
<span class="line"><span>  + nfft                    3.2.4  hf8c457e_1000        conda-forge     Cached</span></span>
<span class="line"><span>  + libcblas                3.9.0  26_linux64_openblas  conda-forge     Cached</span></span>
<span class="line"><span>  + liblapack               3.9.0  26_linux64_openblas  conda-forge     Cached</span></span>
<span class="line"><span>  + tzdata                  2024b  hc8b5060_0           conda-forge     Cached</span></span>
<span class="line"><span>  + python                 3.10.0  h543edf9_3_cpython   conda-forge     Cached</span></span>
<span class="line"><span>  + wheel                  0.45.1  pyhd8ed1ab_1         conda-forge     Cached</span></span>
<span class="line"><span>  + setuptools             75.6.0  pyhff2d567_1         conda-forge     Cached</span></span>
<span class="line"><span>  + pip                    24.3.1  pyh8b19718_2         conda-forge     Cached</span></span>
<span class="line"><span>  + six                    1.17.0  pyhd8ed1ab_0         conda-forge     Cached</span></span>
<span class="line"><span>  + pytz                   2024.2  pyhd8ed1ab_1         conda-forge     Cached</span></span>
<span class="line"><span>  + python-dateutil   2.9.0.post0  pyhff2d567_1         conda-forge     Cached</span></span>
<span class="line"><span>  + numpy                  1.26.4  py310hb13e2d6_0      conda-forge     Cached</span></span>
<span class="line"><span>  + pynfft                  1.3.2  py310hde88566_1006   conda-forge     Cached</span></span>
<span class="line"><span>  + pandas                  1.5.3  py310h9b08913_1      conda-forge     Cached</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Summary:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Install: 47 packages</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Total download: 0 B</span></span>
<span class="line"><span></span></span>
<span class="line"><span>────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Transaction starting</span></span>
<span class="line"><span>Linking libstdcxx-ng-12.3.0-hc0a3c3a_7</span></span>
<span class="line"><span>Linking _libgcc_mutex-0.1-conda_forge</span></span>
<span class="line"><span>Linking python_abi-3.10-5_cp310</span></span>
<span class="line"><span>Linking ca-certificates-2024.12.14-hbcca054_0</span></span>
<span class="line"><span>Linking ld_impl_linux-64-2.43-h712a8e2_2</span></span>
<span class="line"><span>Linking libgomp-14.2.0-h77fa898_1</span></span>
<span class="line"><span>Linking _openmp_mutex-4.5-2_gnu</span></span>
<span class="line"><span>Linking libgcc-14.2.0-h77fa898_1</span></span>
<span class="line"><span>Linking liblzma-5.6.3-hb9d3cd8_1</span></span>
<span class="line"><span>Linking libzlib-1.3.1-hb9d3cd8_2</span></span>
<span class="line"><span>Linking libgfortran5-14.2.0-hd5240d6_1</span></span>
<span class="line"><span>Linking libstdcxx-14.2.0-hc0a3c3a_1</span></span>
<span class="line"><span>warning  libmamba [libstdcxx-14.2.0-hc0a3c3a_1] The following files were already present in the environment:</span></span>
<span class="line"><span>    - lib/libstdc++.so</span></span>
<span class="line"><span>    - lib/libstdc++.so.6</span></span>
<span class="line"><span>    - share/licenses/libstdc++/RUNTIME.LIBRARY.EXCEPTION</span></span>
<span class="line"><span>Linking libgcc-ng-14.2.0-h69a702a_1</span></span>
<span class="line"><span>Linking xz-tools-5.6.3-hb9d3cd8_1</span></span>
<span class="line"><span>Linking xz-gpl-tools-5.6.3-hbcc6ac9_1</span></span>
<span class="line"><span>Linking liblzma-devel-5.6.3-hb9d3cd8_1</span></span>
<span class="line"><span>Linking libsqlite-3.47.2-hee588c1_0</span></span>
<span class="line"><span>Linking libgfortran-14.2.0-h69a702a_1</span></span>
<span class="line"><span>Linking uv-0.5.11-h0f3a69f_0</span></span>
<span class="line"><span>Linking tk-8.6.13-noxft_h4845f30_101</span></span>
<span class="line"><span>Linking ncurses-6.5-he02047a_1</span></span>
<span class="line"><span>Linking libuuid-2.38.1-h0b41bf4_0</span></span>
<span class="line"><span>Linking libnsl-2.0.1-hd590300_0</span></span>
<span class="line"><span>Linking libffi-3.4.2-h7f98852_5</span></span>
<span class="line"><span>Linking bzip2-1.0.8-h4bc722e_7</span></span>
<span class="line"><span>Linking openssl-3.0.14-h4ab18f5_0</span></span>
<span class="line"><span>Linking xz-5.6.3-hbcc6ac9_1</span></span>
<span class="line"><span>Linking libgfortran-ng-14.2.0-h69a702a_1</span></span>
<span class="line"><span>Linking libopenblas-0.3.28-pthreads_h94d23a6_1</span></span>
<span class="line"><span>Linking readline-8.2-h8228510_1</span></span>
<span class="line"><span>Linking fftw-3.3.10-nompi_hf1063bd_110</span></span>
<span class="line"><span>Linking libblas-3.9.0-26_linux64_openblas</span></span>
<span class="line"><span>Linking sqlite-3.47.2-h9eae976_0</span></span>
<span class="line"><span>Linking nfft-3.2.4-hf8c457e_1000</span></span>
<span class="line"><span>Linking libcblas-3.9.0-26_linux64_openblas</span></span>
<span class="line"><span>Linking liblapack-3.9.0-26_linux64_openblas</span></span>
<span class="line"><span>Linking tzdata-2024b-hc8b5060_0</span></span>
<span class="line"><span>Linking python-3.10.0-h543edf9_3_cpython</span></span>
<span class="line"><span>Linking wheel-0.45.1-pyhd8ed1ab_1</span></span>
<span class="line"><span>Linking setuptools-75.6.0-pyhff2d567_1</span></span>
<span class="line"><span>Linking pip-24.3.1-pyh8b19718_2</span></span>
<span class="line"><span>Linking six-1.17.0-pyhd8ed1ab_0</span></span>
<span class="line"><span>Linking pytz-2024.2-pyhd8ed1ab_1</span></span>
<span class="line"><span>Linking python-dateutil-2.9.0.post0-pyhff2d567_1</span></span>
<span class="line"><span>Linking numpy-1.26.4-py310hb13e2d6_0</span></span>
<span class="line"><span>Linking pynfft-1.3.2-py310hde88566_1006</span></span>
<span class="line"><span>Linking pandas-1.5.3-py310h9b08913_1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Transaction finished</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To activate this environment, use:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    micromamba activate /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/StokesIImaging/.CondaPkg/env</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Or to execute a single command in this environment, use:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    micromamba run -p /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/StokesIImaging/.CondaPkg/env mycommand</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    CondaPkg Installing Pip packages</span></span>
<span class="line"><span>             │ /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/StokesIImaging/.CondaPkg/env/bin/uv</span></span>
<span class="line"><span>             │ pip</span></span>
<span class="line"><span>             │ install</span></span>
<span class="line"><span>             │ ehtim &gt;=1.2.9, &lt;2.0</span></span>
<span class="line"><span>             │ numpy &gt;=1.24, &lt;2.0</span></span>
<span class="line"><span>             └ setuptools</span></span>
<span class="line"><span>Using Python 3.10.0 environment at: /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/StokesIImaging/.CondaPkg/env</span></span>
<span class="line"><span>Resolved 36 packages in 107ms</span></span>
<span class="line"><span>Installed 30 packages in 76ms</span></span>
<span class="line"><span> + astropy==6.1.7</span></span>
<span class="line"><span> + astropy-iers-data==0.2024.12.23.0.33.24</span></span>
<span class="line"><span> + certifi==2024.12.14</span></span>
<span class="line"><span> + charset-normalizer==3.4.0</span></span>
<span class="line"><span> + contourpy==1.3.1</span></span>
<span class="line"><span> + cycler==0.12.1</span></span>
<span class="line"><span> + ehtim==1.2.9</span></span>
<span class="line"><span> + fonttools==4.55.3</span></span>
<span class="line"><span> + future==1.0.0</span></span>
<span class="line"><span> + h5py==3.12.1</span></span>
<span class="line"><span> + hdrhistogram==0.10.3</span></span>
<span class="line"><span> + idna==3.10</span></span>
<span class="line"><span> + jplephem==2.22</span></span>
<span class="line"><span> + kiwisolver==1.4.7</span></span>
<span class="line"><span> + matplotlib==3.10.0</span></span>
<span class="line"><span> + networkx==3.4.2</span></span>
<span class="line"><span> + packaging==24.2</span></span>
<span class="line"><span> + pandas-appender==0.9.8.4</span></span>
<span class="line"><span> + paramsurvey==0.4.20</span></span>
<span class="line"><span> + pbr==6.1.0</span></span>
<span class="line"><span> + pillow==11.0.0</span></span>
<span class="line"><span> + psutil==6.1.1</span></span>
<span class="line"><span> + pyerfa==2.0.1.5</span></span>
<span class="line"><span> + pyparsing==3.2.0</span></span>
<span class="line"><span> + pyyaml==6.0.2</span></span>
<span class="line"><span> + requests==2.32.3</span></span>
<span class="line"><span> + scipy==1.13.1</span></span>
<span class="line"><span> + sgp4==2.23</span></span>
<span class="line"><span> + skyfield==1.49</span></span>
<span class="line"><span> + urllib3==2.3.0</span></span></code></pre></div><p>For reproducibility we use a stable random number genreator</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StableRNGs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rng </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StableRNG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>StableRNGs.LehmerRNG(state=0x00000000000000000000000000000019)</span></span></code></pre></div><h2 id="Load-the-Data" tabindex="-1">Load the Data <a class="header-anchor" href="#Load-the-Data" aria-label="Permalink to &quot;Load the Data {#Load-the-Data}&quot;">​</a></h2><p>To download the data visit <a href="https://doi.org/10.25739/g85n-f134" target="_blank" rel="noreferrer">https://doi.org/10.25739/g85n-f134</a> First we will load our data:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ehtim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obsdata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_uvfits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">joinpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__DIR, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SR1_M87_2017_096_lo_hops_netcal_StokesI.uvfits&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Python: &lt;ehtim.obsdata.Obsdata object at 0x7f9430561270&gt;</span></span></code></pre></div><p>obs = ehtim.obsdata.load_uvfits(&quot;~/Dropbox (Smithsonian External)/M872021Project/Data/2021/CASA/e21e18/V4/M87_calibrated_b3.uvf+EVPA_rotation+netcal_10savg+flag.uvfits&quot;) Now we do some minor preprocessing:</p><ul><li><p>Scan average the data since the data have been preprocessed so that the gain phases coherent.</p></li><li><p>Add 1% systematic noise to deal with calibration issues that cause 1% non-closing errors.</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scan_average</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obs)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_fractional_noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.02</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Python: &lt;ehtim.obsdata.Obsdata object at 0x7f945512ce50&gt;</span></span></code></pre></div><p>Now we extract our complex visibilities.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dvis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extract_table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obs, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Visibilities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>EHTObservationTable{Comrade.EHTVisibilityDatum{:I}}</span></span>
<span class="line"><span>  source:      M87</span></span>
<span class="line"><span>  mjd:         57849</span></span>
<span class="line"><span>  bandwidth:   1.856e9</span></span>
<span class="line"><span>  sites:       [:AA, :AP, :AZ, :JC, :LM, :PV, :SM]</span></span>
<span class="line"><span>  nsamples:    274</span></span></code></pre></div><p>##Building the Model/Posterior</p><p>Now, we must build our intensity/visibility model. That is, the model that takes in a named tuple of parameters and perhaps some metadata required to construct the model. For our model, we will use a raster or <code>ContinuousImage</code> for our image model. The model is given below:</p><p>The model construction is very similar to <a href="/Comrade.jl/v0.11.4/tutorials/intermediate/ClosureImaging#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>, except we include a large scale gaussian since we want to model the zero baselines. For more information about the image model please read the closure-only example.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sky</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(θ, metadata)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (;fg, c, σimg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> θ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (;ftot, mimg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Apply the GMRF fluctuations to the image</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rast </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apply_fluctuations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CenteredLR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), mimg, σimg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">params)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> parent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rast)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ftot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fg))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pimg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ContinuousImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rast, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BSplinePulse{3}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x0, y0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> centroid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Add a large-scale gaussian to deal with the over-resolved mas flux</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Gaussian</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stretch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Renormalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ftot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fg))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> shifted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x0, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y0) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> g</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sky (generic function with 1 method)</span></span></code></pre></div><p>Now, let&#39;s set up our image model. The EHT&#39;s nominal resolution is 20-25 μas. Additionally, the EHT is not very sensitive to a larger field of view. Typically 60-80 μas is enough to describe the compact flux of M87. Given this, we only need to use a small number of pixels to describe our image.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">npix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fovx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fovy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>9.69627362219072e-10</span></span></code></pre></div><p>Now let&#39;s form our cache&#39;s. First, we have our usual image cache which is needed to numerically compute the visibilities.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">grid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imagepixels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fovx, fovy, npix, npix)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RectiGrid(</span></span>
<span class="line"><span>executor: ComradeBase.Serial()</span></span>
<span class="line"><span>Dimensions: </span></span>
<span class="line"><span>(↓ X Sampled{Float64} LinRange{Float64}(-4.69663253574863e-10, 4.69663253574863e-10, 32) ForwardOrdered Regular Points,</span></span>
<span class="line"><span>→ Y Sampled{Float64} LinRange{Float64}(-4.69663253574863e-10, 4.69663253574863e-10, 32) ForwardOrdered Regular Points)</span></span>
<span class="line"><span>)</span></span></code></pre></div><p>Now we need to specify our image prior. For this work we will use a Gaussian Markov Random field prior Since we are using a Gaussian Markov random field prior we need to first specify our <code>mean</code> image. This behaves somewhat similary to a entropy regularizer in that it will start with an initial guess for the image structure. For this tutorial we will use a a symmetric Gaussian with a FWHM of 50 μas</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VLBIImagePriors</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Distributions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fwhmfac </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mpr  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Gaussian</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stretch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fwhmfac))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mpr, grid)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌ 32×32 IntensityMap{Float64, 2} ┐</span></span>
<span class="line"><span>├────────────────────────────────┴─────────────────────────────────────── dims ┐</span></span>
<span class="line"><span>  ↓ X Sampled{Float64} LinRange{Float64}(-4.69663253574863e-10, 4.69663253574863e-10, 32) ForwardOrdered Regular Points,</span></span>
<span class="line"><span>  → Y Sampled{Float64} LinRange{Float64}(-4.69663253574863e-10, 4.69663253574863e-10, 32) ForwardOrdered Regular Points</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────── metadata ┤</span></span>
<span class="line"><span>  ComradeBase.NoHeader()</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>  ↓ →          -4.69663e-10  -4.39362e-10  -4.09062e-10  -3.78761e-10  -3.4846e-10  -3.18159e-10  -2.87858e-10  -2.57557e-10  -2.27256e-10  -1.96956e-10  -1.66655e-10  -1.36354e-10  -1.06053e-10  -7.57521e-11  -4.54513e-11  -1.51504e-11  1.51504e-11  4.54513e-11  7.57521e-11  1.06053e-10  1.36354e-10  1.66655e-10  1.96956e-10  2.27256e-10  2.57557e-10  2.87858e-10  3.18159e-10  3.4846e-10  3.78761e-10  4.09062e-10  4.39362e-10  4.69663e-10</span></span>
<span class="line"><span> -4.69663e-10   1.25675e-11   4.60978e-11   1.55054e-10   4.78251e-10   1.3527e-9    3.50847e-9    8.34459e-9    1.81997e-8    3.63993e-8    6.67567e-8    1.12271e-7    1.73145e-7    2.44865e-7    3.1755e-7     3.77633e-7    4.11812e-7   4.11812e-7   3.77633e-7   3.1755e-7    2.44865e-7   1.73145e-7   1.12271e-7   6.67567e-8   3.63993e-8   1.81997e-8   8.34459e-9   3.50847e-9   1.3527e-9   4.78251e-10  1.55054e-10  4.60978e-11  1.25675e-11</span></span>
<span class="line"><span> -4.39362e-10   4.60978e-11   1.69087e-10   5.6874e-10    1.75423e-9    4.96172e-9   1.28691e-8    3.06081e-8    6.67567e-8    1.33513e-7    2.44865e-7    4.11812e-7    6.351e-7      8.98167e-7    1.16478e-6    1.38516e-6    1.51053e-6   1.51053e-6   1.38516e-6   1.16478e-6   8.98167e-7   6.351e-7     4.11812e-7   2.44865e-7   1.33513e-7   6.67567e-8   3.06081e-8   1.28691e-8   4.96172e-9  1.75423e-9   5.6874e-10   1.69087e-10  4.60978e-11</span></span>
<span class="line"><span> -4.09062e-10   1.55054e-10   5.6874e-10    1.913e-9      5.90051e-9    1.66892e-8   4.32864e-8    1.02953e-7    2.24542e-7    4.49084e-7    8.23623e-7    1.38516e-6    2.13621e-6    3.02106e-6    3.91783e-6    4.65912e-6    5.0808e-6    5.0808e-6    4.65912e-6   3.91783e-6   3.02106e-6   2.13621e-6   1.38516e-6   8.23623e-7   4.49084e-7   2.24542e-7   1.02953e-7   4.32864e-8   1.66892e-8  5.90051e-9   1.913e-9     5.6874e-10   1.55054e-10</span></span>
<span class="line"><span> -3.78761e-10   4.78251e-10   1.75423e-9    5.90051e-9    1.81997e-8    5.14764e-8   1.33513e-7    3.1755e-7     6.92582e-7    1.38516e-6    2.5404e-6     4.27243e-6    6.58898e-6    9.31823e-6    1.20843e-5    1.43707e-5    1.56713e-5   1.56713e-5   1.43707e-5   1.20843e-5   9.31823e-6   6.58898e-6   4.27243e-6   2.5404e-6    1.38516e-6   6.92582e-7   3.1755e-7    1.33513e-7   5.14764e-8  1.81997e-8   5.90051e-9   1.75423e-9   4.78251e-10</span></span>
<span class="line"><span> -3.4846e-10    1.3527e-9     4.96172e-9    1.66892e-8    5.14764e-8    1.45597e-7   3.77633e-7    8.98167e-7    1.95892e-6    3.91783e-6    7.18534e-6    1.20843e-5    1.86365e-5    2.63559e-5    3.41794e-5    4.06464e-5    4.43252e-5   4.43252e-5   4.06464e-5   3.41794e-5   2.63559e-5   1.86365e-5   1.20843e-5   7.18534e-6   3.91783e-6   1.95892e-6   8.98167e-7   3.77633e-7   1.45597e-7  5.14764e-8   1.66892e-8   4.96172e-9   1.3527e-9</span></span>
<span class="line"><span> -3.18159e-10   3.50847e-9    1.28691e-8    4.32864e-8    1.33513e-7    3.77633e-7   9.79458e-7    2.32956e-6    5.0808e-6     1.01616e-5    1.86365e-5    3.13427e-5    4.8337e-5     6.83588e-5    8.86505e-5    0.000105424   0.000114965  0.000114965  0.000105424  8.86505e-5   6.83588e-5   4.8337e-5    3.13427e-5   1.86365e-5   1.01616e-5   5.0808e-6    2.32956e-6   9.79458e-7   3.77633e-7  1.33513e-7   4.32864e-8   1.28691e-8   3.50847e-9</span></span>
<span class="line"><span> -2.87858e-10   8.34459e-9    3.06081e-8    1.02953e-7    3.1755e-7     8.98167e-7   2.32956e-6    5.54065e-6    1.20843e-5    2.41685e-5    4.43252e-5    7.45458e-5    0.000114965   0.000162586   0.000210847   0.000250741   0.000273435  0.000273435  0.000250741  0.000210847  0.000162586  0.000114965  7.45458e-5   4.43252e-5   2.41685e-5   1.20843e-5   5.54065e-6   2.32956e-6   8.98167e-7  3.1755e-7    1.02953e-7   3.06081e-8   8.34459e-9</span></span>
<span class="line"><span> -2.57557e-10   1.81997e-8    6.67567e-8    2.24542e-7    6.92582e-7    1.95892e-6   5.0808e-6     1.20843e-5    2.63559e-5    5.27119e-5    9.6674e-5     0.000162586   0.000250741   0.000354602   0.000459862   0.000546871   0.000596367  0.000596367  0.000546871  0.000459862  0.000354602  0.000250741  0.000162586  9.6674e-5    5.27119e-5   2.63559e-5   1.20843e-5   5.0808e-6    1.95892e-6  6.92582e-7   2.24542e-7   6.67567e-8   1.81997e-8</span></span>
<span class="line"><span> -2.27256e-10   3.63993e-8    1.33513e-7    4.49084e-7    1.38516e-6    3.91783e-6   1.01616e-5    2.41685e-5    5.27119e-5    0.000105424   0.000193348   0.000325171   0.000501483   0.000709204   0.000919723   0.00109374    0.00119273   0.00119273   0.00109374   0.000919723  0.000709204  0.000501483  0.000325171  0.000193348  0.000105424  5.27119e-5   2.41685e-5   1.01616e-5   3.91783e-6  1.38516e-6   4.49084e-7   1.33513e-7   3.63993e-8</span></span>
<span class="line"><span> -1.96956e-10   6.67567e-8    2.44865e-7    8.23623e-7    2.5404e-6     7.18534e-6   1.86365e-5    4.43252e-5    9.6674e-5     0.000193348   0.000354602   0.000596367   0.000919723   0.00130069    0.00168678    0.00200593    0.00218748   0.00218748   0.00200593   0.00168678   0.00130069   0.000919723  0.000596367  0.000354602  0.000193348  9.6674e-5    4.43252e-5   1.86365e-5   7.18534e-6  2.5404e-6    8.23623e-7   2.44865e-7   6.67567e-8</span></span>
<span class="line"><span> -1.66655e-10   1.12271e-7    4.11812e-7    1.38516e-6    4.27243e-6    1.20843e-5   3.13427e-5    7.45458e-5    0.000162586   0.000325171   0.000596367   0.00100297    0.00154678    0.00218748    0.00283681    0.00337356    0.00367889   0.00367889   0.00337356   0.00283681   0.00218748   0.00154678   0.00100297   0.000596367  0.000325171  0.000162586  7.45458e-5   3.13427e-5   1.20843e-5  4.27243e-6   1.38516e-6   4.11812e-7   1.12271e-7</span></span>
<span class="line"><span> -1.36354e-10   1.73145e-7    6.351e-7      2.13621e-6    6.58898e-6    1.86365e-5   4.8337e-5     0.000114965   0.000250741   0.000501483   0.000919723   0.00154678    0.00238547    0.00337356    0.00437497    0.00520274    0.00567363   0.00567363   0.00520274   0.00437497   0.00337356   0.00238547   0.00154678   0.000919723  0.000501483  0.000250741  0.000114965  4.8337e-5    1.86365e-5  6.58898e-6   2.13621e-6   6.351e-7     1.73145e-7</span></span>
<span class="line"><span> -1.06053e-10   2.44865e-7    8.98167e-7    3.02106e-6    9.31823e-6    2.63559e-5   6.83588e-5    0.000162586   0.000354602   0.000709204   0.00130069    0.00218748    0.00337356    0.00477093    0.00618714    0.00735779    0.00802372   0.00802372   0.00735779   0.00618714   0.00477093   0.00337356   0.00218748   0.00130069   0.000709204  0.000354602  0.000162586  6.83588e-5   2.63559e-5  9.31823e-6   3.02106e-6   8.98167e-7   2.44865e-7</span></span>
<span class="line"><span> -7.57521e-11   3.1755e-7     1.16478e-6    3.91783e-6    1.20843e-5    3.41794e-5   8.86505e-5    0.000210847   0.000459862   0.000919723   0.00168678    0.00283681    0.00437497    0.00618714    0.00802372    0.00954187    0.0104055    0.0104055    0.00954187   0.00802372   0.00618714   0.00437497   0.00283681   0.00168678   0.000919723  0.000459862  0.000210847  8.86505e-5   3.41794e-5  1.20843e-5   3.91783e-6   1.16478e-6   3.1755e-7</span></span>
<span class="line"><span> -4.54513e-11   3.77633e-7    1.38516e-6    4.65912e-6    1.43707e-5    4.06464e-5   0.000105424   0.000250741   0.000546871   0.00109374    0.00200593    0.00337356    0.00520274    0.00735779    0.00954187    0.0113473     0.0123743    0.0123743    0.0113473    0.00954187   0.00735779   0.00520274   0.00337356   0.00200593   0.00109374   0.000546871  0.000250741  0.000105424  4.06464e-5  1.43707e-5   4.65912e-6   1.38516e-6   3.77633e-7</span></span>
<span class="line"><span> -1.51504e-11   4.11812e-7    1.51053e-6    5.0808e-6     1.56713e-5    4.43252e-5   0.000114965   0.000273435   0.000596367   0.00119273    0.00218748    0.00367889    0.00567363    0.00802372    0.0104055     0.0123743     0.0134942    0.0134942    0.0123743    0.0104055    0.00802372   0.00567363   0.00367889   0.00218748   0.00119273   0.000596367  0.000273435  0.000114965  4.43252e-5  1.56713e-5   5.0808e-6    1.51053e-6   4.11812e-7</span></span>
<span class="line"><span>  1.51504e-11   4.11812e-7    1.51053e-6    5.0808e-6     1.56713e-5    4.43252e-5   0.000114965   0.000273435   0.000596367   0.00119273    0.00218748    0.00367889    0.00567363    0.00802372    0.0104055     0.0123743     0.0134942    0.0134942    0.0123743    0.0104055    0.00802372   0.00567363   0.00367889   0.00218748   0.00119273   0.000596367  0.000273435  0.000114965  4.43252e-5  1.56713e-5   5.0808e-6    1.51053e-6   4.11812e-7</span></span>
<span class="line"><span>  4.54513e-11   3.77633e-7    1.38516e-6    4.65912e-6    1.43707e-5    4.06464e-5   0.000105424   0.000250741   0.000546871   0.00109374    0.00200593    0.00337356    0.00520274    0.00735779    0.00954187    0.0113473     0.0123743    0.0123743    0.0113473    0.00954187   0.00735779   0.00520274   0.00337356   0.00200593   0.00109374   0.000546871  0.000250741  0.000105424  4.06464e-5  1.43707e-5   4.65912e-6   1.38516e-6   3.77633e-7</span></span>
<span class="line"><span>  7.57521e-11   3.1755e-7     1.16478e-6    3.91783e-6    1.20843e-5    3.41794e-5   8.86505e-5    0.000210847   0.000459862   0.000919723   0.00168678    0.00283681    0.00437497    0.00618714    0.00802372    0.00954187    0.0104055    0.0104055    0.00954187   0.00802372   0.00618714   0.00437497   0.00283681   0.00168678   0.000919723  0.000459862  0.000210847  8.86505e-5   3.41794e-5  1.20843e-5   3.91783e-6   1.16478e-6   3.1755e-7</span></span>
<span class="line"><span>  1.06053e-10   2.44865e-7    8.98167e-7    3.02106e-6    9.31823e-6    2.63559e-5   6.83588e-5    0.000162586   0.000354602   0.000709204   0.00130069    0.00218748    0.00337356    0.00477093    0.00618714    0.00735779    0.00802372   0.00802372   0.00735779   0.00618714   0.00477093   0.00337356   0.00218748   0.00130069   0.000709204  0.000354602  0.000162586  6.83588e-5   2.63559e-5  9.31823e-6   3.02106e-6   8.98167e-7   2.44865e-7</span></span>
<span class="line"><span>  1.36354e-10   1.73145e-7    6.351e-7      2.13621e-6    6.58898e-6    1.86365e-5   4.8337e-5     0.000114965   0.000250741   0.000501483   0.000919723   0.00154678    0.00238547    0.00337356    0.00437497    0.00520274    0.00567363   0.00567363   0.00520274   0.00437497   0.00337356   0.00238547   0.00154678   0.000919723  0.000501483  0.000250741  0.000114965  4.8337e-5    1.86365e-5  6.58898e-6   2.13621e-6   6.351e-7     1.73145e-7</span></span>
<span class="line"><span>  1.66655e-10   1.12271e-7    4.11812e-7    1.38516e-6    4.27243e-6    1.20843e-5   3.13427e-5    7.45458e-5    0.000162586   0.000325171   0.000596367   0.00100297    0.00154678    0.00218748    0.00283681    0.00337356    0.00367889   0.00367889   0.00337356   0.00283681   0.00218748   0.00154678   0.00100297   0.000596367  0.000325171  0.000162586  7.45458e-5   3.13427e-5   1.20843e-5  4.27243e-6   1.38516e-6   4.11812e-7   1.12271e-7</span></span>
<span class="line"><span>  1.96956e-10   6.67567e-8    2.44865e-7    8.23623e-7    2.5404e-6     7.18534e-6   1.86365e-5    4.43252e-5    9.6674e-5     0.000193348   0.000354602   0.000596367   0.000919723   0.00130069    0.00168678    0.00200593    0.00218748   0.00218748   0.00200593   0.00168678   0.00130069   0.000919723  0.000596367  0.000354602  0.000193348  9.6674e-5    4.43252e-5   1.86365e-5   7.18534e-6  2.5404e-6    8.23623e-7   2.44865e-7   6.67567e-8</span></span>
<span class="line"><span>  2.27256e-10   3.63993e-8    1.33513e-7    4.49084e-7    1.38516e-6    3.91783e-6   1.01616e-5    2.41685e-5    5.27119e-5    0.000105424   0.000193348   0.000325171   0.000501483   0.000709204   0.000919723   0.00109374    0.00119273   0.00119273   0.00109374   0.000919723  0.000709204  0.000501483  0.000325171  0.000193348  0.000105424  5.27119e-5   2.41685e-5   1.01616e-5   3.91783e-6  1.38516e-6   4.49084e-7   1.33513e-7   3.63993e-8</span></span>
<span class="line"><span>  2.57557e-10   1.81997e-8    6.67567e-8    2.24542e-7    6.92582e-7    1.95892e-6   5.0808e-6     1.20843e-5    2.63559e-5    5.27119e-5    9.6674e-5     0.000162586   0.000250741   0.000354602   0.000459862   0.000546871   0.000596367  0.000596367  0.000546871  0.000459862  0.000354602  0.000250741  0.000162586  9.6674e-5    5.27119e-5   2.63559e-5   1.20843e-5   5.0808e-6    1.95892e-6  6.92582e-7   2.24542e-7   6.67567e-8   1.81997e-8</span></span>
<span class="line"><span>  2.87858e-10   8.34459e-9    3.06081e-8    1.02953e-7    3.1755e-7     8.98167e-7   2.32956e-6    5.54065e-6    1.20843e-5    2.41685e-5    4.43252e-5    7.45458e-5    0.000114965   0.000162586   0.000210847   0.000250741   0.000273435  0.000273435  0.000250741  0.000210847  0.000162586  0.000114965  7.45458e-5   4.43252e-5   2.41685e-5   1.20843e-5   5.54065e-6   2.32956e-6   8.98167e-7  3.1755e-7    1.02953e-7   3.06081e-8   8.34459e-9</span></span>
<span class="line"><span>  3.18159e-10   3.50847e-9    1.28691e-8    4.32864e-8    1.33513e-7    3.77633e-7   9.79458e-7    2.32956e-6    5.0808e-6     1.01616e-5    1.86365e-5    3.13427e-5    4.8337e-5     6.83588e-5    8.86505e-5    0.000105424   0.000114965  0.000114965  0.000105424  8.86505e-5   6.83588e-5   4.8337e-5    3.13427e-5   1.86365e-5   1.01616e-5   5.0808e-6    2.32956e-6   9.79458e-7   3.77633e-7  1.33513e-7   4.32864e-8   1.28691e-8   3.50847e-9</span></span>
<span class="line"><span>  3.4846e-10    1.3527e-9     4.96172e-9    1.66892e-8    5.14764e-8    1.45597e-7   3.77633e-7    8.98167e-7    1.95892e-6    3.91783e-6    7.18534e-6    1.20843e-5    1.86365e-5    2.63559e-5    3.41794e-5    4.06464e-5    4.43252e-5   4.43252e-5   4.06464e-5   3.41794e-5   2.63559e-5   1.86365e-5   1.20843e-5   7.18534e-6   3.91783e-6   1.95892e-6   8.98167e-7   3.77633e-7   1.45597e-7  5.14764e-8   1.66892e-8   4.96172e-9   1.3527e-9</span></span>
<span class="line"><span>  3.78761e-10   4.78251e-10   1.75423e-9    5.90051e-9    1.81997e-8    5.14764e-8   1.33513e-7    3.1755e-7     6.92582e-7    1.38516e-6    2.5404e-6     4.27243e-6    6.58898e-6    9.31823e-6    1.20843e-5    1.43707e-5    1.56713e-5   1.56713e-5   1.43707e-5   1.20843e-5   9.31823e-6   6.58898e-6   4.27243e-6   2.5404e-6    1.38516e-6   6.92582e-7   3.1755e-7    1.33513e-7   5.14764e-8  1.81997e-8   5.90051e-9   1.75423e-9   4.78251e-10</span></span>
<span class="line"><span>  4.09062e-10   1.55054e-10   5.6874e-10    1.913e-9      5.90051e-9    1.66892e-8   4.32864e-8    1.02953e-7    2.24542e-7    4.49084e-7    8.23623e-7    1.38516e-6    2.13621e-6    3.02106e-6    3.91783e-6    4.65912e-6    5.0808e-6    5.0808e-6    4.65912e-6   3.91783e-6   3.02106e-6   2.13621e-6   1.38516e-6   8.23623e-7   4.49084e-7   2.24542e-7   1.02953e-7   4.32864e-8   1.66892e-8  5.90051e-9   1.913e-9     5.6874e-10   1.55054e-10</span></span>
<span class="line"><span>  4.39362e-10   4.60978e-11   1.69087e-10   5.6874e-10    1.75423e-9    4.96172e-9   1.28691e-8    3.06081e-8    6.67567e-8    1.33513e-7    2.44865e-7    4.11812e-7    6.351e-7      8.98167e-7    1.16478e-6    1.38516e-6    1.51053e-6   1.51053e-6   1.38516e-6   1.16478e-6   8.98167e-7   6.351e-7     4.11812e-7   2.44865e-7   1.33513e-7   6.67567e-8   3.06081e-8   1.28691e-8   4.96172e-9  1.75423e-9   5.6874e-10   1.69087e-10  4.60978e-11</span></span>
<span class="line"><span>  4.69663e-10   1.25675e-11   4.60978e-11   1.55054e-10   4.78251e-10   1.3527e-9    3.50847e-9    8.34459e-9    1.81997e-8    3.63993e-8    6.67567e-8    1.12271e-7    1.73145e-7    2.44865e-7    3.1755e-7     3.77633e-7    4.11812e-7   4.11812e-7   3.77633e-7   3.1755e-7    2.44865e-7   1.73145e-7   1.12271e-7   6.67567e-8   3.63993e-8   1.81997e-8   8.34459e-9   3.50847e-9   1.3527e-9   4.78251e-10  1.55054e-10  4.60978e-11  1.25675e-11</span></span></code></pre></div><p>Now we can form our metadata we need to fully define our model. We will also fix the total flux to be the observed value 1.1. This is because total flux is degenerate with a global shift in the gain amplitudes making the problem degenerate. To fix this we use the observed total flux as our value.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skymeta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;ftot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mimg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">flux</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mimg))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(ftot = 1.1, mimg = [1.2567547416996487e-11 4.60979671782088e-11 1.5505446140255663e-10 4.782533378056425e-10 1.3527047131498763e-9 3.5084819555512232e-9 8.344623408800353e-9 1.8199752706952592e-8 3.639950541390525e-8 6.675698727040275e-8 1.1227142257763898e-7 1.7314620328318453e-7 2.448657089564883e-7 3.175515369524363e-7 3.7763454712388683e-7 4.1181339376014135e-7 4.1181339376014135e-7 3.7763454712388683e-7 3.175515369524363e-7 2.448657089564883e-7 1.7314620328318453e-7 1.1227142257763922e-7 6.675698727040275e-8 3.639950541390525e-8 1.8199752706952592e-8 8.344623408800353e-9 3.5084819555512232e-9 1.3527047131498763e-9 4.782533378056425e-10 1.5505446140255717e-10 4.60979671782088e-11 1.2567547416996487e-11; 4.60979671782088e-11 1.690880891437348e-10 5.687422720922681e-10 1.7542409777756147e-9 4.9617427648818055e-9 1.2869168555004412e-8 3.060821361956108e-8 6.675698727040275e-8 1.335139745408057e-7 2.448657089564883e-7 4.1181339376014066e-7 6.351030739048726e-7 8.981713806211123e-7 1.1647841732449665e-6 1.3851696262654769e-6 1.510538188495548e-6 1.510538188495548e-6 1.3851696262654769e-6 1.1647841732449665e-6 8.981713806211123e-7 6.351030739048726e-7 4.1181339376014135e-7 2.448657089564883e-7 1.335139745408057e-7 6.675698727040275e-8 3.060821361956108e-8 1.2869168555004412e-8 4.9617427648818055e-9 1.7542409777756147e-9 5.687422720922701e-10 1.690880891437348e-10 4.60979671782088e-11; 1.5505446140255663e-10 5.687422720922681e-10 1.913013351222567e-9 5.900539798810739e-9 1.6689246817600684e-8 4.328655082079613e-8 1.0295334844003551e-7 2.2454284515527802e-7 4.4908569031055694e-7 8.23626787520283e-7 1.3851696262654769e-6 2.136223592652892e-6 3.021076376991096e-6 3.917851343303821e-6 4.659136692979867e-6 5.0808245912389815e-6 5.0808245912389815e-6 4.659136692979867e-6 3.917851343303814e-6 3.021076376991096e-6 2.136223592652892e-6 1.3851696262654794e-6 8.236267875202814e-7 4.4908569031055694e-7 2.2454284515527802e-7 1.0295334844003551e-7 4.328655082079613e-8 1.6689246817600684e-8 5.900539798810739e-9 1.9130133512225742e-9 5.687422720922681e-10 1.5505446140255663e-10; 4.782533378056425e-10 1.7542409777756147e-9 5.900539798810739e-9 1.819975270695265e-8 5.1476674220017655e-8 1.3351397454080597e-7 3.175515369524369e-7 6.925848131327384e-7 1.3851696262654794e-6 2.5404122956194908e-6 4.272447185305786e-6 6.589014300162271e-6 9.318273385959749e-6 1.2084305507964394e-5 1.4370742089937826e-5 1.5671405373215287e-5 1.5671405373215287e-5 1.4370742089937826e-5 1.2084305507964394e-5 9.318273385959749e-6 6.589014300162271e-6 4.272447185305794e-6 2.5404122956194908e-6 1.3851696262654794e-6 6.925848131327384e-7 3.175515369524369e-7 1.3351397454080597e-7 5.1476674220017655e-8 1.819975270695265e-8 5.90053979881076e-9 1.7542409777756147e-9 4.782533378056425e-10; 1.3527047131498763e-9 4.9617427648818055e-9 1.6689246817600684e-8 5.1476674220017655e-8 1.455980216556205e-7 3.7763454712388614e-7 8.981713806211139e-7 1.9589256716519037e-6 3.917851343303814e-6 7.185371044968894e-6 1.2084305507964365e-5 1.8636546771919454e-5 2.6356057200649016e-5 3.41795774824462e-5 4.0646596729911805e-5 4.432542804049519e-5 4.432542804049519e-5 4.0646596729911805e-5 3.41795774824462e-5 2.6356057200649016e-5 1.8636546771919454e-5 1.2084305507964374e-5 7.185371044968885e-6 3.917851343303814e-6 1.9589256716519037e-6 8.981713806211139e-7 3.7763454712388614e-7 1.455980216556205e-7 5.1476674220017655e-8 1.6689246817600743e-8 4.9617427648818055e-9 1.3527047131498763e-9; 3.5084819555512232e-9 1.2869168555004412e-8 4.328655082079613e-8 1.3351397454080597e-7 3.7763454712388614e-7 9.79462835825955e-7 2.329568346489937e-6 5.0808245912389815e-6 1.0161649182477983e-5 1.863654677191947e-5 3.134281074643055e-5 4.833722203185754e-5 6.835915496489247e-5 8.865085608099055e-5 0.00010542422880259616 0.00011496593671950256 0.00011496593671950256 0.00010542422880259628 8.865085608099055e-5 6.835915496489247e-5 4.833722203185754e-5 3.1342810746430575e-5 1.863654677191947e-5 1.0161649182477983e-5 5.0808245912389815e-6 2.329568346489937e-6 9.79462835825955e-7 3.7763454712388614e-7 1.3351397454080597e-7 4.3286550820796285e-8 1.2869168555004412e-8 3.5084819555512232e-9; 8.344623408800353e-9 3.060821361956108e-8 1.0295334844003551e-7 3.175515369524369e-7 8.981713806211139e-7 2.329568346489937e-6 5.540678505061918e-6 1.2084305507964385e-5 2.4168611015928815e-5 4.4325428040495274e-5 7.454618708767795e-5 0.00011496593671950265 0.0001625863869196475 0.0002108484576051926 0.0002507424859714445 0.00027343661985957014 0.00027343661985957014 0.0002507424859714447 0.0002108484576051926 0.0001625863869196475 0.00011496593671950265 7.454618708767802e-5 4.4325428040495274e-5 2.4168611015928815e-5 1.2084305507964385e-5 5.540678505061918e-6 2.329568346489937e-6 8.981713806211139e-7 3.175515369524369e-7 1.0295334844003588e-7 3.060821361956108e-8 8.344623408800353e-9; 1.8199752706952592e-8 6.675698727040275e-8 2.2454284515527802e-7 6.925848131327384e-7 1.9589256716519037e-6 5.0808245912389815e-6 1.2084305507964385e-5 2.6356057200648992e-5 5.271211440129808e-5 9.667444406371495e-5 0.00016258638691964722 0.00025074248597144427 0.0003546034243239617 0.0004598637468780097 0.0005468732397191394 0.0005963694967014225 0.0005963694967014225 0.0005468732397191394 0.0004598637468780094 0.0003546034243239617 0.00025074248597144427 0.0001625863869196475 9.667444406371485e-5 5.271211440129808e-5 2.6356057200648992e-5 1.2084305507964385e-5 5.0808245912389815e-6 1.9589256716519037e-6 6.925848131327384e-7 2.2454284515527882e-7 6.675698727040275e-8 1.8199752706952592e-8; 3.639950541390525e-8 1.335139745408057e-7 4.4908569031055694e-7 1.3851696262654794e-6 3.917851343303814e-6 1.0161649182477983e-5 2.4168611015928815e-5 5.271211440129808e-5 0.00010542422880259636 0.00019334888812743022 0.000325172773839295 0.0005014849719428892 0.0007092068486479246 0.0009197274937560213 0.0010937464794382808 0.0011927389934028472 0.0011927389934028472 0.0010937464794382808 0.0009197274937560206 0.0007092068486479246 0.0005014849719428892 0.0003251727738392957 0.00019334888812743006 0.00010542422880259636 5.271211440129808e-5 2.4168611015928815e-5 1.0161649182477983e-5 3.917851343303814e-6 1.3851696262654794e-6 4.490856903105585e-7 1.335139745408057e-7 3.639950541390525e-8; 6.675698727040275e-8 2.448657089564883e-7 8.23626787520283e-7 2.5404122956194908e-6 7.185371044968894e-6 1.863654677191947e-5 4.4325428040495274e-5 9.667444406371495e-5 0.00019334888812743022 0.0003546034243239617 0.0005963694967014229 0.0009197274937560198 0.0013006910953571786 0.001686787660841538 0.0020059398877715537 0.002187492958876558 0.002187492958876558 0.0020059398877715537 0.0016867876608415372 0.0013006910953571786 0.0009197274937560198 0.0005963694967014233 0.00035460342432396154 0.00019334888812743022 9.667444406371495e-5 4.4325428040495274e-5 1.863654677191947e-5 7.185371044968894e-6 2.5404122956194908e-6 8.23626787520286e-7 2.448657089564883e-7 6.675698727040275e-8; 1.1227142257763898e-7 4.1181339376014066e-7 1.3851696262654769e-6 4.272447185305786e-6 1.2084305507964365e-5 3.134281074643055e-5 7.454618708767795e-5 0.00016258638691964722 0.000325172773839295 0.0005963694967014229 0.0010029699438857767 0.0015467911050194411 0.002187492958876558 0.0028368273945916967 0.0033735753216830766 0.003678909975024079 0.003678909975024079 0.0033735753216830766 0.0028368273945916954 0.002187492958876558 0.0015467911050194411 0.001002969943885778 0.0005963694967014221 0.000325172773839295 0.00016258638691964722 7.454618708767795e-5 3.134281074643055e-5 1.2084305507964365e-5 4.272447185305786e-6 1.3851696262654818e-6 4.1181339376014066e-7 1.1227142257763898e-7; 1.7314620328318453e-7 6.351030739048726e-7 2.136223592652892e-6 6.589014300162271e-6 1.8636546771919454e-5 4.833722203185754e-5 0.00011496593671950265 0.00025074248597144427 0.0005014849719428892 0.0009197274937560198 0.0015467911050194411 0.002385477986805694 0.003373575321683077 0.004374985917753121 0.00520276438142872 0.005673654789183394 0.005673654789183394 0.00520276438142872 0.004374985917753119 0.003373575321683077 0.002385477986805694 0.0015467911050194428 0.0009197274937560193 0.0005014849719428892 0.00025074248597144427 0.00011496593671950265 4.833722203185754e-5 1.8636546771919454e-5 6.589014300162271e-6 2.1362235926529e-6 6.351030739048726e-7 1.7314620328318453e-7; 2.448657089564883e-7 8.981713806211123e-7 3.021076376991096e-6 9.318273385959749e-6 2.6356057200649016e-5 6.835915496489247e-5 0.0001625863869196475 0.0003546034243239617 0.0007092068486479246 0.0013006910953571786 0.002187492958876558 0.003373575321683077 0.004770955973611384 0.006187164420077763 0.007357819950048159 0.008023759551086217 0.008023759551086217 0.007357819950048159 0.006187164420077759 0.004770955973611384 0.003373575321683077 0.002187492958876561 0.001300691095357178 0.0007092068486479246 0.0003546034243239617 0.0001625863869196475 6.835915496489247e-5 2.6356057200649016e-5 9.318273385959749e-6 3.0210763769911065e-6 8.981713806211123e-7 2.448657089564883e-7; 3.175515369524363e-7 1.1647841732449665e-6 3.917851343303821e-6 1.2084305507964394e-5 3.41795774824462e-5 8.865085608099055e-5 0.0002108484576051926 0.0004598637468780097 0.0009197274937560213 0.001686787660841538 0.0028368273945916967 0.004374985917753121 0.006187164420077763 0.008023759551086224 0.009541911947222773 0.010405528762857438 0.010405528762857438 0.009541911947222773 0.008023759551086218 0.006187164420077763 0.004374985917753121 0.002836827394591701 0.001686787660841538 0.0009197274937560213 0.0004598637468780097 0.0002108484576051926 8.865085608099055e-5 3.41795774824462e-5 1.2084305507964394e-5 3.917851343303835e-6 1.1647841732449665e-6 3.175515369524363e-7; 3.7763454712388683e-7 1.3851696262654769e-6 4.659136692979867e-6 1.4370742089937826e-5 4.0646596729911805e-5 0.00010542422880259616 0.0002507424859714445 0.0005468732397191394 0.0010937464794382808 0.0020059398877715537 0.0033735753216830766 0.00520276438142872 0.007357819950048159 0.009541911947222773 0.011347309578366787 0.012374328840155524 0.012374328840155524 0.011347309578366787 0.009541911947222767 0.007357819950048159 0.00520276438142872 0.0033735753216830814 0.0020059398877715524 0.0010937464794382808 0.0005468732397191394 0.0002507424859714445 0.00010542422880259616 4.0646596729911805e-5 1.4370742089937826e-5 4.659136692979882e-6 1.3851696262654769e-6 3.7763454712388683e-7; 4.1181339376014135e-7 1.510538188495548e-6 5.0808245912389815e-6 1.5671405373215287e-5 4.432542804049519e-5 0.00011496593671950256 0.00027343661985957014 0.0005963694967014225 0.0011927389934028472 0.002187492958876558 0.003678909975024079 0.005673654789183394 0.008023759551086217 0.010405528762857438 0.012374328840155524 0.013494301286732307 0.013494301286732307 0.012374328840155525 0.010405528762857434 0.008023759551086217 0.005673654789183394 0.0036789099750240833 0.0021874929588765572 0.0011927389934028472 0.0005963694967014225 0.00027343661985957014 0.00011496593671950256 4.432542804049519e-5 1.5671405373215287e-5 5.080824591239e-6 1.510538188495548e-6 4.1181339376014135e-7; 4.1181339376014135e-7 1.510538188495548e-6 5.0808245912389815e-6 1.5671405373215287e-5 4.432542804049519e-5 0.00011496593671950256 0.00027343661985957014 0.0005963694967014225 0.0011927389934028472 0.002187492958876558 0.003678909975024079 0.005673654789183394 0.008023759551086217 0.010405528762857438 0.012374328840155524 0.013494301286732307 0.013494301286732307 0.012374328840155525 0.010405528762857434 0.008023759551086217 0.005673654789183394 0.0036789099750240833 0.0021874929588765572 0.0011927389934028472 0.0005963694967014225 0.00027343661985957014 0.00011496593671950256 4.432542804049519e-5 1.5671405373215287e-5 5.080824591239e-6 1.510538188495548e-6 4.1181339376014135e-7; 3.7763454712388683e-7 1.3851696262654769e-6 4.659136692979867e-6 1.4370742089937826e-5 4.0646596729911805e-5 0.00010542422880259628 0.0002507424859714447 0.0005468732397191394 0.0010937464794382808 0.0020059398877715537 0.0033735753216830766 0.00520276438142872 0.007357819950048159 0.009541911947222773 0.011347309578366787 0.012374328840155525 0.012374328840155525 0.011347309578366788 0.009541911947222769 0.007357819950048159 0.00520276438142872 0.0033735753216830814 0.0020059398877715524 0.0010937464794382808 0.0005468732397191394 0.0002507424859714447 0.00010542422880259628 4.0646596729911805e-5 1.4370742089937826e-5 4.659136692979882e-6 1.3851696262654769e-6 3.7763454712388683e-7; 3.175515369524363e-7 1.1647841732449665e-6 3.917851343303814e-6 1.2084305507964394e-5 3.41795774824462e-5 8.865085608099055e-5 0.0002108484576051926 0.0004598637468780094 0.0009197274937560206 0.0016867876608415372 0.0028368273945916954 0.004374985917753119 0.006187164420077759 0.008023759551086218 0.009541911947222767 0.010405528762857434 0.010405528762857434 0.009541911947222769 0.008023759551086213 0.006187164420077759 0.004374985917753119 0.0028368273945916997 0.0016867876608415364 0.0009197274937560206 0.0004598637468780094 0.0002108484576051926 8.865085608099055e-5 3.41795774824462e-5 1.2084305507964394e-5 3.917851343303829e-6 1.1647841732449665e-6 3.175515369524363e-7; 2.448657089564883e-7 8.981713806211123e-7 3.021076376991096e-6 9.318273385959749e-6 2.6356057200649016e-5 6.835915496489247e-5 0.0001625863869196475 0.0003546034243239617 0.0007092068486479246 0.0013006910953571786 0.002187492958876558 0.003373575321683077 0.004770955973611384 0.006187164420077763 0.007357819950048159 0.008023759551086217 0.008023759551086217 0.007357819950048159 0.006187164420077759 0.004770955973611384 0.003373575321683077 0.002187492958876561 0.001300691095357178 0.0007092068486479246 0.0003546034243239617 0.0001625863869196475 6.835915496489247e-5 2.6356057200649016e-5 9.318273385959749e-6 3.0210763769911065e-6 8.981713806211123e-7 2.448657089564883e-7; 1.7314620328318453e-7 6.351030739048726e-7 2.136223592652892e-6 6.589014300162271e-6 1.8636546771919454e-5 4.833722203185754e-5 0.00011496593671950265 0.00025074248597144427 0.0005014849719428892 0.0009197274937560198 0.0015467911050194411 0.002385477986805694 0.003373575321683077 0.004374985917753121 0.00520276438142872 0.005673654789183394 0.005673654789183394 0.00520276438142872 0.004374985917753119 0.003373575321683077 0.002385477986805694 0.0015467911050194428 0.0009197274937560193 0.0005014849719428892 0.00025074248597144427 0.00011496593671950265 4.833722203185754e-5 1.8636546771919454e-5 6.589014300162271e-6 2.1362235926529e-6 6.351030739048726e-7 1.7314620328318453e-7; 1.1227142257763922e-7 4.1181339376014135e-7 1.3851696262654794e-6 4.272447185305794e-6 1.2084305507964374e-5 3.1342810746430575e-5 7.454618708767802e-5 0.0001625863869196475 0.0003251727738392957 0.0005963694967014233 0.001002969943885778 0.0015467911050194428 0.002187492958876561 0.002836827394591701 0.0033735753216830814 0.0036789099750240833 0.0036789099750240833 0.0033735753216830814 0.0028368273945916997 0.002187492958876561 0.0015467911050194428 0.0010029699438857793 0.0005963694967014233 0.0003251727738392957 0.0001625863869196475 7.454618708767802e-5 3.1342810746430575e-5 1.2084305507964374e-5 4.272447185305794e-6 1.3851696262654843e-6 4.1181339376014135e-7 1.1227142257763922e-7; 6.675698727040275e-8 2.448657089564883e-7 8.236267875202814e-7 2.5404122956194908e-6 7.185371044968885e-6 1.863654677191947e-5 4.4325428040495274e-5 9.667444406371485e-5 0.00019334888812743006 0.00035460342432396154 0.0005963694967014221 0.0009197274937560193 0.001300691095357178 0.001686787660841538 0.0020059398877715524 0.0021874929588765572 0.0021874929588765572 0.0020059398877715524 0.0016867876608415364 0.001300691095357178 0.0009197274937560193 0.0005963694967014233 0.0003546034243239614 0.00019334888812743006 9.667444406371485e-5 4.4325428040495274e-5 1.863654677191947e-5 7.185371044968885e-6 2.5404122956194908e-6 8.236267875202844e-7 2.448657089564883e-7 6.675698727040275e-8; 3.639950541390525e-8 1.335139745408057e-7 4.4908569031055694e-7 1.3851696262654794e-6 3.917851343303814e-6 1.0161649182477983e-5 2.4168611015928815e-5 5.271211440129808e-5 0.00010542422880259636 0.00019334888812743022 0.000325172773839295 0.0005014849719428892 0.0007092068486479246 0.0009197274937560213 0.0010937464794382808 0.0011927389934028472 0.0011927389934028472 0.0010937464794382808 0.0009197274937560206 0.0007092068486479246 0.0005014849719428892 0.0003251727738392957 0.00019334888812743006 0.00010542422880259636 5.271211440129808e-5 2.4168611015928815e-5 1.0161649182477983e-5 3.917851343303814e-6 1.3851696262654794e-6 4.490856903105585e-7 1.335139745408057e-7 3.639950541390525e-8; 1.8199752706952592e-8 6.675698727040275e-8 2.2454284515527802e-7 6.925848131327384e-7 1.9589256716519037e-6 5.0808245912389815e-6 1.2084305507964385e-5 2.6356057200648992e-5 5.271211440129808e-5 9.667444406371495e-5 0.00016258638691964722 0.00025074248597144427 0.0003546034243239617 0.0004598637468780097 0.0005468732397191394 0.0005963694967014225 0.0005963694967014225 0.0005468732397191394 0.0004598637468780094 0.0003546034243239617 0.00025074248597144427 0.0001625863869196475 9.667444406371485e-5 5.271211440129808e-5 2.6356057200648992e-5 1.2084305507964385e-5 5.0808245912389815e-6 1.9589256716519037e-6 6.925848131327384e-7 2.2454284515527882e-7 6.675698727040275e-8 1.8199752706952592e-8; 8.344623408800353e-9 3.060821361956108e-8 1.0295334844003551e-7 3.175515369524369e-7 8.981713806211139e-7 2.329568346489937e-6 5.540678505061918e-6 1.2084305507964385e-5 2.4168611015928815e-5 4.4325428040495274e-5 7.454618708767795e-5 0.00011496593671950265 0.0001625863869196475 0.0002108484576051926 0.0002507424859714445 0.00027343661985957014 0.00027343661985957014 0.0002507424859714447 0.0002108484576051926 0.0001625863869196475 0.00011496593671950265 7.454618708767802e-5 4.4325428040495274e-5 2.4168611015928815e-5 1.2084305507964385e-5 5.540678505061918e-6 2.329568346489937e-6 8.981713806211139e-7 3.175515369524369e-7 1.0295334844003588e-7 3.060821361956108e-8 8.344623408800353e-9; 3.5084819555512232e-9 1.2869168555004412e-8 4.328655082079613e-8 1.3351397454080597e-7 3.7763454712388614e-7 9.79462835825955e-7 2.329568346489937e-6 5.0808245912389815e-6 1.0161649182477983e-5 1.863654677191947e-5 3.134281074643055e-5 4.833722203185754e-5 6.835915496489247e-5 8.865085608099055e-5 0.00010542422880259616 0.00011496593671950256 0.00011496593671950256 0.00010542422880259628 8.865085608099055e-5 6.835915496489247e-5 4.833722203185754e-5 3.1342810746430575e-5 1.863654677191947e-5 1.0161649182477983e-5 5.0808245912389815e-6 2.329568346489937e-6 9.79462835825955e-7 3.7763454712388614e-7 1.3351397454080597e-7 4.3286550820796285e-8 1.2869168555004412e-8 3.5084819555512232e-9; 1.3527047131498763e-9 4.9617427648818055e-9 1.6689246817600684e-8 5.1476674220017655e-8 1.455980216556205e-7 3.7763454712388614e-7 8.981713806211139e-7 1.9589256716519037e-6 3.917851343303814e-6 7.185371044968894e-6 1.2084305507964365e-5 1.8636546771919454e-5 2.6356057200649016e-5 3.41795774824462e-5 4.0646596729911805e-5 4.432542804049519e-5 4.432542804049519e-5 4.0646596729911805e-5 3.41795774824462e-5 2.6356057200649016e-5 1.8636546771919454e-5 1.2084305507964374e-5 7.185371044968885e-6 3.917851343303814e-6 1.9589256716519037e-6 8.981713806211139e-7 3.7763454712388614e-7 1.455980216556205e-7 5.1476674220017655e-8 1.6689246817600743e-8 4.9617427648818055e-9 1.3527047131498763e-9; 4.782533378056425e-10 1.7542409777756147e-9 5.900539798810739e-9 1.819975270695265e-8 5.1476674220017655e-8 1.3351397454080597e-7 3.175515369524369e-7 6.925848131327384e-7 1.3851696262654794e-6 2.5404122956194908e-6 4.272447185305786e-6 6.589014300162271e-6 9.318273385959749e-6 1.2084305507964394e-5 1.4370742089937826e-5 1.5671405373215287e-5 1.5671405373215287e-5 1.4370742089937826e-5 1.2084305507964394e-5 9.318273385959749e-6 6.589014300162271e-6 4.272447185305794e-6 2.5404122956194908e-6 1.3851696262654794e-6 6.925848131327384e-7 3.175515369524369e-7 1.3351397454080597e-7 5.1476674220017655e-8 1.819975270695265e-8 5.90053979881076e-9 1.7542409777756147e-9 4.782533378056425e-10; 1.5505446140255717e-10 5.687422720922701e-10 1.9130133512225742e-9 5.90053979881076e-9 1.6689246817600743e-8 4.3286550820796285e-8 1.0295334844003588e-7 2.2454284515527882e-7 4.490856903105585e-7 8.23626787520286e-7 1.3851696262654818e-6 2.1362235926529e-6 3.0210763769911065e-6 3.917851343303835e-6 4.659136692979882e-6 5.080824591239e-6 5.080824591239e-6 4.659136692979882e-6 3.917851343303829e-6 3.0210763769911065e-6 2.1362235926529e-6 1.3851696262654843e-6 8.236267875202844e-7 4.490856903105585e-7 2.2454284515527882e-7 1.0295334844003588e-7 4.3286550820796285e-8 1.6689246817600743e-8 5.90053979881076e-9 1.913013351222581e-9 5.687422720922701e-10 1.5505446140255717e-10; 4.60979671782088e-11 1.690880891437348e-10 5.687422720922681e-10 1.7542409777756147e-9 4.9617427648818055e-9 1.2869168555004412e-8 3.060821361956108e-8 6.675698727040275e-8 1.335139745408057e-7 2.448657089564883e-7 4.1181339376014066e-7 6.351030739048726e-7 8.981713806211123e-7 1.1647841732449665e-6 1.3851696262654769e-6 1.510538188495548e-6 1.510538188495548e-6 1.3851696262654769e-6 1.1647841732449665e-6 8.981713806211123e-7 6.351030739048726e-7 4.1181339376014135e-7 2.448657089564883e-7 1.335139745408057e-7 6.675698727040275e-8 3.060821361956108e-8 1.2869168555004412e-8 4.9617427648818055e-9 1.7542409777756147e-9 5.687422720922701e-10 1.690880891437348e-10 4.60979671782088e-11; 1.2567547416996487e-11 4.60979671782088e-11 1.5505446140255663e-10 4.782533378056425e-10 1.3527047131498763e-9 3.5084819555512232e-9 8.344623408800353e-9 1.8199752706952592e-8 3.639950541390525e-8 6.675698727040275e-8 1.1227142257763898e-7 1.7314620328318453e-7 2.448657089564883e-7 3.175515369524363e-7 3.7763454712388683e-7 4.1181339376014135e-7 4.1181339376014135e-7 3.7763454712388683e-7 3.175515369524363e-7 2.448657089564883e-7 1.7314620328318453e-7 1.1227142257763922e-7 6.675698727040275e-8 3.639950541390525e-8 1.8199752706952592e-8 8.344623408800353e-9 3.5084819555512232e-9 1.3527047131498763e-9 4.782533378056425e-10 1.5505446140255717e-10 4.60979671782088e-11 1.2567547416996487e-11])</span></span></code></pre></div><p>To make the Gaussian Markov random field efficient we first precompute a bunch of quantities that allow us to scale things linearly with the number of image pixels. The returns a functional that accepts a single argument related to the correlation length of the field. The second argument defines the underlying random field of the Markov process. Here we are using a zero mean and unit variance Gaussian Markov random field. For this tutorial we will use the first order random field</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cprior </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> corr_image_prior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grid, dvis)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HierarchicalPrior(</span></span>
<span class="line"><span>	map: </span></span>
<span class="line"><span>	ConditionalMarkov(</span></span>
<span class="line"><span>Random Field: VLBIImagePriors.GaussMarkovRandomField</span></span>
<span class="line"><span>Graph: MarkovRandomFieldGraph{1}(</span></span>
<span class="line"><span>dims: (32, 32)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>)	hyper prior: </span></span>
<span class="line"><span>	Truncated(Distributions.InverseGamma{Float64}(</span></span>
<span class="line"><span>invd: Distributions.Gamma{Float64}(α=1.0, θ=0.054358121593522137)</span></span>
<span class="line"><span>θ: 18.396515013483654</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>; lower=1.0, upper=64.0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>)</span></span></code></pre></div><p>Putting everything together the total prior is then our image prior, a prior on the standard deviation of the MRF, and a prior on the fractional flux of the Gaussian component.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prior </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cprior,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         σimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> truncated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); lower</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         fg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(c = HierarchicalPrior(</span></span>
<span class="line"><span>	map: </span></span>
<span class="line"><span>	ConditionalMarkov(</span></span>
<span class="line"><span>Random Field: VLBIImagePriors.GaussMarkovRandomField</span></span>
<span class="line"><span>Graph: MarkovRandomFieldGraph{1}(</span></span>
<span class="line"><span>dims: (32, 32)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>)	hyper prior: </span></span>
<span class="line"><span>	Truncated(Distributions.InverseGamma{Float64}(</span></span>
<span class="line"><span>invd: Distributions.Gamma{Float64}(α=1.0, θ=0.054358121593522137)</span></span>
<span class="line"><span>θ: 18.396515013483654</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>; lower=1.0, upper=64.0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>, σimg = Truncated(Distributions.Normal{Float64}(μ=0.0, σ=0.5); lower=0.0), fg = Distributions.Uniform{Float64}(a=0.0, b=1.0))</span></span></code></pre></div><p>Now we can construct our sky model.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skym </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SkyModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sky, prior, grid; metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skymeta)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SkyModel</span></span>
<span class="line"><span>  with map: sky</span></span>
<span class="line"><span>   on grid: ComradeBase.RectiGrid</span></span></code></pre></div><p>Unlike other imaging examples (e.g., <a href="/Comrade.jl/v0.11.4/tutorials/intermediate/ClosureImaging#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>) we also need to include a model for the instrument, i.e., gains. The gains will be broken into two components</p><ul><li><p>Gain amplitudes which are typically known to 10-20%, except for LMT, which has amplitudes closer to 50-100%.</p></li><li><p>Gain phases which are more difficult to constrain and can shift rapidly.</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SingleStokesGain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> exp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1im</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gp)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">intpr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ArrayPrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IIDSitePrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ScanSeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); LM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IIDSitePrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ScanSeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ArrayPrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IIDSitePrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ScanSeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DiagonalVonMises</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">π</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))); refant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SEFDReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), phase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">intmodel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> InstrumentModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(G, intpr)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>InstrumentModel</span></span>
<span class="line"><span>  with Jones: SingleStokesGain</span></span>
<span class="line"><span>  with reference basis: PolarizedTypes.CirBasis()</span></span></code></pre></div><p>To form the posterior we just combine the skymodel, instrument model and the data. Additionally, since we want to use gradients we need to specify the AD mode. Essentially for all modes we recommend using <code>Enzyme.set_runtime_activity(Enzyme.Reverse)</code>. Eventually as Comrade and Enzyme matures we will no need <code>set_runtime_activity</code>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Enzyme</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">post </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VLBIPosterior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(skym, intmodel, dvis; admode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_runtime_activity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Enzyme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reverse))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>VLBIPosterior</span></span>
<span class="line"><span>ObservedSkyModel</span></span>
<span class="line"><span>  with map: sky</span></span>
<span class="line"><span>   on grid: VLBISkyModels.FourierDualDomainObservedInstrumentModel</span></span>
<span class="line"><span>  with Jones: SingleStokesGain</span></span>
<span class="line"><span>  with reference basis: PolarizedTypes.CirBasis()Data Products: Comrade.EHTVisibilityDatum</span></span></code></pre></div><p>done using the <code>asflat</code> function.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tpost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> asflat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ndim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dimension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tpost)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1355</span></span></code></pre></div><p>We can now also find the dimension of our posterior or the number of parameters we are going to sample.</p><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>This can often be different from what you would expect. This is especially true when using angular variables where we often artificially increase the dimension of the parameter space to make sampling easier.</p></div><p>To initialize our sampler we will use optimize using Adam</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Optimization</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OptimizationOptimisers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xopt, sol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> comrade_opt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, Optimisers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Adam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); initial_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prior_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rng, post), maxiters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, g_tol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1e-1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] unaliascopy</span></span>
<span class="line"><span>│    @ ./abstractarray.jl:1496</span></span>
<span class="line"><span>│  [3] unalias</span></span>
<span class="line"><span>│    @ ./abstractarray.jl:1480</span></span>
<span class="line"><span>│  [4] #214</span></span>
<span class="line"><span>│    @ ./subarray.jl:183</span></span>
<span class="line"><span>│  [5] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:291</span></span>
<span class="line"><span>│  [6] view</span></span>
<span class="line"><span>│    @ ./subarray.jl:183</span></span>
<span class="line"><span>│  [7] site_sum</span></span>
<span class="line"><span>│    @ ~/work/Comrade.jl/Comrade.jl/src/instrument/instrument_transforms.jl:70</span></span>
<span class="line"><span>│  [8] _instrument_transform_with</span></span>
<span class="line"><span>│    @ ~/work/Comrade.jl/Comrade.jl/src/instrument/instrument_transforms.jl:52</span></span>
<span class="line"><span>│  [9] transform_with</span></span>
<span class="line"><span>│    @ ~/work/Comrade.jl/Comrade.jl/src/instrument/instrument_transforms.jl:7</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>Fitting gains tends to be very difficult, meaning that optimization can take a lot longer. The upside is that we usually get nicer images.</p></div><p>First we will evaluate our fit by plotting the residuals</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Plots</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">residual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+p+`" alt=""></p><p>These look reasonable, although there may be some minor overfitting. This could be improved in a few ways, but that is beyond the goal of this quick tutorial. Plotting the image, we see that we have a much cleaner version of the closure-only image from <a href="/Comrade.jl/v0.11.4/tutorials/intermediate/ClosureImaging#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CairoMakie </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imagepixels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fovx, fovy, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt), g)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">imageviz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(img, size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+l+`" alt=""></p><p>Because we also fit the instrument model, we can inspect their parameters. To do this, <code>Comrade</code> provides a <code>caltable</code> function that converts the flattened gain parameters to a tabular format based on the time and its segmentation.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">intopt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instrumentmodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">caltable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">angle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(intopt))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gt, layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+t+`" alt=""></p><p>The gain phases are pretty random, although much of this is due to us picking a random reference sites for each scan.</p><p>Moving onto the gain amplitudes, we see that most of the gain variation is within 10% as expected except LMT, which has massive variations.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">caltable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(intopt))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gt, layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+h+`" alt=""></p><p>To sample from the posterior, we will use HMC, specifically the NUTS algorithm. For information about NUTS, see Michael Betancourt&#39;s <a href="https://arxiv.org/abs/1701.02434" target="_blank" rel="noreferrer">notes</a>. However, due to the need to sample a large number of gain parameters, constructing the posterior is rather time-consuming. Therefore, for this tutorial, we will only do a quick preliminary run</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AdvancedHMC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rng, post, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NUTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; n_adapts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, progress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, initial_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xopt)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PosteriorSamples</span></span>
<span class="line"><span>  Samples size: (1000,)</span></span>
<span class="line"><span>  sampler used: AHMC</span></span>
<span class="line"><span>Mean</span></span>
<span class="line"><span>┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ sky                                                                                                                                                                                                                                                                  │ instrument                                                                                                                                                                                                                                                                                                                                                                                                                             │</span></span>
<span class="line"><span>│ @NamedTuple{c::@NamedTuple{params::Matrix{Float64}, hyperparams::Float64}, σimg::Float64, fg::Float64}                                                                                                                                                               │ @NamedTuple{lg::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}, gp::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}}                                                                              │</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ (c = (params = [0.0120304 0.0310417 … -0.0185564 -0.0119493; 0.00488018 0.0592959 … -0.034127 -0.0591824; … ; -0.00208871 -0.0434113 … 0.00871544 0.0111382; -0.000625063 -0.0256909 … -0.0193386 -0.0227181], hyperparams = 25.7501), σimg = 2.0904, fg = 0.393625) │ (lg = [0.0104241, 0.0351574, 0.00762824, 0.0259412, -0.368001, 0.140421, 0.00407721, 0.0293403, -0.189211, 0.105144  …  -0.0705702, 0.0146568, -0.869302, 0.0127516, 0.00558723, 0.0305973, -0.136971, 0.0222221, -0.913893, 0.010502], gp = [0.0, -0.762201, 0.0, -2.19218, 0.913016, -0.929152, 0.0, -2.24037, 0.972063, -1.14194  …  -2.40046, -0.18096, 0.405425, 1.11445, 0.0, -1.83157, -2.47689, -0.149211, 2.05575, 0.934595]) │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>Std. Dev.</span></span>
<span class="line"><span>┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ sky                                                                                                                                                                                                                                      │ instrument                                                                                                                                                                                                                                                                                                                                                                                                                    │</span></span>
<span class="line"><span>│ @NamedTuple{c::@NamedTuple{params::Matrix{Float64}, hyperparams::Float64}, σimg::Float64, fg::Float64}                                                                                                                                   │ @NamedTuple{lg::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}, gp::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}}                                                                     │</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ (c = (params = [0.549915 0.561236 … 0.581077 0.55715; 0.606579 0.635047 … 0.670705 0.575961; … ; 0.596784 0.630165 … 0.650749 0.592076; 0.518668 0.562766 … 0.600926 0.554907], hyperparams = 16.1764), σimg = 0.245619, fg = 0.0603197) │ (lg = [0.14338, 0.142976, 0.0205509, 0.0214524, 0.0758309, 0.0577348, 0.0186255, 0.0209875, 0.0680294, 0.0550296  …  0.0472535, 0.018158, 0.0672961, 0.0168822, 0.0161081, 0.0203701, 0.0507178, 0.0174185, 0.0688051, 0.0174065], gp = [0.0, 0.494327, 0.0, 0.0177255, 0.179218, 0.497488, 0.0, 0.017239, 0.180377, 0.50102  …  0.331228, 0.325398, 2.96219, 2.64781, 0.0, 0.0175823, 0.596828, 0.325871, 2.07429, 2.72824]) │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The above sampler will store the samples in memory, i.e. RAM. For large models this can lead to out-of-memory issues. To fix that you can include the keyword argument <code>saveto = DiskStore()</code> which periodically saves the samples to disk limiting memory useage. You can load the chain using <code>load_samples(diskout)</code> where <code>diskout</code> is the object returned from sample.</p></div><p>Now we prune the adaptation phase</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chain[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">501</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PosteriorSamples</span></span>
<span class="line"><span>  Samples size: (500,)</span></span>
<span class="line"><span>  sampler used: AHMC</span></span>
<span class="line"><span>Mean</span></span>
<span class="line"><span>┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ sky                                                                                                                                                                                                                                                               │ instrument                                                                                                                                                                                                                                                                                                                                                                                                                          │</span></span>
<span class="line"><span>│ @NamedTuple{c::@NamedTuple{params::Matrix{Float64}, hyperparams::Float64}, σimg::Float64, fg::Float64}                                                                                                                                                            │ @NamedTuple{lg::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}, gp::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}}                                                                           │</span></span>
<span class="line"><span>├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ (c = (params = [0.0307194 0.0682406 … -0.0136568 -0.0376682; 0.0340286 0.0570966 … -0.0507615 -0.0582053; … ; -0.0509191 -0.04864 … -0.0628998 -0.0585576; -0.0172879 -0.0601525 … -0.0930341 -0.0631538], hyperparams = 24.6235), σimg = 2.11128, fg = 0.409126) │ (lg = [0.0226499, 0.0345541, 0.00742971, 0.026638, -0.352704, 0.151531, 0.00467817, 0.0286472, -0.174863, 0.116489  …  -0.0591637, 0.0151242, -0.856694, 0.0130846, 0.00519746, 0.0312227, -0.12555, 0.0229436, -0.900833, 0.00961596], gp = [0.0, -0.713372, 0.0, -2.19241, 0.909481, -0.880279, 0.0, -2.24018, 0.968661, -1.09257  …  -2.3984, -0.211605, 0.433946, 1.05154, 0.0, -1.83116, -2.42335, -0.182784, 2.08642, 0.877]) │</span></span>
<span class="line"><span>└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>Std. Dev.</span></span>
<span class="line"><span>┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ sky                                                                                                                                                                                                                                    │ instrument                                                                                                                                                                                                                                                                                                                                                                                                                    │</span></span>
<span class="line"><span>│ @NamedTuple{c::@NamedTuple{params::Matrix{Float64}, hyperparams::Float64}, σimg::Float64, fg::Float64}                                                                                                                                 │ @NamedTuple{lg::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}, gp::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}}                                                                     │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ (c = (params = [0.521717 0.554018 … 0.587304 0.560917; 0.573134 0.620412 … 0.642371 0.582069; … ; 0.597884 0.619164 … 0.663992 0.58402; 0.533481 0.577763 … 0.612727 0.572727], hyperparams = 14.775), σimg = 0.234295, fg = 0.051838) │ (lg = [0.138415, 0.140428, 0.0203375, 0.021562, 0.0723183, 0.0551585, 0.0185786, 0.0208155, 0.0654512, 0.0511381  …  0.0411845, 0.017841, 0.066131, 0.0169533, 0.0161878, 0.0218816, 0.0449029, 0.0172845, 0.0674652, 0.0173734], gp = [0.0, 0.52702, 0.0, 0.0179641, 0.194564, 0.529219, 0.0, 0.0169381, 0.198145, 0.531977  …  0.424921, 0.375704, 2.94841, 2.63342, 0.0, 0.0176757, 0.818867, 0.376586, 2.02825, 2.70693]) │</span></span>
<span class="line"><span>└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>This should be run for likely an order of magnitude more steps to properly estimate expectations of the posterior</p></div><p>Now that we have our posterior, we can put error bars on all of our plots above. Let&#39;s start by finding the mean and standard deviation of the gain phases</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mchain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rmap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mean, chain);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rmap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(std, chain);</span></span></code></pre></div><p>Now we can use the measurements package to automatically plot everything with error bars. First we create a <code>caltable</code> the same way but making sure all of our variables have errors attached to them.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Measurements</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gmeas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instrumentmodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, (;instrument</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((x,y)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Measurements</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">measurement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(x,y), mchain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instrument, schain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instrument)))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctable_am </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> caltable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(gmeas))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctable_ph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> caltable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">angle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(gmeas))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>─────────┬───────────────────┬────────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span>      Ti │                Fr │      AA            AP           AZ          JC          LM          PV          SM</span></span>
<span class="line"><span>─────────┼───────────────────┼────────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span> 0.92 hr │ 227.070703125 GHz │ 0.0±0.0       missing      missing     missing     missing  -0.71±0.53     missing</span></span>
<span class="line"><span> 1.22 hr │ 227.070703125 GHz │ 0.0±0.0  -2.192±0.018      missing     missing    0.91±0.2  -0.88±0.53     missing</span></span>
<span class="line"><span> 1.52 hr │ 227.070703125 GHz │ 0.0±0.0   -2.24±0.017      missing     missing    0.97±0.2  -1.09±0.53     missing</span></span>
<span class="line"><span> 1.82 hr │ 227.070703125 GHz │ 0.0±0.0  -2.275±0.018      missing     missing     1.0±0.2  -1.28±0.54     missing</span></span>
<span class="line"><span> 2.12 hr │ 227.070703125 GHz │ 0.0±0.0   -2.33±0.017      missing     missing   1.05±0.21  -1.48±0.54     missing</span></span>
<span class="line"><span> 2.45 hr │ 227.070703125 GHz │ missing   -2.33±0.017      missing     missing  -0.77±0.22  -1.59±0.61     missing</span></span>
<span class="line"><span> 2.75 hr │ 227.070703125 GHz │ 0.0±0.0  -2.402±0.018      missing     missing   1.05±0.22  -1.77±0.76     missing</span></span>
<span class="line"><span> 3.05 hr │ 227.070703125 GHz │ 0.0±0.0  -2.435±0.018      missing     missing   1.06±0.22    -1.8±1.0     missing</span></span>
<span class="line"><span> 3.35 hr │ 227.070703125 GHz │ 0.0±0.0  -2.465±0.018      missing     missing   1.04±0.22    -1.9±1.2     missing</span></span>
<span class="line"><span> 3.68 hr │ 227.070703125 GHz │ 0.0±0.0  -2.467±0.019    0.66±0.25     missing    1.0±0.23    -1.8±1.6     missing</span></span>
<span class="line"><span> 3.98 hr │ 227.070703125 GHz │ 0.0±0.0   -2.439±0.02    0.52±0.26     missing   0.92±0.23    -1.5±2.1     missing</span></span>
<span class="line"><span> 4.28 hr │ 227.070703125 GHz │ 0.0±0.0  -2.455±0.019    0.36±0.26     missing    0.8±0.24   -0.95±2.5     missing</span></span>
<span class="line"><span> 4.58 hr │ 227.070703125 GHz │ 0.0±0.0  -2.374±0.019    0.18±0.26  -1.18±0.31   0.71±0.24   -0.16±2.7     missing</span></span>
<span class="line"><span> 4.92 hr │ 227.070703125 GHz │ 0.0±0.0  -2.424±0.018  -0.024±0.27  -1.02±0.32   0.56±0.24    0.84±2.6  -2.18±0.69</span></span>
<span class="line"><span> 5.18 hr │ 227.070703125 GHz │ 0.0±0.0  -2.387±0.018   -0.21±0.27   -0.9±0.33   0.37±0.24     1.4±2.2    -2.2±1.2</span></span>
<span class="line"><span> 5.45 hr │ 227.070703125 GHz │ 0.0±0.0   -2.303±0.02   -0.36±0.27  -0.76±0.34   0.15±0.24     1.8±1.8    -2.0±1.8</span></span>
<span class="line"><span> 5.72 hr │ 227.070703125 GHz │ 0.0±0.0       missing   -0.59±0.27  -0.64±0.35  -0.21±0.24     missing    -1.4±2.4</span></span>
<span class="line"><span> 6.05 hr │ 227.070703125 GHz │ 0.0±0.0   -2.225±0.02   -0.88±0.27   -0.5±0.36  -0.97±0.24     missing     missing</span></span>
<span class="line"><span> 6.32 hr │ 227.070703125 GHz │ 0.0±0.0  -2.162±0.019   -1.09±0.27  -0.43±0.36  -1.66±0.24     missing   -0.29±2.9</span></span>
<span class="line"><span> 6.58 hr │ 227.070703125 GHz │ 0.0±0.0       missing   -1.36±0.26  -0.35±0.36   -2.1±0.24     missing    0.35±2.8</span></span>
<span class="line"><span> 6.85 hr │ 227.070703125 GHz │ 0.0±0.0  -2.109±0.021   -1.66±0.26  -0.29±0.37  -2.42±0.42     missing     1.1±2.6</span></span>
<span class="line"><span> 7.18 hr │ 227.070703125 GHz │ 0.0±0.0  -2.008±0.019   -1.92±0.26  -0.24±0.37    -2.3±1.5     missing     1.2±2.6</span></span>
<span class="line"><span> 7.45 hr │ 227.070703125 GHz │ 0.0±0.0  -1.968±0.017   -2.18±0.26  -0.22±0.38    -1.9±2.2     missing     1.3±2.5</span></span>
<span class="line"><span> 7.72 hr │ 227.070703125 GHz │ 0.0±0.0   -1.89±0.018    -2.4±0.42  -0.21±0.38    0.43±2.9     missing     1.1±2.6</span></span>
<span class="line"><span> 7.98 hr │ 227.070703125 GHz │ 0.0±0.0  -1.831±0.018   -2.42±0.82  -0.18±0.38     2.1±2.0     missing    0.88±2.7</span></span>
<span class="line"><span>─────────┴───────────────────┴────────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div><p>Now let&#39;s plot the phase curves</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctable_ph, layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+k+'" alt=""></p><p>and now the amplitude curves</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctable_am, layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="'+r+`" alt=""></p><p>Finally let&#39;s construct some representative image reconstructions.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post), chain[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">begin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imgs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(samples, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(g))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">simg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">700</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">700</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Axis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[i, j], xreversed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aspect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], mimg, colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mean&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], simg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(mimg, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1e-8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), colorrange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Std&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], imgs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],   colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], imgs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hidedecorations!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(axs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+d+'" alt=""></p><p>And viola, you have just finished making a preliminary image and instrument model reconstruction. In reality, you should run the <code>sample</code> step for many more MCMC steps to get a reliable estimate for the reconstructed image and instrument model parameters.</p><hr><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl" target="_blank" rel="noreferrer">Literate.jl</a>.</em></p>',99)]))}const b=a(o,[["render",c]]);export{C as __pageData,b as default};
