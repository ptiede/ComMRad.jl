<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Interface · Comrade.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Comrade.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../vlbi_imaging_problem/">Introduction to the VLBI Imaging Problem</a></li><li><a class="tocitem" href="../conventions/">Conventions</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../examples/black_hole_image/">Making an Image of a Black Hole</a></li><li><a class="tocitem" href="../examples/data/">Loading Data into Comrade</a></li><li><a class="tocitem" href="../examples/hybrid_imaging/">Hybrid Imaging of a Black Hole</a></li><li><a class="tocitem" href="../examples/imaging_closures/">Imaging a Black Hole using only Closure Quantities</a></li><li><a class="tocitem" href="../examples/imaging_pol/">Polarized Image and Instrumental Modeling</a></li><li><a class="tocitem" href="../examples/imaging_vis/">Stokes I Simultaneous Image and Instrument Modeling</a></li><li><a class="tocitem" href="../examples/nonanalytic/">Modeling with non-analytic Fourier transforms</a></li></ul></li><li><span class="tocitem">Libraries</span><ul><li><a class="tocitem" href="../libs/optimization/">ComradeOptimization</a></li><li><a class="tocitem" href="../libs/ahmc/">ComradeAHMC</a></li><li><a class="tocitem" href="../libs/nested/">ComradeNested</a></li><li><a class="tocitem" href="../libs/dynesty/">ComradeDynesty</a></li><li><a class="tocitem" href="../libs/adaptmcmc/">ComradeAdaptMCMC</a></li></ul></li><li class="is-active"><a class="tocitem" href>Model Interface</a><ul class="internal"><li><a class="tocitem" href="#Primitive-Geometric-Models"><span>Primitive Geometric Models</span></a></li><li><a class="tocitem" href="#Models-without-an-Analytic-Fourier-Transform"><span>Models without an Analytic Fourier Transform</span></a></li></ul></li><li><a class="tocitem" href="../base_api/">ComradeBase API</a></li><li><a class="tocitem" href="../api/">Comrade API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Model Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model Interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ptiede/Comrade.jl/blob/main/docs/src/interface.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-Interface"><a class="docs-heading-anchor" href="#Model-Interface">Model Interface</a><a id="Model-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Interface" title="Permalink"></a></h1><h2 id="Primitive-Geometric-Models"><a class="docs-heading-anchor" href="#Primitive-Geometric-Models">Primitive Geometric Models</a><a id="Primitive-Geometric-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Primitive-Geometric-Models" title="Permalink"></a></h2><p><code>Comrade</code> aims to be more modular and extensible than previous VLBI modeling packages. Namely, simple models are composed to construct complicated source morphologies instead of making many different models. This is accomplished with a type and trait-based hierarchy.</p><p>Additionally, <a href="https://github.com/ptiede/ComradeBase.jl"><code>ComradeBase</code></a> is a low-dependency version of this package that defines this type and trait hierarchy that users can more easily incorporate into their packages.</p><p>To see how this works, we will go through a simplified implementation of the Gaussian model in <code>Comrade</code>. The Gaussian model is a simple, compact emission structure model that can constrain the typical characteristic size of an image feature from VLBI data. To construct a Gaussian model, we will first define a struct:</p><pre><code class="language-julia hljs">struct MyGaussian &lt;: Comrade.AbstractModel end</code></pre><p>Notice that we don&#39;t provide any more information about the model, e.g., <em>size, shape, flux</em>, etc. This is because we will use <code>Comrade</code>&#39;s extensive set of modifiers to change the structure of the model. Now a <code>Gaussian</code> is the simplest model structure we can consider. We can consider this Gaussian to be a <strong>primitive</strong> model. That means a Gaussian is not a combination or modification of an existing model. To tell <code>Comrade</code> that this is the case, we define the following method:</p><pre><code class="language-julia hljs"># Tell Comrade Gaussian is a primitive model
ComradeBase.isprimitive(::Type{&lt;:MyGaussian}) = IsPrimitive()</code></pre><p>Note that if the Gaussian wasn&#39;t a primitive model, we could&#39;ve used <code>NotPrimitive()</code> instead. Now a Gaussian has an analytic expression in the image and Fourier domain. We can tell <code>Comrade</code> this by setting:</p><pre><code class="language-julia hljs"># Fourier and image domains are analytic
Comrade.visanalytic(::Type{&lt;:MyGaussian}) = IsAnalytic()
Comrade.imanalytic(::Type{&lt;:MyGaussian}) = IsAnalytic()</code></pre><p>Finally, we can specify if the model is intrinsically polarized by using the <code>IsPolarized</code> and <code>NotPolarized()</code> trait</p><pre><code class="language-julia hljs">Comrade.ispolarized(::Type{&lt;:MyGaussian}) = NotPolarized()</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The actual implementation defines the Gaussian to be a subtype of <code>Comrade.GeometricModel</code>, which automatically defines these methods. However, for models that aren&#39;t a subtype of <code>GeometricModel</code>, we assume the image domain <code>IsAnalytic()</code> and the Fourier domain is <code>NotAnalytic()</code>.</p></div></div><p>Since both the image and visibility domain representation of the Gaussian are analytic, we need to define an <code>intensity_point</code> and <code>visibility_point</code> method. For a Gaussian, these are given by</p><pre><code class="language-julia hljs">function ComradeBase.intensity_point(::MyGaussian, p)
    (;X, Y) = p
    return exp(-(X^2+Y^2)/2)/2π
end

function ComradeBase.visibility_point(::MyGaussian, u, v, time, freq) where {T}
    return exp(-2π^2*(u^2 + v^2)) + 0im
end</code></pre><p>Additionally, most models in <code>Comrade</code> has two additional functions one can implement if possible:</p><ol><li><code>flux(m::MyGaussian)</code>: This defines the flux of a model. If this isn&#39;t defined, the model won&#39;t have a flux until an image is created. For a Gaussian, the definition is <code>flux(::MyGaussian) = 1.0</code>.</li><li><code>radialextent(::MyGaussian)</code>: This defines the model&#39;s default radial extent. For a Gaussian, we will consider the radial extent to be <span>$5σ$</span>, so <code>radialextent(::MyGaussian) = 5.0</code>.</li></ol><p>This completely defines the model interface for <code>Comrade</code>. With this, you can call the usual user API to evaluate, fit, and plot the model. Additionally, we can start talking about adding multiple Gaussians and modifying them. For instance, suppose you want an elliptical Gaussian with a flux of 2 Jy. This can be created by <code>Comrade</code> as follows:</p><pre><code class="language-julia hljs">gauss = MyGaussian()
ellgauss = 2.0*rotated(stretched(gauss, 1.0, 0.5), π/4)
fig = plot(gauss, layout=(1,2), size=(800,300))
plot!(fig[2], ellgauss, size=(800,350))</code></pre><p><img src="../assets/gauss.png" alt="Image"/></p><pre><code class="language-julia hljs">u = rand(100)*0.5; v=rand(100)*0.5
vg  = visibilities(gauss, u, v)
veg = visibilities(ellgauss, u, v)

scatter(hypot.(u, v), abs.(vg), label=&quot;Gaussian&quot;)
scatter!(hypot.(u, v), abs.(veg), label=&quot;Elliptical Gaussian&quot;)</code></pre><p><img src="../assets/vis.png" alt="Image"/></p><h2 id="Models-without-an-Analytic-Fourier-Transform"><a class="docs-heading-anchor" href="#Models-without-an-Analytic-Fourier-Transform">Models without an Analytic Fourier Transform</a><a id="Models-without-an-Analytic-Fourier-Transform-1"></a><a class="docs-heading-anchor-permalink" href="#Models-without-an-Analytic-Fourier-Transform" title="Permalink"></a></h2><p>Now suppose your model does not have an analytic Fourier transform. In this case, the procedure is very similar to the above, except you define <code>visanalytic(::Type{&lt;:MyModel}) = NotAnalytic()</code>. However, everything else is the same. To compute visibilities, you just then create a <code>ModelImage</code> type using the <a href="../api/#Comrade.modelimage"><code>modelimage</code></a> function. To see how this see <a href="../examples/nonanalytic/#Modeling-with-non-analytic-Fourier-transforms">Modeling with non-analytic Fourier transforms</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../libs/adaptmcmc/">« ComradeAdaptMCMC</a><a class="docs-footer-nextpage" href="../base_api/">ComradeBase API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 1 March 2023 20:55">Wednesday 1 March 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
