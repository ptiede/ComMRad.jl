<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stokes I Simultaneous Image and Instrument Modeling · Comrade.jl</title><meta name="title" content="Stokes I Simultaneous Image and Instrument Modeling · Comrade.jl"/><meta property="og:title" content="Stokes I Simultaneous Image and Instrument Modeling · Comrade.jl"/><meta property="twitter:title" content="Stokes I Simultaneous Image and Instrument Modeling · Comrade.jl"/><meta name="description" content="Documentation for Comrade.jl."/><meta property="og:description" content="Documentation for Comrade.jl."/><meta property="twitter:description" content="Documentation for Comrade.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Comrade.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../vlbi_imaging_problem/">Introduction to the VLBI Imaging Problem</a></li><li><a class="tocitem" href="../../conventions/">Conventions</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../ClosureImaging/">Imaging a Black Hole using only Closure Quantities</a></li><li><a class="tocitem" href="../GeometricModeling/">Geometric Modeling of EHT Data</a></li><li><a class="tocitem" href="../HybridImaging/">Hybrid Imaging of a Black Hole</a></li><li><a class="tocitem" href="../LoadingData/">Loading Data into Comrade</a></li><li><a class="tocitem" href="../PolarizedImaging/">Polarized Image and Instrumental Modeling</a></li><li class="is-active"><a class="tocitem" href>Stokes I Simultaneous Image and Instrument Modeling</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#In-this-tutorial,-we-will-create-a-preliminary-reconstruction-of-the-2017-M87-data-on-April-6"><span>In this tutorial, we will create a preliminary reconstruction of the 2017 M87 data on April 6</span></a></li><li class="toplevel"><a class="tocitem" href="#by-simultaneously-creating-an-image-and-model-for-the-instrument.-By-instrument-model,-we"><span>by simultaneously creating an image and model for the instrument. By instrument model, we</span></a></li><li class="toplevel"><a class="tocitem" href="#mean-something-akin-to-self-calibration-in-traditional-VLBI-imaging-terminology.-However,"><span>mean something akin to self-calibration in traditional VLBI imaging terminology. However,</span></a></li><li class="toplevel"><a class="tocitem" href="#unlike-traditional-self-cal,-we-will-at-each-point-in-our-parameter-space-effectively-explore"><span>unlike traditional self-cal, we will at each point in our parameter space effectively explore</span></a></li><li class="toplevel"><a class="tocitem" href="#the-possible-self-cal-solutions.-This-will-allow-us-to-constrain-and-marginalize-over-the"><span>the possible self-cal solutions. This will allow us to constrain and marginalize over the</span></a></li><li class="toplevel"><a class="tocitem" href="#instrument-effects,-such-as-time-variable-gains."><span>instrument effects, such as time variable gains.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-get-started-we-load-Comrade."><span>To get started we load Comrade.</span></a></li><li class="toplevel"><a class="tocitem" href="#pkg_io-open(joinpath(__DIR,-&quot;pkg.log&quot;),-&quot;w&quot;)-#hide"><span>pkg_io = open(joinpath(__DIR, &quot;pkg.log&quot;), &quot;w&quot;) #hide</span></a></li><li class="toplevel"><a class="tocitem" href="#For-reproducibility-we-use-a-stable-random-number-genreator"><span>For reproducibility we use a stable random number genreator</span></a></li><li class="toplevel"><a class="tocitem" href="###-Load-the-Data"><span>## Load the Data</span></a></li><li class="toplevel"><a class="tocitem" href="#To-download-the-data-visit-https://doi.org/10.25739/g85n-f134"><span>To download the data visit https://doi.org/10.25739/g85n-f134</span></a></li><li class="toplevel"><a class="tocitem" href="#First-we-will-load-our-data:"><span>First we will load our data:</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-do-some-minor-preprocessing:"><span>Now we do some minor preprocessing:</span></a></li><li class="toplevel"><a class="tocitem" href="#Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases"><span>- Scan average the data since the data have been preprocessed so that the gain phases</span></a></li><li class="toplevel"><a class="tocitem" href="#coherent."><span>coherent.</span></a></li><li class="toplevel"><a class="tocitem" href="#Add-1%-systematic-noise-to-deal-with-calibration-issues-that-cause-1%-non-closing-errors."><span>- Add 1% systematic noise to deal with calibration issues that cause 1% non-closing errors.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-extract-our-complex-visibilities."><span>Now we extract our complex visibilities.</span></a></li><li class="toplevel"><a class="tocitem" href="###Building-the-Model/Posterior"><span>##Building the Model/Posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#Now,-we-must-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a"><span>Now, we must build our intensity/visibility model. That is, the model that takes in a</span></a></li><li class="toplevel"><a class="tocitem" href="#named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model."><span>named tuple of parameters and perhaps some metadata required to construct the model.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-our-model,-we-will-use-a-raster-or-ContinuousImage-for-our-image-model."><span>For our model, we will use a raster or <code>ContinuousImage</code> for our image model.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-model-is-given-below:"><span>The model is given below:</span></a></li><li class="toplevel"><a class="tocitem" href="#Unlike-other-imaging-examples"><span>Unlike other imaging examples</span></a></li><li class="toplevel"><a class="tocitem" href="#(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include"><span>(e.g., Imaging a Black Hole using only Closure Quantities) we also need to include</span></a></li><li class="toplevel"><a class="tocitem" href="#a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components"><span>a model for the instrument, i.e., gains as well. The gains will be broken into two components</span></a></li><li class="toplevel"><a class="tocitem" href="#Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%."><span>- Gain amplitudes which are typically known to 10-20%, except for LMT, which has amplitudes closer to 50-100%.</span></a></li><li class="toplevel"><a class="tocitem" href="#Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly."><span>- Gain phases which are more difficult to constrain and can shift rapidly.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-model-construction-is-very-similar-to-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref),"><span>The model construction is very similar to Imaging a Black Hole using only Closure Quantities,</span></a></li><li class="toplevel"><a class="tocitem" href="#except-we-include-a-large-scale-gaussian-since-we-want-to-model-the-zero-baselines."><span>except we include a large scale gaussian since we want to model the zero baselines.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-more-information-about-the-image-model"><span>For more information about the image model</span></a></li><li class="toplevel"><a class="tocitem" href="#please-read-the-closure-only-example.-Let&#39;s-discuss-the-instrument-model-[Comrade.JonesModel](@ref)."><span>please read the closure-only example. Let&#39;s discuss the instrument model <code>Comrade.JonesModel</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#Thanks-to-the-EHT-pre-calibration,-the-gains-are-stable-over-scans.-Therefore,-we-can"><span>Thanks to the EHT pre-calibration, the gains are stable over scans. Therefore, we can</span></a></li><li class="toplevel"><a class="tocitem" href="#model-the-gains-on-a-scan-by-scan-basis.-To-form-the-instrument-model,-we-need-our"><span>model the gains on a scan-by-scan basis. To form the instrument model, we need our</span></a></li><li class="toplevel"><a class="tocitem" href="#1.-Our-(log)-gain-amplitudes-and-phases-are-given-below-by-lgamp-and-gphase"><span>1. Our (log) gain amplitudes and phases are given below by <code>lgamp</code> and <code>gphase</code></span></a></li><li class="toplevel"><a class="tocitem" href="#2.-Our-function-or-cache-that-maps-the-gains-from-a-list-to-the-stations-they-impact-gcache."><span>2. Our function or cache that maps the gains from a list to the stations they impact <code>gcache.</code></span></a></li><li class="toplevel"><a class="tocitem" href="#3.-The-set-of-[Comrade.JonesPairs](@ref)-produced-by-[jonesStokes](@ref)"><span>3. The set of <code>Comrade.JonesPairs</code> produced by <code>jonesStokes</code></span></a></li><li class="toplevel"><a class="tocitem" href="#These-three-ingredients-then-specify-our-instrument-model.-The-instrument-model-can-then-be"><span>These three ingredients then specify our instrument model. The instrument model can then be</span></a></li><li class="toplevel"><a class="tocitem" href="#combined-with-our-image-model-cimg-to-form-the-total-JonesModel."><span>combined with our image model <code>cimg</code> to form the total <code>JonesModel</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now,-let&#39;s-set-up-our-image-model.-The-EHT&#39;s-nominal-resolution-is-20-25-μas.-Additionally,"><span>Now, let&#39;s set up our image model. The EHT&#39;s nominal resolution is 20-25 μas. Additionally,</span></a></li><li class="toplevel"><a class="tocitem" href="#the-EHT-is-not-very-sensitive-to-a-larger-field-of-view.-Typically-60-80-μas-is-enough-to"><span>the EHT is not very sensitive to a larger field of view. Typically 60-80 μas is enough to</span></a></li><li class="toplevel"><a class="tocitem" href="#describe-the-compact-flux-of-M87.-Given-this,-we-only-need-to-use-a-small-number-of-pixels"><span>describe the compact flux of M87. Given this, we only need to use a small number of pixels</span></a></li><li class="toplevel"><a class="tocitem" href="#to-describe-our-image."><span>to describe our image.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-let&#39;s-form-our-cache&#39;s.-First,-we-have-our-usual-image-cache-which-is-needed-to-numerically"><span>Now let&#39;s form our cache&#39;s. First, we have our usual image cache which is needed to numerically</span></a></li><li class="toplevel"><a class="tocitem" href="#compute-the-visibilities."><span>compute the visibilities.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-need-to-specify-our-image-prior.-For-this-work-we-will-use-a-Gaussian-Markov"><span>Now we need to specify our image prior. For this work we will use a Gaussian Markov</span></a></li><li class="toplevel"><a class="tocitem" href="#Random-field-prior"><span>Random field prior</span></a></li><li class="toplevel"><a class="tocitem" href="#Since-we-are-using-a-Gaussian-Markov-random-field-prior-we-need-to-first-specify-our-mean"><span>Since we are using a Gaussian Markov random field prior we need to first specify our <code>mean</code></span></a></li><li class="toplevel"><a class="tocitem" href="#image.-This-behaves-somewhat-similary-to-a-entropy-regularizer-in-that-it-will"><span>image. This behaves somewhat similary to a entropy regularizer in that it will</span></a></li><li class="toplevel"><a class="tocitem" href="#start-with-an-initial-guess-for-the-image-structure.-For-this-tutorial-we-will-use-a"><span>start with an initial guess for the image structure. For this tutorial we will use a</span></a></li><li class="toplevel"><a class="tocitem" href="#a-symmetric-Gaussian-with-a-FWHM-of-50-μas"><span>a symmetric Gaussian with a FWHM of 50 μas</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-since-we-are-actually-modeling-our-image-on-the-simplex-we-need-to-ensure-that"><span>Now since we are actually modeling our image on the simplex we need to ensure that</span></a></li><li class="toplevel"><a class="tocitem" href="#our-mean-image-has-unit-flux"><span>our mean image has unit flux</span></a></li><li class="toplevel"><a class="tocitem" href="#and-since-our-prior-is-not-on-the-simplex-we-need-to-convert-it-to-unconstrained-or-real-space."><span>and since our prior is not on the simplex we need to convert it to <code>unconstrained or real space</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-can-form-our-metadata-we-need-to-fully-define-our-model."><span>Now we can form our metadata we need to fully define our model.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-will-also-fix-the-total-flux-to-be-the-observed-value-1.1.-This-is-because"><span>We will also fix the total flux to be the observed value 1.1. This is because</span></a></li><li class="toplevel"><a class="tocitem" href="#total-flux-is-degenerate-with-a-global-shift-in-the-gain-amplitudes-making-the-problem"><span>total flux is degenerate with a global shift in the gain amplitudes making the problem</span></a></li><li class="toplevel"><a class="tocitem" href="#degenerate.-To-fix-this-we-use-the-observed-total-flux-as-our-value."><span>degenerate. To fix this we use the observed total flux as our value.</span></a></li><li class="toplevel"><a class="tocitem" href="#Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains"><span>Second, we now construct our instrument model cache. This tells us how to map from the gains</span></a></li><li class="toplevel"><a class="tocitem" href="#to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation"><span>to the model visibilities. However, to construct this map, we also need to specify the observation</span></a></li><li class="toplevel"><a class="tocitem" href="#segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument"><span>segmentation over which we expect the gains to change. This is specified in the second argument</span></a></li><li class="toplevel"><a class="tocitem" href="#to-jonescache,-and-currently,-there-are-two-options"><span>to <code>jonescache</code>, and currently, there are two options</span></a></li><li class="toplevel"><a class="tocitem" href="#FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations"><span>- <code>FixedSeg(val)</code>: Fixes the corruption to the value <code>val</code> for all time. This is usefule for reference stations</span></a></li><li class="toplevel"><a class="tocitem" href="#ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan"><span>- <code>ScanSeg()</code>: which forces the corruptions to only change from scan-to-scan</span></a></li><li class="toplevel"><a class="tocitem" href="#TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation"><span>- <code>TrackSeg()</code>: which forces the corruptions to be constant over a night&#39;s observation</span></a></li><li class="toplevel"><a class="tocitem" href="#For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly"><span>For this work, we use the scan segmentation for the gain amplitudes since that is roughly</span></a></li><li class="toplevel"><a class="tocitem" href="#the-timescale-we-expect-them-to-vary.-For-the-phases-we-use-a-station-specific-scheme-where"><span>the timescale we expect them to vary. For the phases we use a station specific scheme where</span></a></li><li class="toplevel"><a class="tocitem" href="#we-set-AA-to-be-fixed-to-unit-gain-because-it-will-function-as-a-reference-station."><span>we set AA to be fixed to unit gain because it will function as a reference station.</span></a></li><li class="toplevel"><a class="tocitem" href="#This-information-can-then-be-passed-through-our-instrument-model-as-metadata."><span>This information can then be passed through our instrument model as metadata.</span></a></li><li class="toplevel"><a class="tocitem" href="#Future-versions-of-Comrade-will-do-this-for-you-automatically."><span>Future versions of Comrade will do this for you automatically.</span></a></li><li class="toplevel"><a class="tocitem" href="#Moving-onto-our-prior,-we-first-focus-on-the-instrument-model-priors."><span>Moving onto our prior, we first focus on the instrument model priors.</span></a></li><li class="toplevel"><a class="tocitem" href="#Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases."><span>Each station requires its own prior on both the amplitudes and phases.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-the-amplitudes"><span>For the amplitudes</span></a></li><li class="toplevel"><a class="tocitem" href="#we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)"><span>we assume that the gains are apriori well calibrated around unit gains (or 0 log gain amplitudes)</span></a></li><li class="toplevel"><a class="tocitem" href="#which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for"><span>which corresponds to no instrument corruption. The gain dispersion is then set to 10% for</span></a></li><li class="toplevel"><a class="tocitem" href="#all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT"><span>all stations except LMT, representing that we expect 10% deviations from scan-to-scan. For LMT</span></a></li><li class="toplevel"><a class="tocitem" href="#we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017."><span>we let the prior expand to 100% due to the known pointing issues LMT had in 2017.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-the-phases,-we-will-use-a-unconstrained-white-noise-prior,-where-the"><span>For the phases, we will use a unconstrained white noise prior, where the</span></a></li><li class="toplevel"><a class="tocitem" href="#gain-phase-is-fit-independtly-fit-for-each-scan.-Since-the-phases-are-periodic"><span>gain phase is fit independtly fit for each scan. Since the phases are periodic</span></a></li><li class="toplevel"><a class="tocitem" href="#we-use-a-von-Mises-prior-with-concentration-parameter-(similar-to-inverse-variance)"><span>we use a von-Mises prior with concentration parameter (similar to inverse variance)</span></a></li><li class="toplevel"><a class="tocitem" href="#1/π2."><span>1/π^2.</span></a></li><li class="toplevel"><a class="tocitem" href="#In-addition-we-want-a-reasonable-guess-for-what-the-resolution-of-our-image-should-be."><span>In addition we want a reasonable guess for what the resolution of our image should be.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-radio-astronomy-this-is-given-by-roughly-the-longest-baseline-in-the-image.-To-put-this"><span>For radio astronomy this is given by roughly the longest baseline in the image. To put this</span></a></li><li class="toplevel"><a class="tocitem" href="#into-pixel-space-we-then-divide-by-the-pixel-size."><span>into pixel space we then divide by the pixel size.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-make-the-Gaussian-Markov-random-field-efficient-we-first-precompute-a-bunch-of-quantities"><span>To make the Gaussian Markov random field efficient we first precompute a bunch of quantities</span></a></li><li class="toplevel"><a class="tocitem" href="#that-allow-us-to-scale-things-linearly-with-the-number-of-image-pixels.-The-returns-a"><span>that allow us to scale things linearly with the number of image pixels. The returns a</span></a></li><li class="toplevel"><a class="tocitem" href="#functional-that-accepts-a-single-argument-related-to-the-correlation-length-of-the-field."><span>functional that accepts a single argument related to the correlation length of the field.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-second-argument-defines-the-underlying-random-field-of-the-Markov-process.-Here"><span>The second argument defines the underlying random field of the Markov process. Here</span></a></li><li class="toplevel"><a class="tocitem" href="#we-are-using-a-zero-mean-and-unit-variance-Gaussian-Markov-random-field.-The-keyword"><span>we are using a zero mean and unit variance Gaussian Markov random field. The keyword</span></a></li><li class="toplevel"><a class="tocitem" href="#argument-specifies-the-order-of-the-Gaussian-field.-Currently,-we-recommend-using-order"><span>argument specifies the order of the Gaussian field. Currently, we recommend using order</span></a></li><li class="toplevel"><a class="tocitem" href="#1-which-is-identical-to-TSV-variation-and-L-regularization"><span>- 1 which is identical to TSV variation and L₂ regularization</span></a></li><li class="toplevel"><a class="tocitem" href="#2-which-is-identical-to-a-Matern-1-process-in-2D-and-is-really-the-convolution-of-two"><span>- 2 which is identical to a Matern 1 process in 2D and is really the convolution of two</span></a></li><li class="toplevel"><a class="tocitem" href="#order-1-processes"><span>order 1 processes</span></a></li><li class="toplevel"><a class="tocitem" href="#For-this-tutorial-we-will-use-the-first-order-random-field"><span>For this tutorial we will use the first order random field</span></a></li><li class="toplevel"><a class="tocitem" href="#To-demonstrate-the-prior-let-create-a-few-random-realizations"><span>To demonstrate the prior let create a few random realizations</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-can-finally-form-our-image-prior.-For-this-we-use-a-heirarchical-prior-where-the"><span>Now we can finally form our image prior. For this we use a heirarchical prior where the</span></a></li><li class="toplevel"><a class="tocitem" href="#inverse-correlation-length-is-given-by-a-Half-Normal-distribution-whose-peak-is-at-zero-and"><span>inverse correlation length is given by a Half-Normal distribution whose peak is at zero and</span></a></li><li class="toplevel"><a class="tocitem" href="#standard-deviation-is-0.1/rat-where-recall-rat-is-the-beam-size-per-pixel."><span>standard deviation is <code>0.1/rat</code> where recall <code>rat</code> is the beam size per pixel.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-the-variance-of-the-random-field-we-use-another"><span>For the variance of the random field we use another</span></a></li><li class="toplevel"><a class="tocitem" href="#half-normal-prior-with-standard-deviation-0.1.-The-reason-we-use-the-half-normal-priors-is"><span>half normal prior with standard deviation 0.1. The reason we use the half-normal priors is</span></a></li><li class="toplevel"><a class="tocitem" href="#to-prefer-&quot;simple&quot;-structures.-Gaussian-Markov-random-fields-are-extremly-flexible-models,"><span>to prefer &quot;simple&quot; structures. Gaussian Markov random fields are extremly flexible models,</span></a></li><li class="toplevel"><a class="tocitem" href="#and-to-prevent-overfitting-it-is-common-to-use-priors-that-penalize-complexity.-Therefore,-we"><span>and to prevent overfitting it is common to use priors that penalize complexity. Therefore, we</span></a></li><li class="toplevel"><a class="tocitem" href="#want-to-use-priors-that-enforce-similarity-to-our-mean-image.-If-the-data-wants-more-complexity"><span>want to use priors that enforce similarity to our mean image. If the data wants more complexity</span></a></li><li class="toplevel"><a class="tocitem" href="#then-it-will-drive-us-away-from-the-prior."><span>then it will drive us away from the prior.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-can-now-form-our-model-parameter-priors.-Like-our-other-imaging-examples,-we-use-a"><span>We can now form our model parameter priors. Like our other imaging examples, we use a</span></a></li><li class="toplevel"><a class="tocitem" href="#Dirichlet-prior-for-our-image-pixels.-For-the-log-gain-amplitudes,-we-use-the-CalPrior"><span>Dirichlet prior for our image pixels. For the log gain amplitudes, we use the <code>CalPrior</code></span></a></li><li class="toplevel"><a class="tocitem" href="#which-automatically-constructs-the-prior-for-the-given-jones-cache-gcache."><span>which automatically constructs the prior for the given jones cache <code>gcache</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#Putting-it-all-together-we-form-our-likelihood-and-posterior-objects-for-optimization-and"><span>Putting it all together we form our likelihood and posterior objects for optimization and</span></a></li><li class="toplevel"><a class="tocitem" href="#sampling."><span>sampling.</span></a></li><li class="toplevel"><a class="tocitem" href="###-Reconstructing-the-Image-and-Instrument-Effects"><span>## Reconstructing the Image and Instrument Effects</span></a></li><li class="toplevel"><a class="tocitem" href="#To-sample-from-this-posterior,-it-is-convenient-to-move-from-our-constrained-parameter-space"><span>To sample from this posterior, it is convenient to move from our constrained parameter space</span></a></li><li class="toplevel"><a class="tocitem" href="#to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is"><span>to an unconstrained one (i.e., the support of the transformed posterior is (-∞, ∞)). This is</span></a></li><li class="toplevel"><a class="tocitem" href="#done-using-the-asflat-function."><span>done using the <code>asflat</code> function.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-are-going-to-sample."><span>We can now also find the dimension of our posterior or the number of parameters we are going to sample.</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-warning"><span>!!! warning</span></a></li><li class="toplevel"><a class="tocitem" href="#This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using"><span>This can often be different from what you would expect. This is especially true when using</span></a></li><li class="toplevel"><a class="tocitem" href="#angular-variables-where-we-often-artificially-increase-the-dimension"><span>angular variables where we often artificially increase the dimension</span></a></li><li class="toplevel"><a class="tocitem" href="#of-the-parameter-space-to-make-sampling-easier."><span>of the parameter space to make sampling easier.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-initialize-our-sampler-we-will-use-optimize-using-LBFGS"><span>To initialize our sampler we will use optimize using LBFGS</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-transform-back-to-parameter-space"><span>Now transform back to parameter space</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-warning-2"><span>!!! warning</span></a></li><li class="toplevel"><a class="tocitem" href="#Fitting-gains-tends-to-be-very-difficult,-meaning-that-optimization-can-take-a-lot-longer."><span>Fitting gains tends to be very difficult, meaning that optimization can take a lot longer.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-upside-is-that-we-usually-get-nicer-images."><span>The upside is that we usually get nicer images.</span></a></li><li class="toplevel"><a class="tocitem" href="#First-we-will-evaluate-our-fit-by-plotting-the-residuals"><span>First we will evaluate our fit by plotting the residuals</span></a></li><li class="toplevel"><a class="tocitem" href="#These-look-reasonable,-although-there-may-be-some-minor-overfitting.-This-could-be"><span>These look reasonable, although there may be some minor overfitting. This could be</span></a></li><li class="toplevel"><a class="tocitem" href="#improved-in-a-few-ways,-but-that-is-beyond-the-goal-of-this-quick-tutorial."><span>improved in a few ways, but that is beyond the goal of this quick tutorial.</span></a></li><li class="toplevel"><a class="tocitem" href="#Plotting-the-image,-we-see-that-we-have-a-much-cleaner-version-of-the-closure-only-image-from"><span>Plotting the image, we see that we have a much cleaner version of the closure-only image from</span></a></li><li class="toplevel"><a class="tocitem" href="#[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref)."><span>Imaging a Black Hole using only Closure Quantities.</span></a></li><li class="toplevel"><a class="tocitem" href="#import-CairoMakie-as-CM"><span>import CairoMakie as CM</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.activate!(type-&quot;png&quot;,-px*per*unit3)-#hide"><span>CM.activate!(type = &quot;png&quot;, px<em>per</em>unit=3) #hide</span></a></li><li class="toplevel"><a class="tocitem" href="#Because-we-also-fit-the-instrument-model,-we-can-inspect-their-parameters."><span>Because we also fit the instrument model, we can inspect their parameters.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-do-this,-Comrade-provides-a-caltable-function-that-converts-the-flattened-gain-parameters"><span>To do this, <code>Comrade</code> provides a <code>caltable</code> function that converts the flattened gain parameters</span></a></li><li class="toplevel"><a class="tocitem" href="#to-a-tabular-format-based-on-the-time-and-its-segmentation."><span>to a tabular format based on the time and its segmentation.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-gain-phases-are-pretty-random,-although-much-of-this-is-due-to-us-picking-a-random"><span>The gain phases are pretty random, although much of this is due to us picking a random</span></a></li><li class="toplevel"><a class="tocitem" href="#reference-station-for-each-scan."><span>reference station for each scan.</span></a></li><li class="toplevel"><a class="tocitem" href="#Moving-onto-the-gain-amplitudes,-we-see-that-most-of-the-gain-variation-is-within-10%-as-expected"><span>Moving onto the gain amplitudes, we see that most of the gain variation is within 10% as expected</span></a></li><li class="toplevel"><a class="tocitem" href="#except-LMT,-which-has-massive-variations."><span>except LMT, which has massive variations.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-sample-from-the-posterior,-we-will-use-HMC,-specifically-the-NUTS-algorithm.-For"><span>To sample from the posterior, we will use HMC, specifically the NUTS algorithm. For</span></a></li><li class="toplevel"><a class="tocitem" href="#information-about-NUTS,"><span>information about NUTS,</span></a></li><li class="toplevel"><a class="tocitem" href="#see-Michael-Betancourt&#39;s-[notes](https://arxiv.org/abs/1701.02434)."><span>see Michael Betancourt&#39;s notes.</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-note"><span>!!! note</span></a></li><li class="toplevel"><a class="tocitem" href="#For-our-metric,-we-use-a-diagonal-matrix-due-to-easier-tuning"><span>For our <code>metric,</code> we use a diagonal matrix due to easier tuning</span></a></li><li class="toplevel"><a class="tocitem" href="#However,-due-to-the-need-to-sample-a-large-number-of-gain-parameters,-constructing-the-posterior"><span>However, due to the need to sample a large number of gain parameters, constructing the posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#is-rather-time-consuming.-Therefore,-for-this-tutorial,-we-will-only-do-a-quick-preliminary"><span>is rather time-consuming. Therefore, for this tutorial, we will only do a quick preliminary</span></a></li><li class="toplevel"><a class="tocitem" href="#run,-and-any-posterior"><span>run, and any posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#inferences-should-be-appropriately-skeptical."><span>inferences should be appropriately skeptical.</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-note-2"><span>!!! note</span></a></li><li class="toplevel"><a class="tocitem" href="#The-above-sampler-will-store-the-samples-in-memory,-i.e.-RAM.-For-large-models-this"><span>The above sampler will store the samples in memory, i.e. RAM. For large models this</span></a></li><li class="toplevel"><a class="tocitem" href="#can-lead-to-out-of-memory-issues.-To-fix-that-you-can-include-the-keyword-argument"><span>can lead to out-of-memory issues. To fix that you can include the keyword argument</span></a></li><li class="toplevel"><a class="tocitem" href="#saveto-DiskStore()-which-periodically-saves-the-samples-to-disk-limiting-memory"><span><code>saveto = DiskStore()</code> which periodically saves the samples to disk limiting memory</span></a></li><li class="toplevel"><a class="tocitem" href="#useage.-You-can-load-the-chain-using-load_table(diskout)-where-diskout-is"><span>useage. You can load the chain using <code>load_table(diskout)</code> where <code>diskout</code> is</span></a></li><li class="toplevel"><a class="tocitem" href="#the-object-returned-from-sample.-For-more-information-please-see-[ComradeAHMC](@ref)."><span>the object returned from sample. For more information please see ComradeAHMC.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-prune-the-adaptation-phase"><span>Now we prune the adaptation phase</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-warning-3"><span>!!! warning</span></a></li><li class="toplevel"><a class="tocitem" href="#This-should-be-run-for-likely-an-order-of-magnitude-more-steps-to-properly-estimate-expectations-of-the-posterior"><span>This should be run for likely an order of magnitude more steps to properly estimate expectations of the posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-that-we-have-our-posterior,-we-can-put-error-bars-on-all-of-our-plots-above."><span>Now that we have our posterior, we can put error bars on all of our plots above.</span></a></li><li class="toplevel"><a class="tocitem" href="#Let&#39;s-start-by-finding-the-mean-and-standard-deviation-of-the-gain-phases"><span>Let&#39;s start by finding the mean and standard deviation of the gain phases</span></a></li><li class="toplevel"><a class="tocitem" href="#and-now-the-gain-amplitudes"><span>and now the gain amplitudes</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-can-use-the-measurements-package-to-automatically-plot-everything-with-error-bars."><span>Now we can use the measurements package to automatically plot everything with error bars.</span></a></li><li class="toplevel"><a class="tocitem" href="#First-we-create-a-caltable-the-same-way-but-making-sure-all-of-our-variables-have-errors"><span>First we create a <code>caltable</code> the same way but making sure all of our variables have errors</span></a></li><li class="toplevel"><a class="tocitem" href="#attached-to-them."><span>attached to them.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-let&#39;s-plot-the-phase-curves"><span>Now let&#39;s plot the phase curves</span></a></li><li class="toplevel"><a class="tocitem" href="#and-now-the-amplitude-curves"><span>and now the amplitude curves</span></a></li><li class="toplevel"><a class="tocitem" href="#Finally-let&#39;s-construct-some-representative-image-reconstructions."><span>Finally let&#39;s construct some representative image reconstructions.</span></a></li><li class="toplevel"><a class="tocitem" href="#fig-CM.Figure(;resolution(400,-400))"><span>fig = CM.Figure(;resolution=(400, 400))</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image(fig[1,1],-mimg,"><span>CM.image(fig[1,1], mimg,</span></a></li><li class="toplevel"><a class="tocitem" href="#axis(xreversedtrue,-aspect1,-title&quot;Mean-Image&quot;),"><span>axis=(xreversed=true, aspect=1, title=&quot;Mean Image&quot;),</span></a></li><li class="toplevel"><a class="tocitem" href="#colormap:afmhot)"><span>colormap=:afmhot)</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image(fig[1,2],-simg./(max.(mimg,-1e-5)),"><span>CM.image(fig[1,2], simg./(max.(mimg, 1e-5)),</span></a></li><li class="toplevel"><a class="tocitem" href="#axis(xreversedtrue,-aspect1,-title&quot;1/SNR&quot;,),"><span>axis=(xreversed=true, aspect=1, title=&quot;1/SNR&quot;,),</span></a></li><li class="toplevel"><a class="tocitem" href="#colormap:afmhot)-2"><span>colormap=:afmhot)</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image(fig[2,1],-imgs[1],"><span>CM.image(fig[2,1], imgs[1],</span></a></li><li class="toplevel"><a class="tocitem" href="#axis(xreversedtrue,-aspect1,title&quot;Draw-1&quot;),"><span>axis=(xreversed=true, aspect=1,title=&quot;Draw 1&quot;),</span></a></li><li class="toplevel"><a class="tocitem" href="#colormap:afmhot)-3"><span>colormap=:afmhot)</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image(fig[2,2],-imgs[end],"><span>CM.image(fig[2,2], imgs[end],</span></a></li><li class="toplevel"><a class="tocitem" href="#axis(xreversedtrue,-aspect1,title&quot;Draw-2&quot;),"><span>axis=(xreversed=true, aspect=1,title=&quot;Draw 2&quot;),</span></a></li><li class="toplevel"><a class="tocitem" href="#colormap:afmhot)-4"><span>colormap=:afmhot)</span></a></li><li class="toplevel"><a class="tocitem" href="#fig"><span>fig</span></a></li><li class="toplevel"><a class="tocitem" href="#And-viola,-you-have-just-finished-making-a-preliminary-image-and-instrument-model-reconstruction."><span>And viola, you have just finished making a preliminary image and instrument model reconstruction.</span></a></li><li class="toplevel"><a class="tocitem" href="#In-reality,-you-should-run-the-sample-step-for-many-more-MCMC-steps-to-get-a-reliable-estimate"><span>In reality, you should run the <code>sample</code> step for many more MCMC steps to get a reliable estimate</span></a></li><li class="toplevel"><a class="tocitem" href="#for-the-reconstructed-image-and-instrument-model-parameters."><span>for the reconstructed image and instrument model parameters.</span></a></li></ul></li></ul></li><li><span class="tocitem">Libraries</span><ul><li><a class="tocitem" href="../../libs/optimization/">ComradeOptimization</a></li><li><a class="tocitem" href="../../libs/ahmc/">ComradeAHMC</a></li><li><a class="tocitem" href="../../libs/nested/">ComradeNested</a></li><li><a class="tocitem" href="../../libs/dynesty/">ComradeDynesty</a></li><li><a class="tocitem" href="../../libs/adaptmcmc/">ComradeAdaptMCMC</a></li></ul></li><li><a class="tocitem" href="../../base_api/">ComradeBase API</a></li><li><a class="tocitem" href="../../api/">Comrade API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Stokes I Simultaneous Image and Instrument Modeling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stokes I Simultaneous Image and Instrument Modeling</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ptiede/Comrade.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ptiede/Comrade.jl/blob/main/examples/StokesIImaging/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stokes-I-Simultaneous-Image-and-Instrument-Modeling"><a class="docs-heading-anchor" href="#Stokes-I-Simultaneous-Image-and-Instrument-Modeling">Stokes I Simultaneous Image and Instrument Modeling</a><a id="Stokes-I-Simultaneous-Image-and-Instrument-Modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Stokes-I-Simultaneous-Image-and-Instrument-Modeling" title="Permalink"></a></h1><h1 id="In-this-tutorial,-we-will-create-a-preliminary-reconstruction-of-the-2017-M87-data-on-April-6"><a class="docs-heading-anchor" href="#In-this-tutorial,-we-will-create-a-preliminary-reconstruction-of-the-2017-M87-data-on-April-6">In this tutorial, we will create a preliminary reconstruction of the 2017 M87 data on April 6</a><a id="In-this-tutorial,-we-will-create-a-preliminary-reconstruction-of-the-2017-M87-data-on-April-6-1"></a><a class="docs-heading-anchor-permalink" href="#In-this-tutorial,-we-will-create-a-preliminary-reconstruction-of-the-2017-M87-data-on-April-6" title="Permalink"></a></h1><h1 id="by-simultaneously-creating-an-image-and-model-for-the-instrument.-By-instrument-model,-we"><a class="docs-heading-anchor" href="#by-simultaneously-creating-an-image-and-model-for-the-instrument.-By-instrument-model,-we">by simultaneously creating an image and model for the instrument. By instrument model, we</a><a id="by-simultaneously-creating-an-image-and-model-for-the-instrument.-By-instrument-model,-we-1"></a><a class="docs-heading-anchor-permalink" href="#by-simultaneously-creating-an-image-and-model-for-the-instrument.-By-instrument-model,-we" title="Permalink"></a></h1><h1 id="mean-something-akin-to-self-calibration-in-traditional-VLBI-imaging-terminology.-However,"><a class="docs-heading-anchor" href="#mean-something-akin-to-self-calibration-in-traditional-VLBI-imaging-terminology.-However,">mean something akin to self-calibration in traditional VLBI imaging terminology. However,</a><a id="mean-something-akin-to-self-calibration-in-traditional-VLBI-imaging-terminology.-However,-1"></a><a class="docs-heading-anchor-permalink" href="#mean-something-akin-to-self-calibration-in-traditional-VLBI-imaging-terminology.-However," title="Permalink"></a></h1><h1 id="unlike-traditional-self-cal,-we-will-at-each-point-in-our-parameter-space-effectively-explore"><a class="docs-heading-anchor" href="#unlike-traditional-self-cal,-we-will-at-each-point-in-our-parameter-space-effectively-explore">unlike traditional self-cal, we will at each point in our parameter space effectively explore</a><a id="unlike-traditional-self-cal,-we-will-at-each-point-in-our-parameter-space-effectively-explore-1"></a><a class="docs-heading-anchor-permalink" href="#unlike-traditional-self-cal,-we-will-at-each-point-in-our-parameter-space-effectively-explore" title="Permalink"></a></h1><h1 id="the-possible-self-cal-solutions.-This-will-allow-us-to-constrain-and-marginalize-over-the"><a class="docs-heading-anchor" href="#the-possible-self-cal-solutions.-This-will-allow-us-to-constrain-and-marginalize-over-the">the possible self-cal solutions. This will allow us to constrain and marginalize over the</a><a id="the-possible-self-cal-solutions.-This-will-allow-us-to-constrain-and-marginalize-over-the-1"></a><a class="docs-heading-anchor-permalink" href="#the-possible-self-cal-solutions.-This-will-allow-us-to-constrain-and-marginalize-over-the" title="Permalink"></a></h1><h1 id="instrument-effects,-such-as-time-variable-gains."><a class="docs-heading-anchor" href="#instrument-effects,-such-as-time-variable-gains.">instrument effects, such as time variable gains.</a><a id="instrument-effects,-such-as-time-variable-gains.-1"></a><a class="docs-heading-anchor-permalink" href="#instrument-effects,-such-as-time-variable-gains." title="Permalink"></a></h1><h1 id="To-get-started-we-load-Comrade."><a class="docs-heading-anchor" href="#To-get-started-we-load-Comrade.">To get started we load Comrade.</a><a id="To-get-started-we-load-Comrade.-1"></a><a class="docs-heading-anchor-permalink" href="#To-get-started-we-load-Comrade." title="Permalink"></a></h1><p>import Pkg #hide __DIR = &quot;/home/runner/work/Comrade.jl/Comrade.jl/docs/../examples/StokesIImaging&quot; #hide</p><h1 id="pkg_io-open(joinpath(__DIR,-&quot;pkg.log&quot;),-&quot;w&quot;)-#hide"><a class="docs-heading-anchor" href="#pkg_io-open(joinpath(__DIR,-&quot;pkg.log&quot;),-&quot;w&quot;)-#hide">pkg_io = open(joinpath(__DIR, &quot;pkg.log&quot;), &quot;w&quot;) #hide</a><a id="pkg_io-open(joinpath(__DIR,-&quot;pkg.log&quot;),-&quot;w&quot;)-#hide-1"></a><a class="docs-heading-anchor-permalink" href="#pkg_io-open(joinpath(__DIR,-&quot;pkg.log&quot;),-&quot;w&quot;)-#hide" title="Permalink"></a></h1><p>Pkg.activate(<strong>DIR) #hide Pkg.develop(; path=joinpath(</strong>DIR, &quot;..&quot;, &quot;..&quot;)) #hide Pkg.instantiate(;) #hide Pkg.precompile(;) #hide</p><p>ENV[&quot;GKSwstype&quot;] = &quot;nul&quot; #hide</p><p>using Comrade</p><p>using Pyehtim using LinearAlgebra</p><h1 id="For-reproducibility-we-use-a-stable-random-number-genreator"><a class="docs-heading-anchor" href="#For-reproducibility-we-use-a-stable-random-number-genreator">For reproducibility we use a stable random number genreator</a><a id="For-reproducibility-we-use-a-stable-random-number-genreator-1"></a><a class="docs-heading-anchor-permalink" href="#For-reproducibility-we-use-a-stable-random-number-genreator" title="Permalink"></a></h1><p>using StableRNGs rng = StableRNG(12)</p><h1 id="-Load-the-Data"><a class="docs-heading-anchor" href="###-Load-the-Data">## Load the Data</a><a id="-Load-the-Data-1"></a><a class="docs-heading-anchor-permalink" href="###-Load-the-Data" title="Permalink"></a></h1><h1 id="To-download-the-data-visit-https://doi.org/10.25739/g85n-f134"><a class="docs-heading-anchor" href="#To-download-the-data-visit-https://doi.org/10.25739/g85n-f134">To download the data visit https://doi.org/10.25739/g85n-f134</a><a id="To-download-the-data-visit-https://doi.org/10.25739/g85n-f134-1"></a><a class="docs-heading-anchor-permalink" href="#To-download-the-data-visit-https://doi.org/10.25739/g85n-f134" title="Permalink"></a></h1><h1 id="First-we-will-load-our-data:"><a class="docs-heading-anchor" href="#First-we-will-load-our-data:">First we will load our data:</a><a id="First-we-will-load-our-data:-1"></a><a class="docs-heading-anchor-permalink" href="#First-we-will-load-our-data:" title="Permalink"></a></h1><p>obs = ehtim.obsdata.load<em>uvfits(joinpath(__DIR, &quot;../Data/SR1</em>M87<em>2017</em>096<em>lo</em>hops<em>netcal</em>StokesI.uvfits&quot;))</p><h1 id="Now-we-do-some-minor-preprocessing:"><a class="docs-heading-anchor" href="#Now-we-do-some-minor-preprocessing:">Now we do some minor preprocessing:</a><a id="Now-we-do-some-minor-preprocessing:-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-do-some-minor-preprocessing:" title="Permalink"></a></h1><h1 id="Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases"><a class="docs-heading-anchor" href="#Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases">- Scan average the data since the data have been preprocessed so that the gain phases</a><a id="Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases-1"></a><a class="docs-heading-anchor-permalink" href="#Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases" title="Permalink"></a></h1><h1 id="coherent."><a class="docs-heading-anchor" href="#coherent.">coherent.</a><a id="coherent.-1"></a><a class="docs-heading-anchor-permalink" href="#coherent." title="Permalink"></a></h1><h1 id="Add-1%-systematic-noise-to-deal-with-calibration-issues-that-cause-1%-non-closing-errors."><a class="docs-heading-anchor" href="#Add-1%-systematic-noise-to-deal-with-calibration-issues-that-cause-1%-non-closing-errors.">- Add 1% systematic noise to deal with calibration issues that cause 1% non-closing errors.</a><a id="Add-1%-systematic-noise-to-deal-with-calibration-issues-that-cause-1%-non-closing-errors.-1"></a><a class="docs-heading-anchor-permalink" href="#Add-1%-systematic-noise-to-deal-with-calibration-issues-that-cause-1%-non-closing-errors." title="Permalink"></a></h1><p>obs = scan<em>average(obs).add</em>fractional_noise(0.02)</p><h1 id="Now-we-extract-our-complex-visibilities."><a class="docs-heading-anchor" href="#Now-we-extract-our-complex-visibilities.">Now we extract our complex visibilities.</a><a id="Now-we-extract-our-complex-visibilities.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-extract-our-complex-visibilities." title="Permalink"></a></h1><p>dvis = extract_table(obs, ComplexVisibilities())</p><h1 id="Building-the-Model/Posterior"><a class="docs-heading-anchor" href="###Building-the-Model/Posterior">##Building the Model/Posterior</a><a id="Building-the-Model/Posterior-1"></a><a class="docs-heading-anchor-permalink" href="###Building-the-Model/Posterior" title="Permalink"></a></h1><h1 id="Now,-we-must-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a"><a class="docs-heading-anchor" href="#Now,-we-must-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a">Now, we must build our intensity/visibility model. That is, the model that takes in a</a><a id="Now,-we-must-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a-1"></a><a class="docs-heading-anchor-permalink" href="#Now,-we-must-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a" title="Permalink"></a></h1><h1 id="named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model."><a class="docs-heading-anchor" href="#named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model.">named tuple of parameters and perhaps some metadata required to construct the model.</a><a id="named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model.-1"></a><a class="docs-heading-anchor-permalink" href="#named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model." title="Permalink"></a></h1><h1 id="For-our-model,-we-will-use-a-raster-or-ContinuousImage-for-our-image-model."><a class="docs-heading-anchor" href="#For-our-model,-we-will-use-a-raster-or-ContinuousImage-for-our-image-model.">For our model, we will use a raster or <code>ContinuousImage</code> for our image model.</a><a id="For-our-model,-we-will-use-a-raster-or-ContinuousImage-for-our-image-model.-1"></a><a class="docs-heading-anchor-permalink" href="#For-our-model,-we-will-use-a-raster-or-ContinuousImage-for-our-image-model." title="Permalink"></a></h1><h1 id="The-model-is-given-below:"><a class="docs-heading-anchor" href="#The-model-is-given-below:">The model is given below:</a><a id="The-model-is-given-below:-1"></a><a class="docs-heading-anchor-permalink" href="#The-model-is-given-below:" title="Permalink"></a></h1><p>function sky(θ, metadata)     (;fg, c, σimg) = θ     (;ftot, K, meanpr, cache) = metadata     ## Transform to the log-ratio pixel fluxes     cp = meanpr .+ σimg.<em>c.params     ## Transform to image space     rast = (ftot</em>(1-fg))<em>K(to_simplex(AdditiveLR(), cp))     m = ContinuousImage(rast, cache)     ## Add a large-scale gaussian to deal with the over-resolved mas flux     g = modify(Gaussian(), Stretch(μas2rad(250.0), μas2rad(250.0)), Renormalize(ftot</em>fg))     return m + g end</p><h1 id="Unlike-other-imaging-examples"><a class="docs-heading-anchor" href="#Unlike-other-imaging-examples">Unlike other imaging examples</a><a id="Unlike-other-imaging-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Unlike-other-imaging-examples" title="Permalink"></a></h1><h1 id="(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include"><a class="docs-heading-anchor" href="#(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include">(e.g., <a href="../ClosureImaging/#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>) we also need to include</a><a id="(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include-1"></a><a class="docs-heading-anchor-permalink" href="#(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include" title="Permalink"></a></h1><h1 id="a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components"><a class="docs-heading-anchor" href="#a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components">a model for the instrument, i.e., gains as well. The gains will be broken into two components</a><a id="a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components-1"></a><a class="docs-heading-anchor-permalink" href="#a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components" title="Permalink"></a></h1><h1 id="Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%."><a class="docs-heading-anchor" href="#Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%.">- Gain amplitudes which are typically known to 10-20%, except for LMT, which has amplitudes closer to 50-100%.</a><a id="Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%.-1"></a><a class="docs-heading-anchor-permalink" href="#Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%." title="Permalink"></a></h1><h1 id="Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly."><a class="docs-heading-anchor" href="#Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly.">- Gain phases which are more difficult to constrain and can shift rapidly.</a><a id="Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly.-1"></a><a class="docs-heading-anchor-permalink" href="#Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly." title="Permalink"></a></h1><p>function instrument(θ, metadata)     (; lgamp, gphase) = θ     (; gcache, gcachep) = metadata     ## Now form our instrument model     gvis = exp.(lgamp)     gphase = exp.(1im.<em>gphase)     jgamp = jonesStokes(gvis, gcache)     jgphase = jonesStokes(gphase, gcachep)     return JonesModel(jgamp</em>jgphase) end</p><h1 id="The-model-construction-is-very-similar-to-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref),"><a class="docs-heading-anchor" href="#The-model-construction-is-very-similar-to-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref),">The model construction is very similar to <a href="../ClosureImaging/#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>,</a><a id="The-model-construction-is-very-similar-to-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref),-1"></a><a class="docs-heading-anchor-permalink" href="#The-model-construction-is-very-similar-to-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref)," title="Permalink"></a></h1><h1 id="except-we-include-a-large-scale-gaussian-since-we-want-to-model-the-zero-baselines."><a class="docs-heading-anchor" href="#except-we-include-a-large-scale-gaussian-since-we-want-to-model-the-zero-baselines.">except we include a large scale gaussian since we want to model the zero baselines.</a><a id="except-we-include-a-large-scale-gaussian-since-we-want-to-model-the-zero-baselines.-1"></a><a class="docs-heading-anchor-permalink" href="#except-we-include-a-large-scale-gaussian-since-we-want-to-model-the-zero-baselines." title="Permalink"></a></h1><h1 id="For-more-information-about-the-image-model"><a class="docs-heading-anchor" href="#For-more-information-about-the-image-model">For more information about the image model</a><a id="For-more-information-about-the-image-model-1"></a><a class="docs-heading-anchor-permalink" href="#For-more-information-about-the-image-model" title="Permalink"></a></h1><h1 id="please-read-the-closure-only-example.-Let&#39;s-discuss-the-instrument-model-[Comrade.JonesModel](@ref)."><a class="docs-heading-anchor" href="#please-read-the-closure-only-example.-Let&#39;s-discuss-the-instrument-model-[Comrade.JonesModel](@ref).">please read the closure-only example. Let&#39;s discuss the instrument model <a href="../../api/#Comrade.JonesModel"><code>Comrade.JonesModel</code></a>.</a><a id="please-read-the-closure-only-example.-Let&#39;s-discuss-the-instrument-model-[Comrade.JonesModel](@ref).-1"></a><a class="docs-heading-anchor-permalink" href="#please-read-the-closure-only-example.-Let&#39;s-discuss-the-instrument-model-[Comrade.JonesModel](@ref)." title="Permalink"></a></h1><h1 id="Thanks-to-the-EHT-pre-calibration,-the-gains-are-stable-over-scans.-Therefore,-we-can"><a class="docs-heading-anchor" href="#Thanks-to-the-EHT-pre-calibration,-the-gains-are-stable-over-scans.-Therefore,-we-can">Thanks to the EHT pre-calibration, the gains are stable over scans. Therefore, we can</a><a id="Thanks-to-the-EHT-pre-calibration,-the-gains-are-stable-over-scans.-Therefore,-we-can-1"></a><a class="docs-heading-anchor-permalink" href="#Thanks-to-the-EHT-pre-calibration,-the-gains-are-stable-over-scans.-Therefore,-we-can" title="Permalink"></a></h1><h1 id="model-the-gains-on-a-scan-by-scan-basis.-To-form-the-instrument-model,-we-need-our"><a class="docs-heading-anchor" href="#model-the-gains-on-a-scan-by-scan-basis.-To-form-the-instrument-model,-we-need-our">model the gains on a scan-by-scan basis. To form the instrument model, we need our</a><a id="model-the-gains-on-a-scan-by-scan-basis.-To-form-the-instrument-model,-we-need-our-1"></a><a class="docs-heading-anchor-permalink" href="#model-the-gains-on-a-scan-by-scan-basis.-To-form-the-instrument-model,-we-need-our" title="Permalink"></a></h1><h1 id="1.-Our-(log)-gain-amplitudes-and-phases-are-given-below-by-lgamp-and-gphase"><a class="docs-heading-anchor" href="#1.-Our-(log)-gain-amplitudes-and-phases-are-given-below-by-lgamp-and-gphase">1. Our (log) gain amplitudes and phases are given below by <code>lgamp</code> and <code>gphase</code></a><a id="1.-Our-(log)-gain-amplitudes-and-phases-are-given-below-by-lgamp-and-gphase-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Our-(log)-gain-amplitudes-and-phases-are-given-below-by-lgamp-and-gphase" title="Permalink"></a></h1><h1 id="2.-Our-function-or-cache-that-maps-the-gains-from-a-list-to-the-stations-they-impact-gcache."><a class="docs-heading-anchor" href="#2.-Our-function-or-cache-that-maps-the-gains-from-a-list-to-the-stations-they-impact-gcache.">2. Our function or cache that maps the gains from a list to the stations they impact <code>gcache.</code></a><a id="2.-Our-function-or-cache-that-maps-the-gains-from-a-list-to-the-stations-they-impact-gcache.-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Our-function-or-cache-that-maps-the-gains-from-a-list-to-the-stations-they-impact-gcache." title="Permalink"></a></h1><h1 id="3.-The-set-of-[Comrade.JonesPairs](@ref)-produced-by-[jonesStokes](@ref)"><a class="docs-heading-anchor" href="#3.-The-set-of-[Comrade.JonesPairs](@ref)-produced-by-[jonesStokes](@ref)">3. The set of <a href="../../api/#Comrade.JonesPairs"><code>Comrade.JonesPairs</code></a> produced by <a href="../../api/#Comrade.jonesStokes"><code>jonesStokes</code></a></a><a id="3.-The-set-of-[Comrade.JonesPairs](@ref)-produced-by-[jonesStokes](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#3.-The-set-of-[Comrade.JonesPairs](@ref)-produced-by-[jonesStokes](@ref)" title="Permalink"></a></h1><h1 id="These-three-ingredients-then-specify-our-instrument-model.-The-instrument-model-can-then-be"><a class="docs-heading-anchor" href="#These-three-ingredients-then-specify-our-instrument-model.-The-instrument-model-can-then-be">These three ingredients then specify our instrument model. The instrument model can then be</a><a id="These-three-ingredients-then-specify-our-instrument-model.-The-instrument-model-can-then-be-1"></a><a class="docs-heading-anchor-permalink" href="#These-three-ingredients-then-specify-our-instrument-model.-The-instrument-model-can-then-be" title="Permalink"></a></h1><h1 id="combined-with-our-image-model-cimg-to-form-the-total-JonesModel."><a class="docs-heading-anchor" href="#combined-with-our-image-model-cimg-to-form-the-total-JonesModel.">combined with our image model <code>cimg</code> to form the total <code>JonesModel</code>.</a><a id="combined-with-our-image-model-cimg-to-form-the-total-JonesModel.-1"></a><a class="docs-heading-anchor-permalink" href="#combined-with-our-image-model-cimg-to-form-the-total-JonesModel." title="Permalink"></a></h1><h1 id="Now,-let&#39;s-set-up-our-image-model.-The-EHT&#39;s-nominal-resolution-is-20-25-μas.-Additionally,"><a class="docs-heading-anchor" href="#Now,-let&#39;s-set-up-our-image-model.-The-EHT&#39;s-nominal-resolution-is-20-25-μas.-Additionally,">Now, let&#39;s set up our image model. The EHT&#39;s nominal resolution is 20-25 μas. Additionally,</a><a id="Now,-let&#39;s-set-up-our-image-model.-The-EHT&#39;s-nominal-resolution-is-20-25-μas.-Additionally,-1"></a><a class="docs-heading-anchor-permalink" href="#Now,-let&#39;s-set-up-our-image-model.-The-EHT&#39;s-nominal-resolution-is-20-25-μas.-Additionally," title="Permalink"></a></h1><h1 id="the-EHT-is-not-very-sensitive-to-a-larger-field-of-view.-Typically-60-80-μas-is-enough-to"><a class="docs-heading-anchor" href="#the-EHT-is-not-very-sensitive-to-a-larger-field-of-view.-Typically-60-80-μas-is-enough-to">the EHT is not very sensitive to a larger field of view. Typically 60-80 μas is enough to</a><a id="the-EHT-is-not-very-sensitive-to-a-larger-field-of-view.-Typically-60-80-μas-is-enough-to-1"></a><a class="docs-heading-anchor-permalink" href="#the-EHT-is-not-very-sensitive-to-a-larger-field-of-view.-Typically-60-80-μas-is-enough-to" title="Permalink"></a></h1><h1 id="describe-the-compact-flux-of-M87.-Given-this,-we-only-need-to-use-a-small-number-of-pixels"><a class="docs-heading-anchor" href="#describe-the-compact-flux-of-M87.-Given-this,-we-only-need-to-use-a-small-number-of-pixels">describe the compact flux of M87. Given this, we only need to use a small number of pixels</a><a id="describe-the-compact-flux-of-M87.-Given-this,-we-only-need-to-use-a-small-number-of-pixels-1"></a><a class="docs-heading-anchor-permalink" href="#describe-the-compact-flux-of-M87.-Given-this,-we-only-need-to-use-a-small-number-of-pixels" title="Permalink"></a></h1><h1 id="to-describe-our-image."><a class="docs-heading-anchor" href="#to-describe-our-image.">to describe our image.</a><a id="to-describe-our-image.-1"></a><a class="docs-heading-anchor-permalink" href="#to-describe-our-image." title="Permalink"></a></h1><p>npix = 42 fovx = μas2rad(150.0) fovy = μas2rad(150.0)</p><h1 id="Now-let&#39;s-form-our-cache&#39;s.-First,-we-have-our-usual-image-cache-which-is-needed-to-numerically"><a class="docs-heading-anchor" href="#Now-let&#39;s-form-our-cache&#39;s.-First,-we-have-our-usual-image-cache-which-is-needed-to-numerically">Now let&#39;s form our cache&#39;s. First, we have our usual image cache which is needed to numerically</a><a id="Now-let&#39;s-form-our-cache&#39;s.-First,-we-have-our-usual-image-cache-which-is-needed-to-numerically-1"></a><a class="docs-heading-anchor-permalink" href="#Now-let&#39;s-form-our-cache&#39;s.-First,-we-have-our-usual-image-cache-which-is-needed-to-numerically" title="Permalink"></a></h1><h1 id="compute-the-visibilities."><a class="docs-heading-anchor" href="#compute-the-visibilities.">compute the visibilities.</a><a id="compute-the-visibilities.-1"></a><a class="docs-heading-anchor-permalink" href="#compute-the-visibilities." title="Permalink"></a></h1><p>grid = imagepixels(fovx, fovy, npix, npix) cache = create_cache(NFFTAlg(dvis), grid, BSplinePulse{3}())</p><p>using VLBIImagePriors</p><h1 id="Now-we-need-to-specify-our-image-prior.-For-this-work-we-will-use-a-Gaussian-Markov"><a class="docs-heading-anchor" href="#Now-we-need-to-specify-our-image-prior.-For-this-work-we-will-use-a-Gaussian-Markov">Now we need to specify our image prior. For this work we will use a Gaussian Markov</a><a id="Now-we-need-to-specify-our-image-prior.-For-this-work-we-will-use-a-Gaussian-Markov-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-need-to-specify-our-image-prior.-For-this-work-we-will-use-a-Gaussian-Markov" title="Permalink"></a></h1><h1 id="Random-field-prior"><a class="docs-heading-anchor" href="#Random-field-prior">Random field prior</a><a id="Random-field-prior-1"></a><a class="docs-heading-anchor-permalink" href="#Random-field-prior" title="Permalink"></a></h1><h1 id="Since-we-are-using-a-Gaussian-Markov-random-field-prior-we-need-to-first-specify-our-mean"><a class="docs-heading-anchor" href="#Since-we-are-using-a-Gaussian-Markov-random-field-prior-we-need-to-first-specify-our-mean">Since we are using a Gaussian Markov random field prior we need to first specify our <code>mean</code></a><a id="Since-we-are-using-a-Gaussian-Markov-random-field-prior-we-need-to-first-specify-our-mean-1"></a><a class="docs-heading-anchor-permalink" href="#Since-we-are-using-a-Gaussian-Markov-random-field-prior-we-need-to-first-specify-our-mean" title="Permalink"></a></h1><h1 id="image.-This-behaves-somewhat-similary-to-a-entropy-regularizer-in-that-it-will"><a class="docs-heading-anchor" href="#image.-This-behaves-somewhat-similary-to-a-entropy-regularizer-in-that-it-will">image. This behaves somewhat similary to a entropy regularizer in that it will</a><a id="image.-This-behaves-somewhat-similary-to-a-entropy-regularizer-in-that-it-will-1"></a><a class="docs-heading-anchor-permalink" href="#image.-This-behaves-somewhat-similary-to-a-entropy-regularizer-in-that-it-will" title="Permalink"></a></h1><h1 id="start-with-an-initial-guess-for-the-image-structure.-For-this-tutorial-we-will-use-a"><a class="docs-heading-anchor" href="#start-with-an-initial-guess-for-the-image-structure.-For-this-tutorial-we-will-use-a">start with an initial guess for the image structure. For this tutorial we will use a</a><a id="start-with-an-initial-guess-for-the-image-structure.-For-this-tutorial-we-will-use-a-1"></a><a class="docs-heading-anchor-permalink" href="#start-with-an-initial-guess-for-the-image-structure.-For-this-tutorial-we-will-use-a" title="Permalink"></a></h1><h1 id="a-symmetric-Gaussian-with-a-FWHM-of-50-μas"><a class="docs-heading-anchor" href="#a-symmetric-Gaussian-with-a-FWHM-of-50-μas">a symmetric Gaussian with a FWHM of 50 μas</a><a id="a-symmetric-Gaussian-with-a-FWHM-of-50-μas-1"></a><a class="docs-heading-anchor-permalink" href="#a-symmetric-Gaussian-with-a-FWHM-of-50-μas" title="Permalink"></a></h1><p>fwhmfac = 2<em>sqrt(2</em>log(2)) mpr = modify(Gaussian(), Stretch(μas2rad(40.0)./fwhmfac)) imgpr = intensitymap(mpr, grid)</p><h1 id="Now-since-we-are-actually-modeling-our-image-on-the-simplex-we-need-to-ensure-that"><a class="docs-heading-anchor" href="#Now-since-we-are-actually-modeling-our-image-on-the-simplex-we-need-to-ensure-that">Now since we are actually modeling our image on the simplex we need to ensure that</a><a id="Now-since-we-are-actually-modeling-our-image-on-the-simplex-we-need-to-ensure-that-1"></a><a class="docs-heading-anchor-permalink" href="#Now-since-we-are-actually-modeling-our-image-on-the-simplex-we-need-to-ensure-that" title="Permalink"></a></h1><h1 id="our-mean-image-has-unit-flux"><a class="docs-heading-anchor" href="#our-mean-image-has-unit-flux">our mean image has unit flux</a><a id="our-mean-image-has-unit-flux-1"></a><a class="docs-heading-anchor-permalink" href="#our-mean-image-has-unit-flux" title="Permalink"></a></h1><p>imgpr ./= flux(imgpr)</p><h1 id="and-since-our-prior-is-not-on-the-simplex-we-need-to-convert-it-to-unconstrained-or-real-space."><a class="docs-heading-anchor" href="#and-since-our-prior-is-not-on-the-simplex-we-need-to-convert-it-to-unconstrained-or-real-space.">and since our prior is not on the simplex we need to convert it to <code>unconstrained or real space</code>.</a><a id="and-since-our-prior-is-not-on-the-simplex-we-need-to-convert-it-to-unconstrained-or-real-space.-1"></a><a class="docs-heading-anchor-permalink" href="#and-since-our-prior-is-not-on-the-simplex-we-need-to-convert-it-to-unconstrained-or-real-space." title="Permalink"></a></h1><p>meanpr = to_real(AdditiveLR(), Comrade.baseimage(imgpr))</p><h1 id="Now-we-can-form-our-metadata-we-need-to-fully-define-our-model."><a class="docs-heading-anchor" href="#Now-we-can-form-our-metadata-we-need-to-fully-define-our-model.">Now we can form our metadata we need to fully define our model.</a><a id="Now-we-can-form-our-metadata-we-need-to-fully-define-our-model.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-can-form-our-metadata-we-need-to-fully-define-our-model." title="Permalink"></a></h1><h1 id="We-will-also-fix-the-total-flux-to-be-the-observed-value-1.1.-This-is-because"><a class="docs-heading-anchor" href="#We-will-also-fix-the-total-flux-to-be-the-observed-value-1.1.-This-is-because">We will also fix the total flux to be the observed value 1.1. This is because</a><a id="We-will-also-fix-the-total-flux-to-be-the-observed-value-1.1.-This-is-because-1"></a><a class="docs-heading-anchor-permalink" href="#We-will-also-fix-the-total-flux-to-be-the-observed-value-1.1.-This-is-because" title="Permalink"></a></h1><h1 id="total-flux-is-degenerate-with-a-global-shift-in-the-gain-amplitudes-making-the-problem"><a class="docs-heading-anchor" href="#total-flux-is-degenerate-with-a-global-shift-in-the-gain-amplitudes-making-the-problem">total flux is degenerate with a global shift in the gain amplitudes making the problem</a><a id="total-flux-is-degenerate-with-a-global-shift-in-the-gain-amplitudes-making-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#total-flux-is-degenerate-with-a-global-shift-in-the-gain-amplitudes-making-the-problem" title="Permalink"></a></h1><h1 id="degenerate.-To-fix-this-we-use-the-observed-total-flux-as-our-value."><a class="docs-heading-anchor" href="#degenerate.-To-fix-this-we-use-the-observed-total-flux-as-our-value.">degenerate. To fix this we use the observed total flux as our value.</a><a id="degenerate.-To-fix-this-we-use-the-observed-total-flux-as-our-value.-1"></a><a class="docs-heading-anchor-permalink" href="#degenerate.-To-fix-this-we-use-the-observed-total-flux-as-our-value." title="Permalink"></a></h1><p>skymeta = (;ftot = 1.1, cache, K=CenterImage(grid), meanpr)</p><h1 id="Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains"><a class="docs-heading-anchor" href="#Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains">Second, we now construct our instrument model cache. This tells us how to map from the gains</a><a id="Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains-1"></a><a class="docs-heading-anchor-permalink" href="#Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains" title="Permalink"></a></h1><h1 id="to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation"><a class="docs-heading-anchor" href="#to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation">to the model visibilities. However, to construct this map, we also need to specify the observation</a><a id="to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation-1"></a><a class="docs-heading-anchor-permalink" href="#to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation" title="Permalink"></a></h1><h1 id="segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument"><a class="docs-heading-anchor" href="#segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument">segmentation over which we expect the gains to change. This is specified in the second argument</a><a id="segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument-1"></a><a class="docs-heading-anchor-permalink" href="#segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument" title="Permalink"></a></h1><h1 id="to-jonescache,-and-currently,-there-are-two-options"><a class="docs-heading-anchor" href="#to-jonescache,-and-currently,-there-are-two-options">to <code>jonescache</code>, and currently, there are two options</a><a id="to-jonescache,-and-currently,-there-are-two-options-1"></a><a class="docs-heading-anchor-permalink" href="#to-jonescache,-and-currently,-there-are-two-options" title="Permalink"></a></h1><h1 id="FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations"><a class="docs-heading-anchor" href="#FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations">- <code>FixedSeg(val)</code>: Fixes the corruption to the value <code>val</code> for all time. This is usefule for reference stations</a><a id="FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations-1"></a><a class="docs-heading-anchor-permalink" href="#FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations" title="Permalink"></a></h1><h1 id="ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan"><a class="docs-heading-anchor" href="#ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan">- <code>ScanSeg()</code>: which forces the corruptions to only change from scan-to-scan</a><a id="ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan-1"></a><a class="docs-heading-anchor-permalink" href="#ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan" title="Permalink"></a></h1><h1 id="TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation"><a class="docs-heading-anchor" href="#TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation">- <code>TrackSeg()</code>: which forces the corruptions to be constant over a night&#39;s observation</a><a id="TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation-1"></a><a class="docs-heading-anchor-permalink" href="#TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation" title="Permalink"></a></h1><h1 id="For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly"><a class="docs-heading-anchor" href="#For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly">For this work, we use the scan segmentation for the gain amplitudes since that is roughly</a><a id="For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly-1"></a><a class="docs-heading-anchor-permalink" href="#For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly" title="Permalink"></a></h1><h1 id="the-timescale-we-expect-them-to-vary.-For-the-phases-we-use-a-station-specific-scheme-where"><a class="docs-heading-anchor" href="#the-timescale-we-expect-them-to-vary.-For-the-phases-we-use-a-station-specific-scheme-where">the timescale we expect them to vary. For the phases we use a station specific scheme where</a><a id="the-timescale-we-expect-them-to-vary.-For-the-phases-we-use-a-station-specific-scheme-where-1"></a><a class="docs-heading-anchor-permalink" href="#the-timescale-we-expect-them-to-vary.-For-the-phases-we-use-a-station-specific-scheme-where" title="Permalink"></a></h1><h1 id="we-set-AA-to-be-fixed-to-unit-gain-because-it-will-function-as-a-reference-station."><a class="docs-heading-anchor" href="#we-set-AA-to-be-fixed-to-unit-gain-because-it-will-function-as-a-reference-station.">we set AA to be fixed to unit gain because it will function as a reference station.</a><a id="we-set-AA-to-be-fixed-to-unit-gain-because-it-will-function-as-a-reference-station.-1"></a><a class="docs-heading-anchor-permalink" href="#we-set-AA-to-be-fixed-to-unit-gain-because-it-will-function-as-a-reference-station." title="Permalink"></a></h1><p>gcache = jonescache(dvis, ScanSeg()) gcachep = jonescache(dvis, ScanSeg(); autoref=SEFDReference((complex(1.0))))</p><h1 id="This-information-can-then-be-passed-through-our-instrument-model-as-metadata."><a class="docs-heading-anchor" href="#This-information-can-then-be-passed-through-our-instrument-model-as-metadata.">This information can then be passed through our instrument model as metadata.</a><a id="This-information-can-then-be-passed-through-our-instrument-model-as-metadata.-1"></a><a class="docs-heading-anchor-permalink" href="#This-information-can-then-be-passed-through-our-instrument-model-as-metadata." title="Permalink"></a></h1><h1 id="Future-versions-of-Comrade-will-do-this-for-you-automatically."><a class="docs-heading-anchor" href="#Future-versions-of-Comrade-will-do-this-for-you-automatically.">Future versions of Comrade will do this for you automatically.</a><a id="Future-versions-of-Comrade-will-do-this-for-you-automatically.-1"></a><a class="docs-heading-anchor-permalink" href="#Future-versions-of-Comrade-will-do-this-for-you-automatically." title="Permalink"></a></h1><p>instrumentmeta = (;gcache, gcachep)</p><h1 id="Moving-onto-our-prior,-we-first-focus-on-the-instrument-model-priors."><a class="docs-heading-anchor" href="#Moving-onto-our-prior,-we-first-focus-on-the-instrument-model-priors.">Moving onto our prior, we first focus on the instrument model priors.</a><a id="Moving-onto-our-prior,-we-first-focus-on-the-instrument-model-priors.-1"></a><a class="docs-heading-anchor-permalink" href="#Moving-onto-our-prior,-we-first-focus-on-the-instrument-model-priors." title="Permalink"></a></h1><h1 id="Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases."><a class="docs-heading-anchor" href="#Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases.">Each station requires its own prior on both the amplitudes and phases.</a><a id="Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases.-1"></a><a class="docs-heading-anchor-permalink" href="#Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases." title="Permalink"></a></h1><h1 id="For-the-amplitudes"><a class="docs-heading-anchor" href="#For-the-amplitudes">For the amplitudes</a><a id="For-the-amplitudes-1"></a><a class="docs-heading-anchor-permalink" href="#For-the-amplitudes" title="Permalink"></a></h1><h1 id="we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)"><a class="docs-heading-anchor" href="#we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)">we assume that the gains are apriori well calibrated around unit gains (or 0 log gain amplitudes)</a><a id="we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)-1"></a><a class="docs-heading-anchor-permalink" href="#we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)" title="Permalink"></a></h1><h1 id="which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for"><a class="docs-heading-anchor" href="#which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for">which corresponds to no instrument corruption. The gain dispersion is then set to 10% for</a><a id="which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for-1"></a><a class="docs-heading-anchor-permalink" href="#which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for" title="Permalink"></a></h1><h1 id="all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT"><a class="docs-heading-anchor" href="#all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT">all stations except LMT, representing that we expect 10% deviations from scan-to-scan. For LMT</a><a id="all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT-1"></a><a class="docs-heading-anchor-permalink" href="#all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT" title="Permalink"></a></h1><h1 id="we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017."><a class="docs-heading-anchor" href="#we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017.">we let the prior expand to 100% due to the known pointing issues LMT had in 2017.</a><a id="we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017.-1"></a><a class="docs-heading-anchor-permalink" href="#we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017." title="Permalink"></a></h1><p>using Distributions using DistributionsAD distamp = station_tuple(dvis, Normal(0.0, 0.1); LM = Normal(1.0))</p><h1 id="For-the-phases,-we-will-use-a-unconstrained-white-noise-prior,-where-the"><a class="docs-heading-anchor" href="#For-the-phases,-we-will-use-a-unconstrained-white-noise-prior,-where-the">For the phases, we will use a unconstrained white noise prior, where the</a><a id="For-the-phases,-we-will-use-a-unconstrained-white-noise-prior,-where-the-1"></a><a class="docs-heading-anchor-permalink" href="#For-the-phases,-we-will-use-a-unconstrained-white-noise-prior,-where-the" title="Permalink"></a></h1><h1 id="gain-phase-is-fit-independtly-fit-for-each-scan.-Since-the-phases-are-periodic"><a class="docs-heading-anchor" href="#gain-phase-is-fit-independtly-fit-for-each-scan.-Since-the-phases-are-periodic">gain phase is fit independtly fit for each scan. Since the phases are periodic</a><a id="gain-phase-is-fit-independtly-fit-for-each-scan.-Since-the-phases-are-periodic-1"></a><a class="docs-heading-anchor-permalink" href="#gain-phase-is-fit-independtly-fit-for-each-scan.-Since-the-phases-are-periodic" title="Permalink"></a></h1><h1 id="we-use-a-von-Mises-prior-with-concentration-parameter-(similar-to-inverse-variance)"><a class="docs-heading-anchor" href="#we-use-a-von-Mises-prior-with-concentration-parameter-(similar-to-inverse-variance)">we use a von-Mises prior with concentration parameter (similar to inverse variance)</a><a id="we-use-a-von-Mises-prior-with-concentration-parameter-(similar-to-inverse-variance)-1"></a><a class="docs-heading-anchor-permalink" href="#we-use-a-von-Mises-prior-with-concentration-parameter-(similar-to-inverse-variance)" title="Permalink"></a></h1><h1 id="1/π2."><a class="docs-heading-anchor" href="#1/π2.">1/π^2.</a><a id="1/π2.-1"></a><a class="docs-heading-anchor-permalink" href="#1/π2." title="Permalink"></a></h1><p>distphase = station_tuple(dvis, DiagonalVonMises(0.0, inv(π^2)))</p><h1 id="In-addition-we-want-a-reasonable-guess-for-what-the-resolution-of-our-image-should-be."><a class="docs-heading-anchor" href="#In-addition-we-want-a-reasonable-guess-for-what-the-resolution-of-our-image-should-be.">In addition we want a reasonable guess for what the resolution of our image should be.</a><a id="In-addition-we-want-a-reasonable-guess-for-what-the-resolution-of-our-image-should-be.-1"></a><a class="docs-heading-anchor-permalink" href="#In-addition-we-want-a-reasonable-guess-for-what-the-resolution-of-our-image-should-be." title="Permalink"></a></h1><h1 id="For-radio-astronomy-this-is-given-by-roughly-the-longest-baseline-in-the-image.-To-put-this"><a class="docs-heading-anchor" href="#For-radio-astronomy-this-is-given-by-roughly-the-longest-baseline-in-the-image.-To-put-this">For radio astronomy this is given by roughly the longest baseline in the image. To put this</a><a id="For-radio-astronomy-this-is-given-by-roughly-the-longest-baseline-in-the-image.-To-put-this-1"></a><a class="docs-heading-anchor-permalink" href="#For-radio-astronomy-this-is-given-by-roughly-the-longest-baseline-in-the-image.-To-put-this" title="Permalink"></a></h1><h1 id="into-pixel-space-we-then-divide-by-the-pixel-size."><a class="docs-heading-anchor" href="#into-pixel-space-we-then-divide-by-the-pixel-size.">into pixel space we then divide by the pixel size.</a><a id="into-pixel-space-we-then-divide-by-the-pixel-size.-1"></a><a class="docs-heading-anchor-permalink" href="#into-pixel-space-we-then-divide-by-the-pixel-size." title="Permalink"></a></h1><p>beam = beamsize(dvis) rat = (beam/(step(grid.X)))</p><h1 id="To-make-the-Gaussian-Markov-random-field-efficient-we-first-precompute-a-bunch-of-quantities"><a class="docs-heading-anchor" href="#To-make-the-Gaussian-Markov-random-field-efficient-we-first-precompute-a-bunch-of-quantities">To make the Gaussian Markov random field efficient we first precompute a bunch of quantities</a><a id="To-make-the-Gaussian-Markov-random-field-efficient-we-first-precompute-a-bunch-of-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#To-make-the-Gaussian-Markov-random-field-efficient-we-first-precompute-a-bunch-of-quantities" title="Permalink"></a></h1><h1 id="that-allow-us-to-scale-things-linearly-with-the-number-of-image-pixels.-The-returns-a"><a class="docs-heading-anchor" href="#that-allow-us-to-scale-things-linearly-with-the-number-of-image-pixels.-The-returns-a">that allow us to scale things linearly with the number of image pixels. The returns a</a><a id="that-allow-us-to-scale-things-linearly-with-the-number-of-image-pixels.-The-returns-a-1"></a><a class="docs-heading-anchor-permalink" href="#that-allow-us-to-scale-things-linearly-with-the-number-of-image-pixels.-The-returns-a" title="Permalink"></a></h1><h1 id="functional-that-accepts-a-single-argument-related-to-the-correlation-length-of-the-field."><a class="docs-heading-anchor" href="#functional-that-accepts-a-single-argument-related-to-the-correlation-length-of-the-field.">functional that accepts a single argument related to the correlation length of the field.</a><a id="functional-that-accepts-a-single-argument-related-to-the-correlation-length-of-the-field.-1"></a><a class="docs-heading-anchor-permalink" href="#functional-that-accepts-a-single-argument-related-to-the-correlation-length-of-the-field." title="Permalink"></a></h1><h1 id="The-second-argument-defines-the-underlying-random-field-of-the-Markov-process.-Here"><a class="docs-heading-anchor" href="#The-second-argument-defines-the-underlying-random-field-of-the-Markov-process.-Here">The second argument defines the underlying random field of the Markov process. Here</a><a id="The-second-argument-defines-the-underlying-random-field-of-the-Markov-process.-Here-1"></a><a class="docs-heading-anchor-permalink" href="#The-second-argument-defines-the-underlying-random-field-of-the-Markov-process.-Here" title="Permalink"></a></h1><h1 id="we-are-using-a-zero-mean-and-unit-variance-Gaussian-Markov-random-field.-The-keyword"><a class="docs-heading-anchor" href="#we-are-using-a-zero-mean-and-unit-variance-Gaussian-Markov-random-field.-The-keyword">we are using a zero mean and unit variance Gaussian Markov random field. The keyword</a><a id="we-are-using-a-zero-mean-and-unit-variance-Gaussian-Markov-random-field.-The-keyword-1"></a><a class="docs-heading-anchor-permalink" href="#we-are-using-a-zero-mean-and-unit-variance-Gaussian-Markov-random-field.-The-keyword" title="Permalink"></a></h1><h1 id="argument-specifies-the-order-of-the-Gaussian-field.-Currently,-we-recommend-using-order"><a class="docs-heading-anchor" href="#argument-specifies-the-order-of-the-Gaussian-field.-Currently,-we-recommend-using-order">argument specifies the order of the Gaussian field. Currently, we recommend using order</a><a id="argument-specifies-the-order-of-the-Gaussian-field.-Currently,-we-recommend-using-order-1"></a><a class="docs-heading-anchor-permalink" href="#argument-specifies-the-order-of-the-Gaussian-field.-Currently,-we-recommend-using-order" title="Permalink"></a></h1><h1 id="1-which-is-identical-to-TSV-variation-and-L-regularization"><a class="docs-heading-anchor" href="#1-which-is-identical-to-TSV-variation-and-L-regularization">- 1 which is identical to TSV variation and L₂ regularization</a><a id="1-which-is-identical-to-TSV-variation-and-L-regularization-1"></a><a class="docs-heading-anchor-permalink" href="#1-which-is-identical-to-TSV-variation-and-L-regularization" title="Permalink"></a></h1><h1 id="2-which-is-identical-to-a-Matern-1-process-in-2D-and-is-really-the-convolution-of-two"><a class="docs-heading-anchor" href="#2-which-is-identical-to-a-Matern-1-process-in-2D-and-is-really-the-convolution-of-two">- 2 which is identical to a Matern 1 process in 2D and is really the convolution of two</a><a id="2-which-is-identical-to-a-Matern-1-process-in-2D-and-is-really-the-convolution-of-two-1"></a><a class="docs-heading-anchor-permalink" href="#2-which-is-identical-to-a-Matern-1-process-in-2D-and-is-really-the-convolution-of-two" title="Permalink"></a></h1><h1 id="order-1-processes"><a class="docs-heading-anchor" href="#order-1-processes">order 1 processes</a><a id="order-1-processes-1"></a><a class="docs-heading-anchor-permalink" href="#order-1-processes" title="Permalink"></a></h1><h1 id="For-this-tutorial-we-will-use-the-first-order-random-field"><a class="docs-heading-anchor" href="#For-this-tutorial-we-will-use-the-first-order-random-field">For this tutorial we will use the first order random field</a><a id="For-this-tutorial-we-will-use-the-first-order-random-field-1"></a><a class="docs-heading-anchor-permalink" href="#For-this-tutorial-we-will-use-the-first-order-random-field" title="Permalink"></a></h1><p>crcache = ConditionalMarkov(GMRF, grid; order=1)</p><h1 id="To-demonstrate-the-prior-let-create-a-few-random-realizations"><a class="docs-heading-anchor" href="#To-demonstrate-the-prior-let-create-a-few-random-realizations">To demonstrate the prior let create a few random realizations</a><a id="To-demonstrate-the-prior-let-create-a-few-random-realizations-1"></a><a class="docs-heading-anchor-permalink" href="#To-demonstrate-the-prior-let-create-a-few-random-realizations" title="Permalink"></a></h1><h1 id="Now-we-can-finally-form-our-image-prior.-For-this-we-use-a-heirarchical-prior-where-the"><a class="docs-heading-anchor" href="#Now-we-can-finally-form-our-image-prior.-For-this-we-use-a-heirarchical-prior-where-the">Now we can finally form our image prior. For this we use a heirarchical prior where the</a><a id="Now-we-can-finally-form-our-image-prior.-For-this-we-use-a-heirarchical-prior-where-the-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-can-finally-form-our-image-prior.-For-this-we-use-a-heirarchical-prior-where-the" title="Permalink"></a></h1><h1 id="inverse-correlation-length-is-given-by-a-Half-Normal-distribution-whose-peak-is-at-zero-and"><a class="docs-heading-anchor" href="#inverse-correlation-length-is-given-by-a-Half-Normal-distribution-whose-peak-is-at-zero-and">inverse correlation length is given by a Half-Normal distribution whose peak is at zero and</a><a id="inverse-correlation-length-is-given-by-a-Half-Normal-distribution-whose-peak-is-at-zero-and-1"></a><a class="docs-heading-anchor-permalink" href="#inverse-correlation-length-is-given-by-a-Half-Normal-distribution-whose-peak-is-at-zero-and" title="Permalink"></a></h1><h1 id="standard-deviation-is-0.1/rat-where-recall-rat-is-the-beam-size-per-pixel."><a class="docs-heading-anchor" href="#standard-deviation-is-0.1/rat-where-recall-rat-is-the-beam-size-per-pixel.">standard deviation is <code>0.1/rat</code> where recall <code>rat</code> is the beam size per pixel.</a><a id="standard-deviation-is-0.1/rat-where-recall-rat-is-the-beam-size-per-pixel.-1"></a><a class="docs-heading-anchor-permalink" href="#standard-deviation-is-0.1/rat-where-recall-rat-is-the-beam-size-per-pixel." title="Permalink"></a></h1><h1 id="For-the-variance-of-the-random-field-we-use-another"><a class="docs-heading-anchor" href="#For-the-variance-of-the-random-field-we-use-another">For the variance of the random field we use another</a><a id="For-the-variance-of-the-random-field-we-use-another-1"></a><a class="docs-heading-anchor-permalink" href="#For-the-variance-of-the-random-field-we-use-another" title="Permalink"></a></h1><h1 id="half-normal-prior-with-standard-deviation-0.1.-The-reason-we-use-the-half-normal-priors-is"><a class="docs-heading-anchor" href="#half-normal-prior-with-standard-deviation-0.1.-The-reason-we-use-the-half-normal-priors-is">half normal prior with standard deviation 0.1. The reason we use the half-normal priors is</a><a id="half-normal-prior-with-standard-deviation-0.1.-The-reason-we-use-the-half-normal-priors-is-1"></a><a class="docs-heading-anchor-permalink" href="#half-normal-prior-with-standard-deviation-0.1.-The-reason-we-use-the-half-normal-priors-is" title="Permalink"></a></h1><h1 id="to-prefer-&quot;simple&quot;-structures.-Gaussian-Markov-random-fields-are-extremly-flexible-models,"><a class="docs-heading-anchor" href="#to-prefer-&quot;simple&quot;-structures.-Gaussian-Markov-random-fields-are-extremly-flexible-models,">to prefer &quot;simple&quot; structures. Gaussian Markov random fields are extremly flexible models,</a><a id="to-prefer-&quot;simple&quot;-structures.-Gaussian-Markov-random-fields-are-extremly-flexible-models,-1"></a><a class="docs-heading-anchor-permalink" href="#to-prefer-&quot;simple&quot;-structures.-Gaussian-Markov-random-fields-are-extremly-flexible-models," title="Permalink"></a></h1><h1 id="and-to-prevent-overfitting-it-is-common-to-use-priors-that-penalize-complexity.-Therefore,-we"><a class="docs-heading-anchor" href="#and-to-prevent-overfitting-it-is-common-to-use-priors-that-penalize-complexity.-Therefore,-we">and to prevent overfitting it is common to use priors that penalize complexity. Therefore, we</a><a id="and-to-prevent-overfitting-it-is-common-to-use-priors-that-penalize-complexity.-Therefore,-we-1"></a><a class="docs-heading-anchor-permalink" href="#and-to-prevent-overfitting-it-is-common-to-use-priors-that-penalize-complexity.-Therefore,-we" title="Permalink"></a></h1><h1 id="want-to-use-priors-that-enforce-similarity-to-our-mean-image.-If-the-data-wants-more-complexity"><a class="docs-heading-anchor" href="#want-to-use-priors-that-enforce-similarity-to-our-mean-image.-If-the-data-wants-more-complexity">want to use priors that enforce similarity to our mean image. If the data wants more complexity</a><a id="want-to-use-priors-that-enforce-similarity-to-our-mean-image.-If-the-data-wants-more-complexity-1"></a><a class="docs-heading-anchor-permalink" href="#want-to-use-priors-that-enforce-similarity-to-our-mean-image.-If-the-data-wants-more-complexity" title="Permalink"></a></h1><h1 id="then-it-will-drive-us-away-from-the-prior."><a class="docs-heading-anchor" href="#then-it-will-drive-us-away-from-the-prior.">then it will drive us away from the prior.</a><a id="then-it-will-drive-us-away-from-the-prior.-1"></a><a class="docs-heading-anchor-permalink" href="#then-it-will-drive-us-away-from-the-prior." title="Permalink"></a></h1><p>cprior = HierarchicalPrior(crcache, truncated(InverseGamma(2.0, -log(0.1)*rat); upper=npix))</p><h1 id="We-can-now-form-our-model-parameter-priors.-Like-our-other-imaging-examples,-we-use-a"><a class="docs-heading-anchor" href="#We-can-now-form-our-model-parameter-priors.-Like-our-other-imaging-examples,-we-use-a">We can now form our model parameter priors. Like our other imaging examples, we use a</a><a id="We-can-now-form-our-model-parameter-priors.-Like-our-other-imaging-examples,-we-use-a-1"></a><a class="docs-heading-anchor-permalink" href="#We-can-now-form-our-model-parameter-priors.-Like-our-other-imaging-examples,-we-use-a" title="Permalink"></a></h1><h1 id="Dirichlet-prior-for-our-image-pixels.-For-the-log-gain-amplitudes,-we-use-the-CalPrior"><a class="docs-heading-anchor" href="#Dirichlet-prior-for-our-image-pixels.-For-the-log-gain-amplitudes,-we-use-the-CalPrior">Dirichlet prior for our image pixels. For the log gain amplitudes, we use the <code>CalPrior</code></a><a id="Dirichlet-prior-for-our-image-pixels.-For-the-log-gain-amplitudes,-we-use-the-CalPrior-1"></a><a class="docs-heading-anchor-permalink" href="#Dirichlet-prior-for-our-image-pixels.-For-the-log-gain-amplitudes,-we-use-the-CalPrior" title="Permalink"></a></h1><h1 id="which-automatically-constructs-the-prior-for-the-given-jones-cache-gcache."><a class="docs-heading-anchor" href="#which-automatically-constructs-the-prior-for-the-given-jones-cache-gcache.">which automatically constructs the prior for the given jones cache <code>gcache</code>.</a><a id="which-automatically-constructs-the-prior-for-the-given-jones-cache-gcache.-1"></a><a class="docs-heading-anchor-permalink" href="#which-automatically-constructs-the-prior-for-the-given-jones-cache-gcache." title="Permalink"></a></h1><p>prior = NamedDist(          c = cprior,          fg = Uniform(0.0, 1.0),          σimg = truncated(Normal(0.0, 0.1); lower = 0.0),          lgamp = CalPrior(distamp, gcache),          gphase = CalPrior(distphase, gcachep),         )</p><h1 id="Putting-it-all-together-we-form-our-likelihood-and-posterior-objects-for-optimization-and"><a class="docs-heading-anchor" href="#Putting-it-all-together-we-form-our-likelihood-and-posterior-objects-for-optimization-and">Putting it all together we form our likelihood and posterior objects for optimization and</a><a id="Putting-it-all-together-we-form-our-likelihood-and-posterior-objects-for-optimization-and-1"></a><a class="docs-heading-anchor-permalink" href="#Putting-it-all-together-we-form-our-likelihood-and-posterior-objects-for-optimization-and" title="Permalink"></a></h1><h1 id="sampling."><a class="docs-heading-anchor" href="#sampling.">sampling.</a><a id="sampling.-1"></a><a class="docs-heading-anchor-permalink" href="#sampling." title="Permalink"></a></h1><p>lklhd = RadioLikelihood(sky, instrument, dvis; skymeta, instrumentmeta) post = Posterior(lklhd, prior)</p><h1 id="-Reconstructing-the-Image-and-Instrument-Effects"><a class="docs-heading-anchor" href="###-Reconstructing-the-Image-and-Instrument-Effects">## Reconstructing the Image and Instrument Effects</a><a id="-Reconstructing-the-Image-and-Instrument-Effects-1"></a><a class="docs-heading-anchor-permalink" href="###-Reconstructing-the-Image-and-Instrument-Effects" title="Permalink"></a></h1><h1 id="To-sample-from-this-posterior,-it-is-convenient-to-move-from-our-constrained-parameter-space"><a class="docs-heading-anchor" href="#To-sample-from-this-posterior,-it-is-convenient-to-move-from-our-constrained-parameter-space">To sample from this posterior, it is convenient to move from our constrained parameter space</a><a id="To-sample-from-this-posterior,-it-is-convenient-to-move-from-our-constrained-parameter-space-1"></a><a class="docs-heading-anchor-permalink" href="#To-sample-from-this-posterior,-it-is-convenient-to-move-from-our-constrained-parameter-space" title="Permalink"></a></h1><h1 id="to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is"><a class="docs-heading-anchor" href="#to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is">to an unconstrained one (i.e., the support of the transformed posterior is (-∞, ∞)). This is</a><a id="to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is-1"></a><a class="docs-heading-anchor-permalink" href="#to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is" title="Permalink"></a></h1><h1 id="done-using-the-asflat-function."><a class="docs-heading-anchor" href="#done-using-the-asflat-function.">done using the <code>asflat</code> function.</a><a id="done-using-the-asflat-function.-1"></a><a class="docs-heading-anchor-permalink" href="#done-using-the-asflat-function." title="Permalink"></a></h1><p>tpost = asflat(post) ndim = dimension(tpost)</p><h1 id="We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-are-going-to-sample."><a class="docs-heading-anchor" href="#We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-are-going-to-sample.">We can now also find the dimension of our posterior or the number of parameters we are going to sample.</a><a id="We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-are-going-to-sample.-1"></a><a class="docs-heading-anchor-permalink" href="#We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-are-going-to-sample." title="Permalink"></a></h1><h1 id="!!!-warning"><a class="docs-heading-anchor" href="#!!!-warning">!!! warning</a><a id="!!!-warning-1"></a><a class="docs-heading-anchor-permalink" href="#!!!-warning" title="Permalink"></a></h1><h1 id="This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using"><a class="docs-heading-anchor" href="#This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using">This can often be different from what you would expect. This is especially true when using</a><a id="This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using-1"></a><a class="docs-heading-anchor-permalink" href="#This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using" title="Permalink"></a></h1><h1 id="angular-variables-where-we-often-artificially-increase-the-dimension"><a class="docs-heading-anchor" href="#angular-variables-where-we-often-artificially-increase-the-dimension">angular variables where we often artificially increase the dimension</a><a id="angular-variables-where-we-often-artificially-increase-the-dimension-1"></a><a class="docs-heading-anchor-permalink" href="#angular-variables-where-we-often-artificially-increase-the-dimension" title="Permalink"></a></h1><h1 id="of-the-parameter-space-to-make-sampling-easier."><a class="docs-heading-anchor" href="#of-the-parameter-space-to-make-sampling-easier.">of the parameter space to make sampling easier.</a><a id="of-the-parameter-space-to-make-sampling-easier.-1"></a><a class="docs-heading-anchor-permalink" href="#of-the-parameter-space-to-make-sampling-easier." title="Permalink"></a></h1><p>#-</p><h1 id="To-initialize-our-sampler-we-will-use-optimize-using-LBFGS"><a class="docs-heading-anchor" href="#To-initialize-our-sampler-we-will-use-optimize-using-LBFGS">To initialize our sampler we will use optimize using LBFGS</a><a id="To-initialize-our-sampler-we-will-use-optimize-using-LBFGS-1"></a><a class="docs-heading-anchor-permalink" href="#To-initialize-our-sampler-we-will-use-optimize-using-LBFGS" title="Permalink"></a></h1><p>using ComradeOptimization using OptimizationOptimJL using Zygote f = OptimizationFunction(tpost, Optimization.AutoZygote()) prob = Optimization.OptimizationProblem(f, randn(rng, ndim), nothing) ℓ = logdensityof(tpost) sol = solve(prob, LBFGS(), maxiters=1000, g_tol=1e-1);</p><h1 id="Now-transform-back-to-parameter-space"><a class="docs-heading-anchor" href="#Now-transform-back-to-parameter-space">Now transform back to parameter space</a><a id="Now-transform-back-to-parameter-space-1"></a><a class="docs-heading-anchor-permalink" href="#Now-transform-back-to-parameter-space" title="Permalink"></a></h1><p>xopt = transform(tpost, sol.u)</p><h1 id="!!!-warning-2"><a class="docs-heading-anchor" href="#!!!-warning-2">!!! warning</a><a class="docs-heading-anchor-permalink" href="#!!!-warning-2" title="Permalink"></a></h1><h1 id="Fitting-gains-tends-to-be-very-difficult,-meaning-that-optimization-can-take-a-lot-longer."><a class="docs-heading-anchor" href="#Fitting-gains-tends-to-be-very-difficult,-meaning-that-optimization-can-take-a-lot-longer.">Fitting gains tends to be very difficult, meaning that optimization can take a lot longer.</a><a id="Fitting-gains-tends-to-be-very-difficult,-meaning-that-optimization-can-take-a-lot-longer.-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-gains-tends-to-be-very-difficult,-meaning-that-optimization-can-take-a-lot-longer." title="Permalink"></a></h1><h1 id="The-upside-is-that-we-usually-get-nicer-images."><a class="docs-heading-anchor" href="#The-upside-is-that-we-usually-get-nicer-images.">The upside is that we usually get nicer images.</a><a id="The-upside-is-that-we-usually-get-nicer-images.-1"></a><a class="docs-heading-anchor-permalink" href="#The-upside-is-that-we-usually-get-nicer-images." title="Permalink"></a></h1><p>#-</p><h1 id="First-we-will-evaluate-our-fit-by-plotting-the-residuals"><a class="docs-heading-anchor" href="#First-we-will-evaluate-our-fit-by-plotting-the-residuals">First we will evaluate our fit by plotting the residuals</a><a id="First-we-will-evaluate-our-fit-by-plotting-the-residuals-1"></a><a class="docs-heading-anchor-permalink" href="#First-we-will-evaluate-our-fit-by-plotting-the-residuals" title="Permalink"></a></h1><p>using Plots residual(vlbimodel(post, xopt), dvis)</p><h1 id="These-look-reasonable,-although-there-may-be-some-minor-overfitting.-This-could-be"><a class="docs-heading-anchor" href="#These-look-reasonable,-although-there-may-be-some-minor-overfitting.-This-could-be">These look reasonable, although there may be some minor overfitting. This could be</a><a id="These-look-reasonable,-although-there-may-be-some-minor-overfitting.-This-could-be-1"></a><a class="docs-heading-anchor-permalink" href="#These-look-reasonable,-although-there-may-be-some-minor-overfitting.-This-could-be" title="Permalink"></a></h1><h1 id="improved-in-a-few-ways,-but-that-is-beyond-the-goal-of-this-quick-tutorial."><a class="docs-heading-anchor" href="#improved-in-a-few-ways,-but-that-is-beyond-the-goal-of-this-quick-tutorial.">improved in a few ways, but that is beyond the goal of this quick tutorial.</a><a id="improved-in-a-few-ways,-but-that-is-beyond-the-goal-of-this-quick-tutorial.-1"></a><a class="docs-heading-anchor-permalink" href="#improved-in-a-few-ways,-but-that-is-beyond-the-goal-of-this-quick-tutorial." title="Permalink"></a></h1><h1 id="Plotting-the-image,-we-see-that-we-have-a-much-cleaner-version-of-the-closure-only-image-from"><a class="docs-heading-anchor" href="#Plotting-the-image,-we-see-that-we-have-a-much-cleaner-version-of-the-closure-only-image-from">Plotting the image, we see that we have a much cleaner version of the closure-only image from</a><a id="Plotting-the-image,-we-see-that-we-have-a-much-cleaner-version-of-the-closure-only-image-from-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-image,-we-see-that-we-have-a-much-cleaner-version-of-the-closure-only-image-from" title="Permalink"></a></h1><h1 id="[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref)."><a class="docs-heading-anchor" href="#[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref)."><a href="../ClosureImaging/#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>.</a><a id="[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref).-1"></a><a class="docs-heading-anchor-permalink" href="#[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref)." title="Permalink"></a></h1><h1 id="import-CairoMakie-as-CM"><a class="docs-heading-anchor" href="#import-CairoMakie-as-CM">import CairoMakie as CM</a><a id="import-CairoMakie-as-CM-1"></a><a class="docs-heading-anchor-permalink" href="#import-CairoMakie-as-CM" title="Permalink"></a></h1><h1 id="CM.activate!(type-&quot;png&quot;,-px*per*unit3)-#hide"><a class="docs-heading-anchor" href="#CM.activate!(type-&quot;png&quot;,-px*per*unit3)-#hide">CM.activate!(type = &quot;png&quot;, px<em>per</em>unit=3) #hide</a><a id="CM.activate!(type-&quot;png&quot;,-px*per*unit3)-#hide-1"></a><a class="docs-heading-anchor-permalink" href="#CM.activate!(type-&quot;png&quot;,-px*per*unit3)-#hide" title="Permalink"></a></h1><p>img = intensitymap(skymodel(post, xopt), fovx, fovy, 128, 128) #imageviz(img, size=(400, 400))</p><h1 id="Because-we-also-fit-the-instrument-model,-we-can-inspect-their-parameters."><a class="docs-heading-anchor" href="#Because-we-also-fit-the-instrument-model,-we-can-inspect-their-parameters.">Because we also fit the instrument model, we can inspect their parameters.</a><a id="Because-we-also-fit-the-instrument-model,-we-can-inspect-their-parameters.-1"></a><a class="docs-heading-anchor-permalink" href="#Because-we-also-fit-the-instrument-model,-we-can-inspect-their-parameters." title="Permalink"></a></h1><h1 id="To-do-this,-Comrade-provides-a-caltable-function-that-converts-the-flattened-gain-parameters"><a class="docs-heading-anchor" href="#To-do-this,-Comrade-provides-a-caltable-function-that-converts-the-flattened-gain-parameters">To do this, <code>Comrade</code> provides a <code>caltable</code> function that converts the flattened gain parameters</a><a id="To-do-this,-Comrade-provides-a-caltable-function-that-converts-the-flattened-gain-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#To-do-this,-Comrade-provides-a-caltable-function-that-converts-the-flattened-gain-parameters" title="Permalink"></a></h1><h1 id="to-a-tabular-format-based-on-the-time-and-its-segmentation."><a class="docs-heading-anchor" href="#to-a-tabular-format-based-on-the-time-and-its-segmentation.">to a tabular format based on the time and its segmentation.</a><a id="to-a-tabular-format-based-on-the-time-and-its-segmentation.-1"></a><a class="docs-heading-anchor-permalink" href="#to-a-tabular-format-based-on-the-time-and-its-segmentation." title="Permalink"></a></h1><p>gt = Comrade.caltable(gcachep, xopt.gphase) plot(gt, layout=(3,3), size=(600,500))</p><h1 id="The-gain-phases-are-pretty-random,-although-much-of-this-is-due-to-us-picking-a-random"><a class="docs-heading-anchor" href="#The-gain-phases-are-pretty-random,-although-much-of-this-is-due-to-us-picking-a-random">The gain phases are pretty random, although much of this is due to us picking a random</a><a id="The-gain-phases-are-pretty-random,-although-much-of-this-is-due-to-us-picking-a-random-1"></a><a class="docs-heading-anchor-permalink" href="#The-gain-phases-are-pretty-random,-although-much-of-this-is-due-to-us-picking-a-random" title="Permalink"></a></h1><h1 id="reference-station-for-each-scan."><a class="docs-heading-anchor" href="#reference-station-for-each-scan.">reference station for each scan.</a><a id="reference-station-for-each-scan.-1"></a><a class="docs-heading-anchor-permalink" href="#reference-station-for-each-scan." title="Permalink"></a></h1><h1 id="Moving-onto-the-gain-amplitudes,-we-see-that-most-of-the-gain-variation-is-within-10%-as-expected"><a class="docs-heading-anchor" href="#Moving-onto-the-gain-amplitudes,-we-see-that-most-of-the-gain-variation-is-within-10%-as-expected">Moving onto the gain amplitudes, we see that most of the gain variation is within 10% as expected</a><a id="Moving-onto-the-gain-amplitudes,-we-see-that-most-of-the-gain-variation-is-within-10%-as-expected-1"></a><a class="docs-heading-anchor-permalink" href="#Moving-onto-the-gain-amplitudes,-we-see-that-most-of-the-gain-variation-is-within-10%-as-expected" title="Permalink"></a></h1><h1 id="except-LMT,-which-has-massive-variations."><a class="docs-heading-anchor" href="#except-LMT,-which-has-massive-variations.">except LMT, which has massive variations.</a><a id="except-LMT,-which-has-massive-variations.-1"></a><a class="docs-heading-anchor-permalink" href="#except-LMT,-which-has-massive-variations." title="Permalink"></a></h1><p>gt = Comrade.caltable(gcache, exp.(xopt.lgamp)) plot(gt, layout=(3,3), size=(600,500))</p><h1 id="To-sample-from-the-posterior,-we-will-use-HMC,-specifically-the-NUTS-algorithm.-For"><a class="docs-heading-anchor" href="#To-sample-from-the-posterior,-we-will-use-HMC,-specifically-the-NUTS-algorithm.-For">To sample from the posterior, we will use HMC, specifically the NUTS algorithm. For</a><a id="To-sample-from-the-posterior,-we-will-use-HMC,-specifically-the-NUTS-algorithm.-For-1"></a><a class="docs-heading-anchor-permalink" href="#To-sample-from-the-posterior,-we-will-use-HMC,-specifically-the-NUTS-algorithm.-For" title="Permalink"></a></h1><h1 id="information-about-NUTS,"><a class="docs-heading-anchor" href="#information-about-NUTS,">information about NUTS,</a><a id="information-about-NUTS,-1"></a><a class="docs-heading-anchor-permalink" href="#information-about-NUTS," title="Permalink"></a></h1><h1 id="see-Michael-Betancourt&#39;s-[notes](https://arxiv.org/abs/1701.02434)."><a class="docs-heading-anchor" href="#see-Michael-Betancourt&#39;s-[notes](https://arxiv.org/abs/1701.02434).">see Michael Betancourt&#39;s <a href="https://arxiv.org/abs/1701.02434">notes</a>.</a><a id="see-Michael-Betancourt&#39;s-[notes](https://arxiv.org/abs/1701.02434).-1"></a><a class="docs-heading-anchor-permalink" href="#see-Michael-Betancourt&#39;s-[notes](https://arxiv.org/abs/1701.02434)." title="Permalink"></a></h1><h1 id="!!!-note"><a class="docs-heading-anchor" href="#!!!-note">!!! note</a><a id="!!!-note-1"></a><a class="docs-heading-anchor-permalink" href="#!!!-note" title="Permalink"></a></h1><h1 id="For-our-metric,-we-use-a-diagonal-matrix-due-to-easier-tuning"><a class="docs-heading-anchor" href="#For-our-metric,-we-use-a-diagonal-matrix-due-to-easier-tuning">For our <code>metric,</code> we use a diagonal matrix due to easier tuning</a><a id="For-our-metric,-we-use-a-diagonal-matrix-due-to-easier-tuning-1"></a><a class="docs-heading-anchor-permalink" href="#For-our-metric,-we-use-a-diagonal-matrix-due-to-easier-tuning" title="Permalink"></a></h1><p>#-</p><h1 id="However,-due-to-the-need-to-sample-a-large-number-of-gain-parameters,-constructing-the-posterior"><a class="docs-heading-anchor" href="#However,-due-to-the-need-to-sample-a-large-number-of-gain-parameters,-constructing-the-posterior">However, due to the need to sample a large number of gain parameters, constructing the posterior</a><a id="However,-due-to-the-need-to-sample-a-large-number-of-gain-parameters,-constructing-the-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#However,-due-to-the-need-to-sample-a-large-number-of-gain-parameters,-constructing-the-posterior" title="Permalink"></a></h1><h1 id="is-rather-time-consuming.-Therefore,-for-this-tutorial,-we-will-only-do-a-quick-preliminary"><a class="docs-heading-anchor" href="#is-rather-time-consuming.-Therefore,-for-this-tutorial,-we-will-only-do-a-quick-preliminary">is rather time-consuming. Therefore, for this tutorial, we will only do a quick preliminary</a><a id="is-rather-time-consuming.-Therefore,-for-this-tutorial,-we-will-only-do-a-quick-preliminary-1"></a><a class="docs-heading-anchor-permalink" href="#is-rather-time-consuming.-Therefore,-for-this-tutorial,-we-will-only-do-a-quick-preliminary" title="Permalink"></a></h1><h1 id="run,-and-any-posterior"><a class="docs-heading-anchor" href="#run,-and-any-posterior">run, and any posterior</a><a id="run,-and-any-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#run,-and-any-posterior" title="Permalink"></a></h1><h1 id="inferences-should-be-appropriately-skeptical."><a class="docs-heading-anchor" href="#inferences-should-be-appropriately-skeptical.">inferences should be appropriately skeptical.</a><a id="inferences-should-be-appropriately-skeptical.-1"></a><a class="docs-heading-anchor-permalink" href="#inferences-should-be-appropriately-skeptical." title="Permalink"></a></h1><p>#- using ComradeAHMC metric = DiagEuclideanMetric(ndim) chain, stats = sample(rng, post, AHMC(;metric, autodiff=Val(:Zygote)), 700; n<em>adapts=500, initial</em>params=xopt, progress=false) #-</p><h1 id="!!!-note-2"><a class="docs-heading-anchor" href="#!!!-note-2">!!! note</a><a class="docs-heading-anchor-permalink" href="#!!!-note-2" title="Permalink"></a></h1><h1 id="The-above-sampler-will-store-the-samples-in-memory,-i.e.-RAM.-For-large-models-this"><a class="docs-heading-anchor" href="#The-above-sampler-will-store-the-samples-in-memory,-i.e.-RAM.-For-large-models-this">The above sampler will store the samples in memory, i.e. RAM. For large models this</a><a id="The-above-sampler-will-store-the-samples-in-memory,-i.e.-RAM.-For-large-models-this-1"></a><a class="docs-heading-anchor-permalink" href="#The-above-sampler-will-store-the-samples-in-memory,-i.e.-RAM.-For-large-models-this" title="Permalink"></a></h1><h1 id="can-lead-to-out-of-memory-issues.-To-fix-that-you-can-include-the-keyword-argument"><a class="docs-heading-anchor" href="#can-lead-to-out-of-memory-issues.-To-fix-that-you-can-include-the-keyword-argument">can lead to out-of-memory issues. To fix that you can include the keyword argument</a><a id="can-lead-to-out-of-memory-issues.-To-fix-that-you-can-include-the-keyword-argument-1"></a><a class="docs-heading-anchor-permalink" href="#can-lead-to-out-of-memory-issues.-To-fix-that-you-can-include-the-keyword-argument" title="Permalink"></a></h1><h1 id="saveto-DiskStore()-which-periodically-saves-the-samples-to-disk-limiting-memory"><a class="docs-heading-anchor" href="#saveto-DiskStore()-which-periodically-saves-the-samples-to-disk-limiting-memory"><code>saveto = DiskStore()</code> which periodically saves the samples to disk limiting memory</a><a id="saveto-DiskStore()-which-periodically-saves-the-samples-to-disk-limiting-memory-1"></a><a class="docs-heading-anchor-permalink" href="#saveto-DiskStore()-which-periodically-saves-the-samples-to-disk-limiting-memory" title="Permalink"></a></h1><h1 id="useage.-You-can-load-the-chain-using-load_table(diskout)-where-diskout-is"><a class="docs-heading-anchor" href="#useage.-You-can-load-the-chain-using-load_table(diskout)-where-diskout-is">useage. You can load the chain using <code>load_table(diskout)</code> where <code>diskout</code> is</a><a id="useage.-You-can-load-the-chain-using-load_table(diskout)-where-diskout-is-1"></a><a class="docs-heading-anchor-permalink" href="#useage.-You-can-load-the-chain-using-load_table(diskout)-where-diskout-is" title="Permalink"></a></h1><h1 id="the-object-returned-from-sample.-For-more-information-please-see-[ComradeAHMC](@ref)."><a class="docs-heading-anchor" href="#the-object-returned-from-sample.-For-more-information-please-see-[ComradeAHMC](@ref).">the object returned from sample. For more information please see <a href="../../libs/ahmc/#ComradeAHMC">ComradeAHMC</a>.</a><a id="the-object-returned-from-sample.-For-more-information-please-see-[ComradeAHMC](@ref).-1"></a><a class="docs-heading-anchor-permalink" href="#the-object-returned-from-sample.-For-more-information-please-see-[ComradeAHMC](@ref)." title="Permalink"></a></h1><p>#-</p><h1 id="Now-we-prune-the-adaptation-phase"><a class="docs-heading-anchor" href="#Now-we-prune-the-adaptation-phase">Now we prune the adaptation phase</a><a id="Now-we-prune-the-adaptation-phase-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-prune-the-adaptation-phase" title="Permalink"></a></h1><p>chain = chain[501:end]</p><p>#-</p><h1 id="!!!-warning-3"><a class="docs-heading-anchor" href="#!!!-warning-3">!!! warning</a><a class="docs-heading-anchor-permalink" href="#!!!-warning-3" title="Permalink"></a></h1><h1 id="This-should-be-run-for-likely-an-order-of-magnitude-more-steps-to-properly-estimate-expectations-of-the-posterior"><a class="docs-heading-anchor" href="#This-should-be-run-for-likely-an-order-of-magnitude-more-steps-to-properly-estimate-expectations-of-the-posterior">This should be run for likely an order of magnitude more steps to properly estimate expectations of the posterior</a><a id="This-should-be-run-for-likely-an-order-of-magnitude-more-steps-to-properly-estimate-expectations-of-the-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#This-should-be-run-for-likely-an-order-of-magnitude-more-steps-to-properly-estimate-expectations-of-the-posterior" title="Permalink"></a></h1><p>#-</p><h1 id="Now-that-we-have-our-posterior,-we-can-put-error-bars-on-all-of-our-plots-above."><a class="docs-heading-anchor" href="#Now-that-we-have-our-posterior,-we-can-put-error-bars-on-all-of-our-plots-above.">Now that we have our posterior, we can put error bars on all of our plots above.</a><a id="Now-that-we-have-our-posterior,-we-can-put-error-bars-on-all-of-our-plots-above.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-that-we-have-our-posterior,-we-can-put-error-bars-on-all-of-our-plots-above." title="Permalink"></a></h1><h1 id="Let&#39;s-start-by-finding-the-mean-and-standard-deviation-of-the-gain-phases"><a class="docs-heading-anchor" href="#Let&#39;s-start-by-finding-the-mean-and-standard-deviation-of-the-gain-phases">Let&#39;s start by finding the mean and standard deviation of the gain phases</a><a id="Let&#39;s-start-by-finding-the-mean-and-standard-deviation-of-the-gain-phases-1"></a><a class="docs-heading-anchor-permalink" href="#Let&#39;s-start-by-finding-the-mean-and-standard-deviation-of-the-gain-phases" title="Permalink"></a></h1><p>gphase  = hcat(chain.gphase...) mgphase = mean(gphase, dims=2) sgphase = std(gphase, dims=2)</p><h1 id="and-now-the-gain-amplitudes"><a class="docs-heading-anchor" href="#and-now-the-gain-amplitudes">and now the gain amplitudes</a><a id="and-now-the-gain-amplitudes-1"></a><a class="docs-heading-anchor-permalink" href="#and-now-the-gain-amplitudes" title="Permalink"></a></h1><p>gamp  = exp.(hcat(chain.lgamp...)) mgamp = mean(gamp, dims=2) sgamp = std(gamp, dims=2)</p><h1 id="Now-we-can-use-the-measurements-package-to-automatically-plot-everything-with-error-bars."><a class="docs-heading-anchor" href="#Now-we-can-use-the-measurements-package-to-automatically-plot-everything-with-error-bars.">Now we can use the measurements package to automatically plot everything with error bars.</a><a id="Now-we-can-use-the-measurements-package-to-automatically-plot-everything-with-error-bars.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-can-use-the-measurements-package-to-automatically-plot-everything-with-error-bars." title="Permalink"></a></h1><h1 id="First-we-create-a-caltable-the-same-way-but-making-sure-all-of-our-variables-have-errors"><a class="docs-heading-anchor" href="#First-we-create-a-caltable-the-same-way-but-making-sure-all-of-our-variables-have-errors">First we create a <code>caltable</code> the same way but making sure all of our variables have errors</a><a id="First-we-create-a-caltable-the-same-way-but-making-sure-all-of-our-variables-have-errors-1"></a><a class="docs-heading-anchor-permalink" href="#First-we-create-a-caltable-the-same-way-but-making-sure-all-of-our-variables-have-errors" title="Permalink"></a></h1><h1 id="attached-to-them."><a class="docs-heading-anchor" href="#attached-to-them.">attached to them.</a><a id="attached-to-them.-1"></a><a class="docs-heading-anchor-permalink" href="#attached-to-them." title="Permalink"></a></h1><p>using Measurements gmeas<em>am = measurement.(mgamp, sgamp) ctable</em>am = caltable(gcache, vec(gmeas<em>am)) # caltable expects gmeas</em>am to be a Vector gmeas<em>ph = measurement.(mgphase, sgphase) ctable</em>ph = caltable(gcachep, vec(gmeas_ph))</p><h1 id="Now-let&#39;s-plot-the-phase-curves"><a class="docs-heading-anchor" href="#Now-let&#39;s-plot-the-phase-curves">Now let&#39;s plot the phase curves</a><a id="Now-let&#39;s-plot-the-phase-curves-1"></a><a class="docs-heading-anchor-permalink" href="#Now-let&#39;s-plot-the-phase-curves" title="Permalink"></a></h1><p>plot(ctable_ph, layout=(3,3), size=(600,500)) #-</p><h1 id="and-now-the-amplitude-curves"><a class="docs-heading-anchor" href="#and-now-the-amplitude-curves">and now the amplitude curves</a><a id="and-now-the-amplitude-curves-1"></a><a class="docs-heading-anchor-permalink" href="#and-now-the-amplitude-curves" title="Permalink"></a></h1><p>plot(ctable_am, layout=(3,3), size=(600,500))</p><h1 id="Finally-let&#39;s-construct-some-representative-image-reconstructions."><a class="docs-heading-anchor" href="#Finally-let&#39;s-construct-some-representative-image-reconstructions.">Finally let&#39;s construct some representative image reconstructions.</a><a id="Finally-let&#39;s-construct-some-representative-image-reconstructions.-1"></a><a class="docs-heading-anchor-permalink" href="#Finally-let&#39;s-construct-some-representative-image-reconstructions." title="Permalink"></a></h1><p>samples = skymodel.(Ref(post), chain[begin:2:end]) imgs = intensitymap.(samples, fovx, fovy, 128,  128)</p><p>mimg = mean(imgs) simg = std(imgs)</p><h1 id="fig-CM.Figure(;resolution(400,-400))"><a class="docs-heading-anchor" href="#fig-CM.Figure(;resolution(400,-400))">fig = CM.Figure(;resolution=(400, 400))</a><a id="fig-CM.Figure(;resolution(400,-400))-1"></a><a class="docs-heading-anchor-permalink" href="#fig-CM.Figure(;resolution(400,-400))" title="Permalink"></a></h1><h1 id="CM.image(fig[1,1],-mimg,"><a class="docs-heading-anchor" href="#CM.image(fig[1,1],-mimg,">CM.image(fig[1,1], mimg,</a><a id="CM.image(fig[1,1],-mimg,-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image(fig[1,1],-mimg," title="Permalink"></a></h1><h1 id="axis(xreversedtrue,-aspect1,-title&quot;Mean-Image&quot;),"><a class="docs-heading-anchor" href="#axis(xreversedtrue,-aspect1,-title&quot;Mean-Image&quot;),">axis=(xreversed=true, aspect=1, title=&quot;Mean Image&quot;),</a><a id="axis(xreversedtrue,-aspect1,-title&quot;Mean-Image&quot;),-1"></a><a class="docs-heading-anchor-permalink" href="#axis(xreversedtrue,-aspect1,-title&quot;Mean-Image&quot;)," title="Permalink"></a></h1><h1 id="colormap:afmhot)"><a class="docs-heading-anchor" href="#colormap:afmhot)">colormap=:afmhot)</a><a id="colormap:afmhot)-1"></a><a class="docs-heading-anchor-permalink" href="#colormap:afmhot)" title="Permalink"></a></h1><h1 id="CM.image(fig[1,2],-simg./(max.(mimg,-1e-5)),"><a class="docs-heading-anchor" href="#CM.image(fig[1,2],-simg./(max.(mimg,-1e-5)),">CM.image(fig[1,2], simg./(max.(mimg, 1e-5)),</a><a id="CM.image(fig[1,2],-simg./(max.(mimg,-1e-5)),-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image(fig[1,2],-simg./(max.(mimg,-1e-5))," title="Permalink"></a></h1><h1 id="axis(xreversedtrue,-aspect1,-title&quot;1/SNR&quot;,),"><a class="docs-heading-anchor" href="#axis(xreversedtrue,-aspect1,-title&quot;1/SNR&quot;,),">axis=(xreversed=true, aspect=1, title=&quot;1/SNR&quot;,),</a><a id="axis(xreversedtrue,-aspect1,-title&quot;1/SNR&quot;,),-1"></a><a class="docs-heading-anchor-permalink" href="#axis(xreversedtrue,-aspect1,-title&quot;1/SNR&quot;,)," title="Permalink"></a></h1><h1 id="colormap:afmhot)-2"><a class="docs-heading-anchor" href="#colormap:afmhot)-2">colormap=:afmhot)</a><a class="docs-heading-anchor-permalink" href="#colormap:afmhot)-2" title="Permalink"></a></h1><h1 id="CM.image(fig[2,1],-imgs[1],"><a class="docs-heading-anchor" href="#CM.image(fig[2,1],-imgs[1],">CM.image(fig[2,1], imgs[1],</a><a id="CM.image(fig[2,1],-imgs[1],-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image(fig[2,1],-imgs[1]," title="Permalink"></a></h1><h1 id="axis(xreversedtrue,-aspect1,title&quot;Draw-1&quot;),"><a class="docs-heading-anchor" href="#axis(xreversedtrue,-aspect1,title&quot;Draw-1&quot;),">axis=(xreversed=true, aspect=1,title=&quot;Draw 1&quot;),</a><a id="axis(xreversedtrue,-aspect1,title&quot;Draw-1&quot;),-1"></a><a class="docs-heading-anchor-permalink" href="#axis(xreversedtrue,-aspect1,title&quot;Draw-1&quot;)," title="Permalink"></a></h1><h1 id="colormap:afmhot)-3"><a class="docs-heading-anchor" href="#colormap:afmhot)-3">colormap=:afmhot)</a><a class="docs-heading-anchor-permalink" href="#colormap:afmhot)-3" title="Permalink"></a></h1><h1 id="CM.image(fig[2,2],-imgs[end],"><a class="docs-heading-anchor" href="#CM.image(fig[2,2],-imgs[end],">CM.image(fig[2,2], imgs[end],</a><a id="CM.image(fig[2,2],-imgs[end],-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image(fig[2,2],-imgs[end]," title="Permalink"></a></h1><h1 id="axis(xreversedtrue,-aspect1,title&quot;Draw-2&quot;),"><a class="docs-heading-anchor" href="#axis(xreversedtrue,-aspect1,title&quot;Draw-2&quot;),">axis=(xreversed=true, aspect=1,title=&quot;Draw 2&quot;),</a><a id="axis(xreversedtrue,-aspect1,title&quot;Draw-2&quot;),-1"></a><a class="docs-heading-anchor-permalink" href="#axis(xreversedtrue,-aspect1,title&quot;Draw-2&quot;)," title="Permalink"></a></h1><h1 id="colormap:afmhot)-4"><a class="docs-heading-anchor" href="#colormap:afmhot)-4">colormap=:afmhot)</a><a class="docs-heading-anchor-permalink" href="#colormap:afmhot)-4" title="Permalink"></a></h1><h1 id="fig"><a class="docs-heading-anchor" href="#fig">fig</a><a id="fig-1"></a><a class="docs-heading-anchor-permalink" href="#fig" title="Permalink"></a></h1><h1 id="And-viola,-you-have-just-finished-making-a-preliminary-image-and-instrument-model-reconstruction."><a class="docs-heading-anchor" href="#And-viola,-you-have-just-finished-making-a-preliminary-image-and-instrument-model-reconstruction.">And viola, you have just finished making a preliminary image and instrument model reconstruction.</a><a id="And-viola,-you-have-just-finished-making-a-preliminary-image-and-instrument-model-reconstruction.-1"></a><a class="docs-heading-anchor-permalink" href="#And-viola,-you-have-just-finished-making-a-preliminary-image-and-instrument-model-reconstruction." title="Permalink"></a></h1><h1 id="In-reality,-you-should-run-the-sample-step-for-many-more-MCMC-steps-to-get-a-reliable-estimate"><a class="docs-heading-anchor" href="#In-reality,-you-should-run-the-sample-step-for-many-more-MCMC-steps-to-get-a-reliable-estimate">In reality, you should run the <code>sample</code> step for many more MCMC steps to get a reliable estimate</a><a id="In-reality,-you-should-run-the-sample-step-for-many-more-MCMC-steps-to-get-a-reliable-estimate-1"></a><a class="docs-heading-anchor-permalink" href="#In-reality,-you-should-run-the-sample-step-for-many-more-MCMC-steps-to-get-a-reliable-estimate" title="Permalink"></a></h1><h1 id="for-the-reconstructed-image-and-instrument-model-parameters."><a class="docs-heading-anchor" href="#for-the-reconstructed-image-and-instrument-model-parameters.">for the reconstructed image and instrument model parameters.</a><a id="for-the-reconstructed-image-and-instrument-model-parameters.-1"></a><a class="docs-heading-anchor-permalink" href="#for-the-reconstructed-image-and-instrument-model-parameters." title="Permalink"></a></h1><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../PolarizedImaging/">« Polarized Image and Instrumental Modeling</a><a class="docs-footer-nextpage" href="../../libs/optimization/">ComradeOptimization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 23 January 2024 17:08">Tuesday 23 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
