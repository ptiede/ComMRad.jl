<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hybrid Imaging of a Black Hole · Comrade.jl</title><meta name="title" content="Hybrid Imaging of a Black Hole · Comrade.jl"/><meta property="og:title" content="Hybrid Imaging of a Black Hole · Comrade.jl"/><meta property="twitter:title" content="Hybrid Imaging of a Black Hole · Comrade.jl"/><meta name="description" content="Documentation for Comrade.jl."/><meta property="og:description" content="Documentation for Comrade.jl."/><meta property="twitter:description" content="Documentation for Comrade.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Comrade.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../vlbi_imaging_problem/">Introduction to the VLBI Imaging Problem</a></li><li><a class="tocitem" href="../../conventions/">Conventions</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../ClosureImaging/">Imaging a Black Hole using only Closure Quantities</a></li><li><a class="tocitem" href="../GeometricModeling/">Geometric Modeling of EHT Data</a></li><li class="is-active"><a class="tocitem" href>Hybrid Imaging of a Black Hole</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#In-this-tutorial,-we-will-use-**hybrid-imaging**-to-analyze-the-2017-EHT-data."><span>In this tutorial, we will use <strong>hybrid imaging</strong> to analyze the 2017 EHT data.</span></a></li><li class="toplevel"><a class="tocitem" href="#By-hybrid-imaging,-we-mean-decomposing-the-model-into-simple-geometric-models,-e.g.,-rings"><span>By hybrid imaging, we mean decomposing the model into simple geometric models, e.g., rings</span></a></li><li class="toplevel"><a class="tocitem" href="#and-such,-plus-a-rasterized-image-model-to-soak-up-the-additional-structure."><span>and such, plus a rasterized image model to soak up the additional structure.</span></a></li><li class="toplevel"><a class="tocitem" href="#This-approach-was-first-developed-in-[BB20](https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f)"><span>This approach was first developed in <code>BB20</code></span></a></li><li class="toplevel"><a class="tocitem" href="#and-applied-to-EHT-2017-data.-We-will-use-a-similar-model-in-this-tutorial."><span>and applied to EHT 2017 data. We will use a similar model in this tutorial.</span></a></li><li class="toplevel"><a class="tocitem" href="###-Introduction-to-Hybrid-modeling-and-imaging"><span>## Introduction to Hybrid modeling and imaging</span></a></li><li class="toplevel"><a class="tocitem" href="#The-benefit-of-using-a-hybrid-based-modeling-approach-is-the-effective-compression-of"><span>The benefit of using a hybrid-based modeling approach is the effective compression of</span></a></li><li class="toplevel"><a class="tocitem" href="#information/parameters-when-fitting-the-data.-Hybrid-modeling-requires-the-user-to"><span>information/parameters when fitting the data. Hybrid modeling requires the user to</span></a></li><li class="toplevel"><a class="tocitem" href="#incorporate-specific-knowledge-of-how-you-expect-the-source-to-look-like.-For-instance"><span>incorporate specific knowledge of how you expect the source to look like. For instance</span></a></li><li class="toplevel"><a class="tocitem" href="#for-M87,-we-expect-the-image-to-be-dominated-by-a-ring-like-structure.-Therefore,-instead"><span>for M87, we expect the image to be dominated by a ring-like structure. Therefore, instead</span></a></li><li class="toplevel"><a class="tocitem" href="#of-using-a-high-dimensional-raster-to-recover-the-ring,-we-can-use-a-ring-model-plus"><span>of using a high-dimensional raster to recover the ring, we can use a ring model plus</span></a></li><li class="toplevel"><a class="tocitem" href="#a-raster-to-soak-up-the-additional-degrees-of-freedom."><span>a raster to soak up the additional degrees of freedom.</span></a></li><li class="toplevel"><a class="tocitem" href="#This-is-the-approach-we-will-take-in-this-tutorial-to-analyze-the-April-6-2017-EHT-data"><span>This is the approach we will take in this tutorial to analyze the April 6 2017 EHT data</span></a></li><li class="toplevel"><a class="tocitem" href="#of-M87."><span>of M87.</span></a></li><li class="toplevel"><a class="tocitem" href="###-Loading-the-Data"><span>## Loading the Data</span></a></li><li class="toplevel"><a class="tocitem" href="#To-get-started-we-will-load-Comrade"><span>To get started we will load Comrade</span></a></li><li class="toplevel"><a class="tocitem" href="###-Load-the-Data"><span>## Load the Data</span></a></li><li class="toplevel"><a class="tocitem" href="#For-reproducibility-we-use-a-stable-random-number-genreator"><span>For reproducibility we use a stable random number genreator</span></a></li><li class="toplevel"><a class="tocitem" href="#To-download-the-data-visit-https://doi.org/10.25739/g85n-f134"><span>To download the data visit https://doi.org/10.25739/g85n-f134</span></a></li><li class="toplevel"><a class="tocitem" href="#To-load-the-eht-imaging-obsdata-object-we-do:"><span>To load the eht-imaging obsdata object we do:</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-do-some-minor-preprocessing:"><span>Now we do some minor preprocessing:</span></a></li><li class="toplevel"><a class="tocitem" href="#Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases"><span>- Scan average the data since the data have been preprocessed so that the gain phases</span></a></li><li class="toplevel"><a class="tocitem" href="#coherent."><span>coherent.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-this-tutorial-we-will-once-again-fit-complex-visibilities-since-they"><span>For this tutorial we will once again fit complex visibilities since they</span></a></li><li class="toplevel"><a class="tocitem" href="#provide-the-most-information-once-the-telescope/instrument-model-are-taken"><span>provide the most information once the telescope/instrument model are taken</span></a></li><li class="toplevel"><a class="tocitem" href="#into-account."><span>into account.</span></a></li><li class="toplevel"><a class="tocitem" href="###-Building-the-Model/Posterior"><span>## Building the Model/Posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a"><span>Now we build our intensity/visibility model. That is, the model that takes in a</span></a></li><li class="toplevel"><a class="tocitem" href="#named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model."><span>named tuple of parameters and perhaps some metadata required to construct the model.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-our-model,-we-will-use-a-raster-or-ContinuousImage-model,-an-m-ring-model,"><span>For our model, we will use a raster or <code>ContinuousImage</code> model, an <code>m-ring</code> model,</span></a></li><li class="toplevel"><a class="tocitem" href="#and-a-large-asymmetric-Gaussian-component-to-model-the-unresolved-short-baseline-flux."><span>and a large asymmetric Gaussian component to model the unresolved short-baseline flux.</span></a></li><li class="toplevel"><a class="tocitem" href="#Unlike-other-imaging-examples"><span>Unlike other imaging examples</span></a></li><li class="toplevel"><a class="tocitem" href="#(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include"><span>(e.g., Imaging a Black Hole using only Closure Quantities) we also need to include</span></a></li><li class="toplevel"><a class="tocitem" href="#a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components"><span>a model for the instrument, i.e., gains as well. The gains will be broken into two components</span></a></li><li class="toplevel"><a class="tocitem" href="#Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%."><span>- Gain amplitudes which are typically known to 10-20%, except for LMT, which has amplitudes closer to 50-100%.</span></a></li><li class="toplevel"><a class="tocitem" href="#Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly."><span>- Gain phases which are more difficult to constrain and can shift rapidly.</span></a></li><li class="toplevel"><a class="tocitem" href="#Before-we-move-on,-let&#39;s-go-into-the-model-function-a-bit.-This-function-takes-two-arguments"><span>Before we move on, let&#39;s go into the <code>model</code> function a bit. This function takes two arguments</span></a></li><li class="toplevel"><a class="tocitem" href="#θ-and-metadata.-The-θ-argument-is-a-named-tuple-of-parameters-that-are-fit"><span><code>θ</code> and <code>metadata</code>. The <code>θ</code> argument is a named tuple of parameters that are fit</span></a></li><li class="toplevel"><a class="tocitem" href="#to-the-data.-The-metadata-argument-is-all-the-ancillary-information-we-need-to-construct-the-model."><span>to the data. The <code>metadata</code> argument is all the ancillary information we need to construct the model.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-our-hybrid-model,-we-will-need-two-variables-for-the-metadata,-a-grid-that-specifies"><span>For our hybrid model, we will need two variables for the metadata, a <code>grid</code> that specifies</span></a></li><li class="toplevel"><a class="tocitem" href="#the-locations-of-the-image-pixels-and-a-cache-that-defines-the-algorithm-used-to-calculate"><span>the locations of the image pixels and a <code>cache</code> that defines the algorithm used to calculate</span></a></li><li class="toplevel"><a class="tocitem" href="#the-visibilities-given-the-image-model.-This-is-required-since-ContinuousImage-is-most-easily"><span>the visibilities given the image model. This is required since <code>ContinuousImage</code> is most easily</span></a></li><li class="toplevel"><a class="tocitem" href="#computed-using-number-Fourier-transforms-like-the-[NFFT](https://github.com/JuliaMath/NFFT.jl)"><span>computed using number Fourier transforms like the <code>NFFT</code></span></a></li><li class="toplevel"><a class="tocitem" href="#or-[FFT](https://github.com/JuliaMath/FFTW.jl)."><span>or FFT.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-combine-the-models,-we-use-Comrade&#39;s-overloaded-operators,-which-will-combine-the"><span>To combine the models, we use <code>Comrade</code>&#39;s overloaded <code>+</code> operators, which will combine the</span></a></li><li class="toplevel"><a class="tocitem" href="#images-such-that-their-intensities-and-visibilities-are-added-pointwise."><span>images such that their intensities and visibilities are added pointwise.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-let&#39;s-define-our-metadata.-First-we-will-define-the-cache-for-the-image.-This-is"><span>Now let&#39;s define our metadata. First we will define the cache for the image. This is</span></a></li><li class="toplevel"><a class="tocitem" href="#required-to-compute-the-numerical-Fourier-transform."><span>required to compute the numerical Fourier transform.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-our-image,-we-will-use-the"><span>For our image, we will use the</span></a></li><li class="toplevel"><a class="tocitem" href="#non-uniform-Fourier-transform-(NFFTAlg)-to-compute-the-numerical-FT."><span>non-uniform Fourier transform (<code>NFFTAlg</code>) to compute the numerical FT.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-last-argument-to-the-create_cache-call-is-the-image"><span>The last argument to the <code>create_cache</code> call is the image</span></a></li><li class="toplevel"><a class="tocitem" href="#*kernel*-or-*pulse*-defines-the-continuous-function-we-convolve-our-image-with"><span><em>kernel</em> or <em>pulse</em> defines the continuous function we convolve our image with</span></a></li><li class="toplevel"><a class="tocitem" href="#to-produce-a-continuous-on-sky-image."><span>to produce a continuous on-sky image.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-form-the-metadata"><span>Now we form the metadata</span></a></li><li class="toplevel"><a class="tocitem" href="#Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains"><span>Second, we now construct our instrument model cache. This tells us how to map from the gains</span></a></li><li class="toplevel"><a class="tocitem" href="#to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation"><span>to the model visibilities. However, to construct this map, we also need to specify the observation</span></a></li><li class="toplevel"><a class="tocitem" href="#segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument"><span>segmentation over which we expect the gains to change. This is specified in the second argument</span></a></li><li class="toplevel"><a class="tocitem" href="#to-jonescache,-and-currently,-there-are-two-options"><span>to <code>jonescache</code>, and currently, there are two options</span></a></li><li class="toplevel"><a class="tocitem" href="#FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations"><span>- <code>FixedSeg(val)</code>: Fixes the corruption to the value <code>val</code> for all time. This is usefule for reference stations</span></a></li><li class="toplevel"><a class="tocitem" href="#ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan"><span>- <code>ScanSeg()</code>: which forces the corruptions to only change from scan-to-scan</span></a></li><li class="toplevel"><a class="tocitem" href="#TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation"><span>- <code>TrackSeg()</code>: which forces the corruptions to be constant over a night&#39;s observation</span></a></li><li class="toplevel"><a class="tocitem" href="#For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly"><span>For this work, we use the scan segmentation for the gain amplitudes since that is roughly</span></a></li><li class="toplevel"><a class="tocitem" href="#the-timescale-we-expect-them-to-vary.-For-the-phases-we-need-to-set-a-reference-station-for"><span>the timescale we expect them to vary. For the phases we need to set a reference station for</span></a></li><li class="toplevel"><a class="tocitem" href="#each-scan-to-prevent-a-global-phase-offset-degeneracy.-To-do-this-we-select-a-reference"><span>each scan to prevent a global phase offset degeneracy. To do this we select a reference</span></a></li><li class="toplevel"><a class="tocitem" href="#station-for-each-scan-based-on-the-SEFD-of-each-telescope.-The-telescope-with-the-lowest"><span>station for each scan based on the SEFD of each telescope. The telescope with the lowest</span></a></li><li class="toplevel"><a class="tocitem" href="#SEFD-that-is-in-each-scan-is-selected.-For-M87-2017-this-is-almost-always-ALMA."><span>SEFD that is in each scan is selected. For M87 2017 this is almost always ALMA.</span></a></li><li class="toplevel"><a class="tocitem" href="#This-is-everything-we-need-to-form-our-likelihood.-Note-the-first-two-arguments-must-be"><span>This is everything we need to form our likelihood. Note the first two arguments must be</span></a></li><li class="toplevel"><a class="tocitem" href="#the-model-and-then-the-metadata-for-the-likelihood.-The-rest-of-the-arguments-are-required"><span>the model and then the metadata for the likelihood. The rest of the arguments are required</span></a></li><li class="toplevel"><a class="tocitem" href="#to-be-[Comrade.EHTObservation](@ref)"><span>to be <code>Comrade.EHTObservation</code></span></a></li><li class="toplevel"><a class="tocitem" href="#The-next-step-is-defining-our-image-priors."><span>The next step is defining our image priors.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-our-raster-c,-we-will-use-a-Gaussian-markov-random-field-prior,-with-the-softmax"><span>For our raster <code>c</code>, we will use a Gaussian markov random field prior, with the softmax</span></a></li><li class="toplevel"><a class="tocitem" href="#or-centered-log-ratio-transform-so-that-it-lives-on-the-simplex.-That-is,-the-sum-of-all-the-numbers-from-a-Dirichlet"><span>or centered log-ratio transform so that it lives on the simplex. That is, the sum of all the numbers from a <code>Dirichlet</code></span></a></li><li class="toplevel"><a class="tocitem" href="#distribution-always-equals-unity.-First-we-load-VLBIImagePriors-which-containts-a-large-number"><span>distribution always equals unity. First we load <code>VLBIImagePriors</code> which containts a large number</span></a></li><li class="toplevel"><a class="tocitem" href="#of-priors-and-transformations-that-are-useful-for-imaging."><span>of priors and transformations that are useful for imaging.</span></a></li><li class="toplevel"><a class="tocitem" href="#Part-of-hybrid-imaging-is-to-force-a-scale-separation-between"><span>Part of hybrid imaging is to force a scale separation between</span></a></li><li class="toplevel"><a class="tocitem" href="#the-different-model-components-to-make-them-identifiable."><span>the different model components to make them identifiable.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-enforce-this-we-will-set-the"><span>To enforce this we will set the</span></a></li><li class="toplevel"><a class="tocitem" href="#length-scale-of-the-raster-component-equal-to-the-beam-size-of-the-telescope-in-units-of"><span>length scale of the raster component equal to the beam size of the telescope in units of</span></a></li><li class="toplevel"><a class="tocitem" href="#pixel-length,-which-is-given-by"><span>pixel length, which is given by</span></a></li><li class="toplevel"><a class="tocitem" href="#additionlly-we-will-fix-the-standard-deviation-of-the-field-to-unity-and-instead"><span>additionlly we will fix the standard deviation of the field to unity and instead</span></a></li><li class="toplevel"><a class="tocitem" href="#use-a-pseudo-non-centered-parameterization-for-the-field."><span>use a pseudo non-centered parameterization for the field.</span></a></li><li class="toplevel"><a class="tocitem" href="#GaussMarkovRandomField(meanpr,-0.1*rat,-1.0,-crcache)"><span>GaussMarkovRandomField(meanpr, 0.1*rat, 1.0, crcache)</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-can-construct-the-instrument-model-prior"><span>Now we can construct the instrument model prior</span></a></li><li class="toplevel"><a class="tocitem" href="#Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases."><span>Each station requires its own prior on both the amplitudes and phases.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-the-amplitudes"><span>For the amplitudes</span></a></li><li class="toplevel"><a class="tocitem" href="#we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)"><span>we assume that the gains are apriori well calibrated around unit gains (or 0 log gain amplitudes)</span></a></li><li class="toplevel"><a class="tocitem" href="#which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for"><span>which corresponds to no instrument corruption. The gain dispersion is then set to 10% for</span></a></li><li class="toplevel"><a class="tocitem" href="#all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT"><span>all stations except LMT, representing that we expect 10% deviations from scan-to-scan. For LMT</span></a></li><li class="toplevel"><a class="tocitem" href="#we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017."><span>we let the prior expand to 100% due to the known pointing issues LMT had in 2017.</span></a></li><li class="toplevel"><a class="tocitem" href="#For-the-phases,-as-mentioned-above,-we-will-use-a-segmented-gain-prior."><span>For the phases, as mentioned above, we will use a segmented gain prior.</span></a></li><li class="toplevel"><a class="tocitem" href="#This-means-that-rather-than-the-parameters"><span>This means that rather than the parameters</span></a></li><li class="toplevel"><a class="tocitem" href="#being-directly-the-gains,-we-fit-the-first-gain-for-each-site,-and-then"><span>being directly the gains, we fit the first gain for each site, and then</span></a></li><li class="toplevel"><a class="tocitem" href="#the-other-parameters-are-the-segmented-gains-compared-to-the-previous-time.-To-model-this"><span>the other parameters are the segmented gains compared to the previous time. To model this</span></a></li><li class="toplevel"><a class="tocitem" href="#for-the-first-observing-timestamp-of-each-site,-distphase0,-and-the-second-is-the"><span>for the first observing timestamp of each site, <code>distphase0</code>, and the second is the</span></a></li><li class="toplevel"><a class="tocitem" href="#prior-for-segmented-gain-ϵₜ-from-time-i-to-i1,-given-by-distphase.-For-the-EHT,-we-are"><span>prior for segmented gain ϵₜ from time i to i+1, given by <code>distphase</code>. For the EHT, we are</span></a></li><li class="toplevel"><a class="tocitem" href="#dealing-with-pre-calibrated-data,-so-often,-the-gain-phase-jumps-from-scan-to-scan-are"><span>dealing with pre-calibrated data, so often, the gain phase jumps from scan to scan are</span></a></li><li class="toplevel"><a class="tocitem" href="#minor.-As-such,-we-can-put-a-more-informative-prior-on-distphase."><span>minor. As such, we can put a more informative prior on <code>distphase</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-warning"><span>!!! warning</span></a></li><li class="toplevel"><a class="tocitem" href="#We-use-AA-(ALMA)-as-a-reference-station-so-we-do-not-have-to-specify-a-gain-prior-for-it."><span>We use AA (ALMA) as a reference station so we do not have to specify a gain prior for it.</span></a></li><li class="toplevel"><a class="tocitem" href="#Finally-we-can-put-form-the-total-model-prior"><span>Finally we can put form the total model prior</span></a></li><li class="toplevel"><a class="tocitem" href="#This-is-everything-we-need-to-specify-our-posterior-distribution,-which-our-is-the-main"><span>This is everything we need to specify our posterior distribution, which our is the main</span></a></li><li class="toplevel"><a class="tocitem" href="#object-of-interest-in-image-reconstructions-when-using-Bayesian-inference."><span>object of interest in image reconstructions when using Bayesian inference.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-sample-from-our-prior-we-can-do"><span>To sample from our prior we can do</span></a></li><li class="toplevel"><a class="tocitem" href="#and-then-plot-the-results"><span>and then plot the results</span></a></li><li class="toplevel"><a class="tocitem" href="###-Reconstructing-the-Image"><span>## Reconstructing the Image</span></a></li><li class="toplevel"><a class="tocitem" href="#To-sample-from-this-posterior,-it-is-convenient-to-first-move-from-our-constrained-parameter-space"><span>To sample from this posterior, it is convenient to first move from our constrained parameter space</span></a></li><li class="toplevel"><a class="tocitem" href="#to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is"><span>to an unconstrained one (i.e., the support of the transformed posterior is (-∞, ∞)). This is</span></a></li><li class="toplevel"><a class="tocitem" href="#done-using-the-asflat-function."><span>done using the <code>asflat</code> function.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-will-sample."><span>We can now also find the dimension of our posterior or the number of parameters we will sample.</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-warning-2"><span>!!! warning</span></a></li><li class="toplevel"><a class="tocitem" href="#This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using"><span>This can often be different from what you would expect. This is especially true when using</span></a></li><li class="toplevel"><a class="tocitem" href="#angular-variables,-where-we-often-artificially-increase-the-dimension"><span>angular variables, where we often artificially increase the dimension</span></a></li><li class="toplevel"><a class="tocitem" href="#of-the-parameter-space-to-make-sampling-easier."><span>of the parameter space to make sampling easier.</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-we-optimize-using-LBFGS"><span>Now we optimize using LBFGS</span></a></li><li class="toplevel"><a class="tocitem" href="#Before-we-analyze-our-solution-we-first-need-to-transform-back-to-parameter-space."><span>Before we analyze our solution we first need to transform back to parameter space.</span></a></li><li class="toplevel"><a class="tocitem" href="#First-we-will-evaluate-our-fit-by-plotting-the-residuals"><span>First we will evaluate our fit by plotting the residuals</span></a></li><li class="toplevel"><a class="tocitem" href="#and-now-closure-phases"><span>and now closure phases</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-these-residuals-look-a-bit-high.-However,-it-turns-out-this-is-because-the-MAP-is-typically"><span>Now these residuals look a bit high. However, it turns out this is because the MAP is typically</span></a></li><li class="toplevel"><a class="tocitem" href="#not-a-great-estimator-and-will-not-provide-very-predictive-measurements-of-the-data.-We"><span>not a great estimator and will not provide very predictive measurements of the data. We</span></a></li><li class="toplevel"><a class="tocitem" href="#will-show-this-below-after-sampling-from-the-posterior."><span>will show this below after sampling from the posterior.</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image(g,-skymodel(post,-xopt),-axis(aspect1,-xreversedtrue,-title&quot;MAP&quot;),-colormap:afmhot,-figure(;resolution(400,-400),))"><span>CM.image(g, skymodel(post, xopt), axis=(aspect=1, xreversed=true, title=&quot;MAP&quot;), colormap=:afmhot, figure=(;resolution=(400, 400),))</span></a></li><li class="toplevel"><a class="tocitem" href="#We-will-now-move-directly-to-sampling-at-this-point."><span>We will now move directly to sampling at this point.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-then-remove-the-adaptation/warmup-phase-from-our-chain"><span>We then remove the adaptation/warmup phase from our chain</span></a></li><li class="toplevel"><a class="tocitem" href="#!!!-warning-3"><span>!!! warning</span></a></li><li class="toplevel"><a class="tocitem" href="#This-should-be-run-for-2-3x-more-steps-to-properly-estimate-expectations-of-the-posterior"><span>This should be run for 2-3x more steps to properly estimate expectations of the posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-lets-plot-the-mean-image-and-standard-deviation-images."><span>Now lets plot the mean image and standard deviation images.</span></a></li><li class="toplevel"><a class="tocitem" href="#To-do-this-we-first-clip-the-first-250-MCMC-steps-since-that-is-during-tuning-and"><span>To do this we first clip the first 250 MCMC steps since that is during tuning and</span></a></li><li class="toplevel"><a class="tocitem" href="#so-the-posterior-is-not-sampling-from-the-correct-stationary-distribution."><span>so the posterior is not sampling from the correct stationary distribution.</span></a></li><li class="toplevel"><a class="tocitem" href="#The-mean-image-is-then-given-by"><span>The mean image is then given by</span></a></li><li class="toplevel"><a class="tocitem" href="#"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#We-can-also-split-up-the-model-into-its-components-and-analyze-each-separately"><span>We can also split up the model into its components and analyze each separately</span></a></li><li class="toplevel"><a class="tocitem" href="#fig-CM.Figure(;-resolution(400,-400));"><span>fig = CM.Figure(; resolution=(400, 400));</span></a></li><li class="toplevel"><a class="tocitem" href="#axes-[CM.Axis(fig[i,-j],-xreversedtrue,-aspectCM.DataAspect())-for-i-in-1:2,-j-in-1:2]"><span>axes = [CM.Axis(fig[i, j], xreversed=true, aspect=CM.DataAspect()) for i in 1:2, j in 1:2]</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image!(axes[1,1],-ring_mean,-colormap:afmhot);-axes[1,1].title-&quot;Ring-Mean&quot;"><span>CM.image!(axes[1,1], ring_mean, colormap=:afmhot); axes[1,1].title = &quot;Ring Mean&quot;</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image!(axes[1,2],-ring_std,-colormap:afmhot);-axes[1,2].title-&quot;Ring-Std.-Dev.&quot;"><span>CM.image!(axes[1,2], ring_std, colormap=:afmhot); axes[1,2].title = &quot;Ring Std. Dev.&quot;</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image!(axes[2,1],-rast_mean,-colormap:afmhot);-axes[2,1].title-&quot;Rast-Mean&quot;"><span>CM.image!(axes[2,1], rast_mean, colormap=:afmhot); axes[2,1].title = &quot;Rast Mean&quot;</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.image!(axes[2,2],-rast_std,-colormap:afmhot);-axes[2,2].title-&quot;Rast-Std.-Dev.&quot;"><span>CM.image!(axes[2,2], rast_std, colormap=:afmhot); axes[2,2].title = &quot;Rast Std. Dev.&quot;</span></a></li><li class="toplevel"><a class="tocitem" href="#CM.hidedecorations!.(axes)"><span>CM.hidedecorations!.(axes)</span></a></li><li class="toplevel"><a class="tocitem" href="#fig"><span>fig</span></a></li><li class="toplevel"><a class="tocitem" href="#Finally,-let&#39;s-take-a-look-at-some-of-the-ring-parameters"><span>Finally, let&#39;s take a look at some of the ring parameters</span></a></li><li class="toplevel"><a class="tocitem" href="#figd-CM.Figure(;resolution(600,-400));"><span>figd = CM.Figure(;resolution=(600, 400));</span></a></li><li class="toplevel"><a class="tocitem" href="#p1-CM.density(figd[1,1],-rad2μas(chain.r)*2,-axis(xlabel&quot;Ring-Diameter-(μas)&quot;,))"><span>p1 = CM.density(figd[1,1], rad2μas(chain.r)*2, axis=(xlabel=&quot;Ring Diameter (μas)&quot;,))</span></a></li><li class="toplevel"><a class="tocitem" href="#p2-CM.density(figd[1,2],-rad2μas(chain.σ)*2*sqrt(2*log(2)),-axis(xlabel&quot;Ring-FWHM-(μas)&quot;,))"><span>p2 = CM.density(figd[1,2], rad2μas(chain.σ)<em>2</em>sqrt(2*log(2)), axis=(xlabel=&quot;Ring FWHM (μas)&quot;,))</span></a></li><li class="toplevel"><a class="tocitem" href="#p3-CM.density(figd[1,3],-rad2deg.(getindex.(chain.mp,-1))-.-360.0,-axis(xlabel-&quot;Ring-PA-(deg)-E-of-N&quot;,))"><span>p3 = CM.density(figd[1,3], -rad2deg.(getindex.(chain.mp, 1)) .+ 360.0, axis=(xlabel = &quot;Ring PA (deg) E of N&quot;,))</span></a></li><li class="toplevel"><a class="tocitem" href="#p4-CM.density(figd[2,1],-2*getindex.(chain.ma,-2),-axis(xlabel&quot;Brightness-asymmetry&quot;,))"><span>p4 = CM.density(figd[2,1], 2*getindex.(chain.ma, 2), axis=(xlabel=&quot;Brightness asymmetry&quot;,))</span></a></li><li class="toplevel"><a class="tocitem" href="#p5-CM.density(figd[2,2],-1-.-chain.f,-axis(xlabel&quot;Ring-flux-fraction&quot;,))"><span>p5 = CM.density(figd[2,2], 1 .- chain.f, axis=(xlabel=&quot;Ring flux fraction&quot;,))</span></a></li><li class="toplevel"><a class="tocitem" href="#figd"><span>figd</span></a></li><li class="toplevel"><a class="tocitem" href="#Now-let&#39;s-check-the-residuals-using-draws-from-the-posterior"><span>Now let&#39;s check the residuals using draws from the posterior</span></a></li><li class="toplevel"><a class="tocitem" href="#And-everything-looks-pretty-good!-Now-comes-the-hard-part:-interpreting-the-results..."><span>And everything looks pretty good! Now comes the hard part: interpreting the results...</span></a></li></ul></li><li><a class="tocitem" href="../LoadingData/">Loading Data into Comrade</a></li><li><a class="tocitem" href="../PolarizedImaging/">Polarized Image and Instrumental Modeling</a></li><li><a class="tocitem" href="../StokesIImaging/">Stokes I Simultaneous Image and Instrument Modeling</a></li></ul></li><li><span class="tocitem">Libraries</span><ul><li><a class="tocitem" href="../../libs/optimization/">ComradeOptimization</a></li><li><a class="tocitem" href="../../libs/ahmc/">ComradeAHMC</a></li><li><a class="tocitem" href="../../libs/nested/">ComradeNested</a></li><li><a class="tocitem" href="../../libs/dynesty/">ComradeDynesty</a></li><li><a class="tocitem" href="../../libs/adaptmcmc/">ComradeAdaptMCMC</a></li></ul></li><li><a class="tocitem" href="../../base_api/">ComradeBase API</a></li><li><a class="tocitem" href="../../api/">Comrade API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Hybrid Imaging of a Black Hole</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hybrid Imaging of a Black Hole</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ptiede/Comrade.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ptiede/Comrade.jl/blob/main/examples/HybridImaging/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Hybrid-Imaging-of-a-Black-Hole"><a class="docs-heading-anchor" href="#Hybrid-Imaging-of-a-Black-Hole">Hybrid Imaging of a Black Hole</a><a id="Hybrid-Imaging-of-a-Black-Hole-1"></a><a class="docs-heading-anchor-permalink" href="#Hybrid-Imaging-of-a-Black-Hole" title="Permalink"></a></h1><h1 id="In-this-tutorial,-we-will-use-**hybrid-imaging**-to-analyze-the-2017-EHT-data."><a class="docs-heading-anchor" href="#In-this-tutorial,-we-will-use-**hybrid-imaging**-to-analyze-the-2017-EHT-data.">In this tutorial, we will use <strong>hybrid imaging</strong> to analyze the 2017 EHT data.</a><a id="In-this-tutorial,-we-will-use-**hybrid-imaging**-to-analyze-the-2017-EHT-data.-1"></a><a class="docs-heading-anchor-permalink" href="#In-this-tutorial,-we-will-use-**hybrid-imaging**-to-analyze-the-2017-EHT-data." title="Permalink"></a></h1><h1 id="By-hybrid-imaging,-we-mean-decomposing-the-model-into-simple-geometric-models,-e.g.,-rings"><a class="docs-heading-anchor" href="#By-hybrid-imaging,-we-mean-decomposing-the-model-into-simple-geometric-models,-e.g.,-rings">By hybrid imaging, we mean decomposing the model into simple geometric models, e.g., rings</a><a id="By-hybrid-imaging,-we-mean-decomposing-the-model-into-simple-geometric-models,-e.g.,-rings-1"></a><a class="docs-heading-anchor-permalink" href="#By-hybrid-imaging,-we-mean-decomposing-the-model-into-simple-geometric-models,-e.g.,-rings" title="Permalink"></a></h1><h1 id="and-such,-plus-a-rasterized-image-model-to-soak-up-the-additional-structure."><a class="docs-heading-anchor" href="#and-such,-plus-a-rasterized-image-model-to-soak-up-the-additional-structure.">and such, plus a rasterized image model to soak up the additional structure.</a><a id="and-such,-plus-a-rasterized-image-model-to-soak-up-the-additional-structure.-1"></a><a class="docs-heading-anchor-permalink" href="#and-such,-plus-a-rasterized-image-model-to-soak-up-the-additional-structure." title="Permalink"></a></h1><h1 id="This-approach-was-first-developed-in-[BB20](https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f)"><a class="docs-heading-anchor" href="#This-approach-was-first-developed-in-[BB20](https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f)">This approach was first developed in <a href="https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f"><code>BB20</code></a></a><a id="This-approach-was-first-developed-in-[BB20](https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f)-1"></a><a class="docs-heading-anchor-permalink" href="#This-approach-was-first-developed-in-[BB20](https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f)" title="Permalink"></a></h1><h1 id="and-applied-to-EHT-2017-data.-We-will-use-a-similar-model-in-this-tutorial."><a class="docs-heading-anchor" href="#and-applied-to-EHT-2017-data.-We-will-use-a-similar-model-in-this-tutorial.">and applied to EHT 2017 data. We will use a similar model in this tutorial.</a><a id="and-applied-to-EHT-2017-data.-We-will-use-a-similar-model-in-this-tutorial.-1"></a><a class="docs-heading-anchor-permalink" href="#and-applied-to-EHT-2017-data.-We-will-use-a-similar-model-in-this-tutorial." title="Permalink"></a></h1><h1 id="-Introduction-to-Hybrid-modeling-and-imaging"><a class="docs-heading-anchor" href="###-Introduction-to-Hybrid-modeling-and-imaging">## Introduction to Hybrid modeling and imaging</a><a id="-Introduction-to-Hybrid-modeling-and-imaging-1"></a><a class="docs-heading-anchor-permalink" href="###-Introduction-to-Hybrid-modeling-and-imaging" title="Permalink"></a></h1><h1 id="The-benefit-of-using-a-hybrid-based-modeling-approach-is-the-effective-compression-of"><a class="docs-heading-anchor" href="#The-benefit-of-using-a-hybrid-based-modeling-approach-is-the-effective-compression-of">The benefit of using a hybrid-based modeling approach is the effective compression of</a><a id="The-benefit-of-using-a-hybrid-based-modeling-approach-is-the-effective-compression-of-1"></a><a class="docs-heading-anchor-permalink" href="#The-benefit-of-using-a-hybrid-based-modeling-approach-is-the-effective-compression-of" title="Permalink"></a></h1><h1 id="information/parameters-when-fitting-the-data.-Hybrid-modeling-requires-the-user-to"><a class="docs-heading-anchor" href="#information/parameters-when-fitting-the-data.-Hybrid-modeling-requires-the-user-to">information/parameters when fitting the data. Hybrid modeling requires the user to</a><a id="information/parameters-when-fitting-the-data.-Hybrid-modeling-requires-the-user-to-1"></a><a class="docs-heading-anchor-permalink" href="#information/parameters-when-fitting-the-data.-Hybrid-modeling-requires-the-user-to" title="Permalink"></a></h1><h1 id="incorporate-specific-knowledge-of-how-you-expect-the-source-to-look-like.-For-instance"><a class="docs-heading-anchor" href="#incorporate-specific-knowledge-of-how-you-expect-the-source-to-look-like.-For-instance">incorporate specific knowledge of how you expect the source to look like. For instance</a><a id="incorporate-specific-knowledge-of-how-you-expect-the-source-to-look-like.-For-instance-1"></a><a class="docs-heading-anchor-permalink" href="#incorporate-specific-knowledge-of-how-you-expect-the-source-to-look-like.-For-instance" title="Permalink"></a></h1><h1 id="for-M87,-we-expect-the-image-to-be-dominated-by-a-ring-like-structure.-Therefore,-instead"><a class="docs-heading-anchor" href="#for-M87,-we-expect-the-image-to-be-dominated-by-a-ring-like-structure.-Therefore,-instead">for M87, we expect the image to be dominated by a ring-like structure. Therefore, instead</a><a id="for-M87,-we-expect-the-image-to-be-dominated-by-a-ring-like-structure.-Therefore,-instead-1"></a><a class="docs-heading-anchor-permalink" href="#for-M87,-we-expect-the-image-to-be-dominated-by-a-ring-like-structure.-Therefore,-instead" title="Permalink"></a></h1><h1 id="of-using-a-high-dimensional-raster-to-recover-the-ring,-we-can-use-a-ring-model-plus"><a class="docs-heading-anchor" href="#of-using-a-high-dimensional-raster-to-recover-the-ring,-we-can-use-a-ring-model-plus">of using a high-dimensional raster to recover the ring, we can use a ring model plus</a><a id="of-using-a-high-dimensional-raster-to-recover-the-ring,-we-can-use-a-ring-model-plus-1"></a><a class="docs-heading-anchor-permalink" href="#of-using-a-high-dimensional-raster-to-recover-the-ring,-we-can-use-a-ring-model-plus" title="Permalink"></a></h1><h1 id="a-raster-to-soak-up-the-additional-degrees-of-freedom."><a class="docs-heading-anchor" href="#a-raster-to-soak-up-the-additional-degrees-of-freedom.">a raster to soak up the additional degrees of freedom.</a><a id="a-raster-to-soak-up-the-additional-degrees-of-freedom.-1"></a><a class="docs-heading-anchor-permalink" href="#a-raster-to-soak-up-the-additional-degrees-of-freedom." title="Permalink"></a></h1><h1 id="This-is-the-approach-we-will-take-in-this-tutorial-to-analyze-the-April-6-2017-EHT-data"><a class="docs-heading-anchor" href="#This-is-the-approach-we-will-take-in-this-tutorial-to-analyze-the-April-6-2017-EHT-data">This is the approach we will take in this tutorial to analyze the April 6 2017 EHT data</a><a id="This-is-the-approach-we-will-take-in-this-tutorial-to-analyze-the-April-6-2017-EHT-data-1"></a><a class="docs-heading-anchor-permalink" href="#This-is-the-approach-we-will-take-in-this-tutorial-to-analyze-the-April-6-2017-EHT-data" title="Permalink"></a></h1><h1 id="of-M87."><a class="docs-heading-anchor" href="#of-M87.">of M87.</a><a id="of-M87.-1"></a><a class="docs-heading-anchor-permalink" href="#of-M87." title="Permalink"></a></h1><p>import Pkg #hide <strong>DIR = &quot;/home/runner/work/Comrade.jl/Comrade.jl/docs/../examples/HybridImaging&quot; #hide pkg_io = open(joinpath(</strong>DIR, &quot;pkg.log&quot;), &quot;w&quot;) #hide Pkg.activate(<strong>DIR; io=pkg_io) #hide Pkg.develop(; path=joinpath(</strong>DIR, &quot;..&quot;, &quot;..&quot;), io=pkg<em>io) #hide Pkg.instantiate(; io=pkg</em>io) #hide Pkg.precompile(; io=pkg<em>io) #hide close(pkg</em>io) #hide</p><p>ENV[&quot;GKSwstype&quot;] = &quot;nul&quot; #hide</p><h1 id="-Loading-the-Data"><a class="docs-heading-anchor" href="###-Loading-the-Data">## Loading the Data</a><a id="-Loading-the-Data-1"></a><a class="docs-heading-anchor-permalink" href="###-Loading-the-Data" title="Permalink"></a></h1><h1 id="To-get-started-we-will-load-Comrade"><a class="docs-heading-anchor" href="#To-get-started-we-will-load-Comrade">To get started we will load Comrade</a><a id="To-get-started-we-will-load-Comrade-1"></a><a class="docs-heading-anchor-permalink" href="#To-get-started-we-will-load-Comrade" title="Permalink"></a></h1><p>using Comrade</p><h1 id="-Load-the-Data"><a class="docs-heading-anchor" href="###-Load-the-Data">## Load the Data</a><a id="-Load-the-Data-1"></a><a class="docs-heading-anchor-permalink" href="###-Load-the-Data" title="Permalink"></a></h1><p>using Pyehtim</p><h1 id="For-reproducibility-we-use-a-stable-random-number-genreator"><a class="docs-heading-anchor" href="#For-reproducibility-we-use-a-stable-random-number-genreator">For reproducibility we use a stable random number genreator</a><a id="For-reproducibility-we-use-a-stable-random-number-genreator-1"></a><a class="docs-heading-anchor-permalink" href="#For-reproducibility-we-use-a-stable-random-number-genreator" title="Permalink"></a></h1><p>using StableRNGs rng = StableRNG(42)</p><h1 id="To-download-the-data-visit-https://doi.org/10.25739/g85n-f134"><a class="docs-heading-anchor" href="#To-download-the-data-visit-https://doi.org/10.25739/g85n-f134">To download the data visit https://doi.org/10.25739/g85n-f134</a><a id="To-download-the-data-visit-https://doi.org/10.25739/g85n-f134-1"></a><a class="docs-heading-anchor-permalink" href="#To-download-the-data-visit-https://doi.org/10.25739/g85n-f134" title="Permalink"></a></h1><h1 id="To-load-the-eht-imaging-obsdata-object-we-do:"><a class="docs-heading-anchor" href="#To-load-the-eht-imaging-obsdata-object-we-do:">To load the eht-imaging obsdata object we do:</a><a id="To-load-the-eht-imaging-obsdata-object-we-do:-1"></a><a class="docs-heading-anchor-permalink" href="#To-load-the-eht-imaging-obsdata-object-we-do:" title="Permalink"></a></h1><p>obs = ehtim.obsdata.load<em>uvfits(joinpath(__DIR, &quot;../Data/SR1</em>M87<em>2017</em>096<em>lo</em>hops<em>netcal</em>StokesI.uvfits&quot;))</p><h1 id="Now-we-do-some-minor-preprocessing:"><a class="docs-heading-anchor" href="#Now-we-do-some-minor-preprocessing:">Now we do some minor preprocessing:</a><a id="Now-we-do-some-minor-preprocessing:-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-do-some-minor-preprocessing:" title="Permalink"></a></h1><h1 id="Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases"><a class="docs-heading-anchor" href="#Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases">- Scan average the data since the data have been preprocessed so that the gain phases</a><a id="Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases-1"></a><a class="docs-heading-anchor-permalink" href="#Scan-average-the-data-since-the-data-have-been-preprocessed-so-that-the-gain-phases" title="Permalink"></a></h1><h1 id="coherent."><a class="docs-heading-anchor" href="#coherent.">coherent.</a><a id="coherent.-1"></a><a class="docs-heading-anchor-permalink" href="#coherent." title="Permalink"></a></h1><p>obs = scan<em>average(obs).add</em>fractional_noise(0.02)</p><h1 id="For-this-tutorial-we-will-once-again-fit-complex-visibilities-since-they"><a class="docs-heading-anchor" href="#For-this-tutorial-we-will-once-again-fit-complex-visibilities-since-they">For this tutorial we will once again fit complex visibilities since they</a><a id="For-this-tutorial-we-will-once-again-fit-complex-visibilities-since-they-1"></a><a class="docs-heading-anchor-permalink" href="#For-this-tutorial-we-will-once-again-fit-complex-visibilities-since-they" title="Permalink"></a></h1><h1 id="provide-the-most-information-once-the-telescope/instrument-model-are-taken"><a class="docs-heading-anchor" href="#provide-the-most-information-once-the-telescope/instrument-model-are-taken">provide the most information once the telescope/instrument model are taken</a><a id="provide-the-most-information-once-the-telescope/instrument-model-are-taken-1"></a><a class="docs-heading-anchor-permalink" href="#provide-the-most-information-once-the-telescope/instrument-model-are-taken" title="Permalink"></a></h1><h1 id="into-account."><a class="docs-heading-anchor" href="#into-account.">into account.</a><a id="into-account.-1"></a><a class="docs-heading-anchor-permalink" href="#into-account." title="Permalink"></a></h1><p>dvis  = extract_table(obs, ComplexVisibilities())</p><h1 id="-Building-the-Model/Posterior"><a class="docs-heading-anchor" href="###-Building-the-Model/Posterior">## Building the Model/Posterior</a><a id="-Building-the-Model/Posterior-1"></a><a class="docs-heading-anchor-permalink" href="###-Building-the-Model/Posterior" title="Permalink"></a></h1><h1 id="Now-we-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a"><a class="docs-heading-anchor" href="#Now-we-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a">Now we build our intensity/visibility model. That is, the model that takes in a</a><a id="Now-we-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-build-our-intensity/visibility-model.-That-is,-the-model-that-takes-in-a" title="Permalink"></a></h1><h1 id="named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model."><a class="docs-heading-anchor" href="#named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model.">named tuple of parameters and perhaps some metadata required to construct the model.</a><a id="named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model.-1"></a><a class="docs-heading-anchor-permalink" href="#named-tuple-of-parameters-and-perhaps-some-metadata-required-to-construct-the-model." title="Permalink"></a></h1><h1 id="For-our-model,-we-will-use-a-raster-or-ContinuousImage-model,-an-m-ring-model,"><a class="docs-heading-anchor" href="#For-our-model,-we-will-use-a-raster-or-ContinuousImage-model,-an-m-ring-model,">For our model, we will use a raster or <code>ContinuousImage</code> model, an <code>m-ring</code> model,</a><a id="For-our-model,-we-will-use-a-raster-or-ContinuousImage-model,-an-m-ring-model,-1"></a><a class="docs-heading-anchor-permalink" href="#For-our-model,-we-will-use-a-raster-or-ContinuousImage-model,-an-m-ring-model," title="Permalink"></a></h1><h1 id="and-a-large-asymmetric-Gaussian-component-to-model-the-unresolved-short-baseline-flux."><a class="docs-heading-anchor" href="#and-a-large-asymmetric-Gaussian-component-to-model-the-unresolved-short-baseline-flux.">and a large asymmetric Gaussian component to model the unresolved short-baseline flux.</a><a id="and-a-large-asymmetric-Gaussian-component-to-model-the-unresolved-short-baseline-flux.-1"></a><a class="docs-heading-anchor-permalink" href="#and-a-large-asymmetric-Gaussian-component-to-model-the-unresolved-short-baseline-flux." title="Permalink"></a></h1><p>function sky(θ, metadata)     (;c, σimg, f, r, σ, τ, ξτ, ma, mp, fg) = θ     (;ftot, cache) = metadata     ## Form the image model     ## First transform to simplex space first applying the non-centered transform     rast = ftot<em>f</em>(1-fg)<em>to_simplex(CenteredLR(), σimg.</em>c)     mimg = ContinuousImage(rast, cache)     ## Form the ring model     α = ma.<em>cos.(mp .- ξτ)     β = ma.</em>sin.(mp .- ξτ)     ring = smoothed(modify(MRing(α, β), Stretch(r, r<em>(1+τ)), Rotate(ξτ), Renormalize((ftot</em>(1-f)<em>(1-fg)))), σ)     gauss = modify(Gaussian(), Stretch(μas2rad(250.0)), Renormalize(ftot</em>f*fg))     ## We group the geometric models together for improved efficiency. This will be     ## automated in future versions.     return mimg + (ring + gauss) end</p><h1 id="Unlike-other-imaging-examples"><a class="docs-heading-anchor" href="#Unlike-other-imaging-examples">Unlike other imaging examples</a><a id="Unlike-other-imaging-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Unlike-other-imaging-examples" title="Permalink"></a></h1><h1 id="(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include"><a class="docs-heading-anchor" href="#(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include">(e.g., <a href="../ClosureImaging/#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>) we also need to include</a><a id="(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include-1"></a><a class="docs-heading-anchor-permalink" href="#(e.g.,-[Imaging-a-Black-Hole-using-only-Closure-Quantities](@ref))-we-also-need-to-include" title="Permalink"></a></h1><h1 id="a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components"><a class="docs-heading-anchor" href="#a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components">a model for the instrument, i.e., gains as well. The gains will be broken into two components</a><a id="a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components-1"></a><a class="docs-heading-anchor-permalink" href="#a-model-for-the-instrument,-i.e.,-gains-as-well.-The-gains-will-be-broken-into-two-components" title="Permalink"></a></h1><h1 id="Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%."><a class="docs-heading-anchor" href="#Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%.">- Gain amplitudes which are typically known to 10-20%, except for LMT, which has amplitudes closer to 50-100%.</a><a id="Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%.-1"></a><a class="docs-heading-anchor-permalink" href="#Gain-amplitudes-which-are-typically-known-to-10-20%,-except-for-LMT,-which-has-amplitudes-closer-to-50-100%." title="Permalink"></a></h1><h1 id="Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly."><a class="docs-heading-anchor" href="#Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly.">- Gain phases which are more difficult to constrain and can shift rapidly.</a><a id="Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly.-1"></a><a class="docs-heading-anchor-permalink" href="#Gain-phases-which-are-more-difficult-to-constrain-and-can-shift-rapidly." title="Permalink"></a></h1><p>function instrument(θ, metadata)     (; lgamp, gphase) = θ     (; gcache, gcachep) = metadata     ## Now form our instrument model     gvis = exp.(lgamp)     gphase = exp.(1im.<em>gphase)     jgamp = jonesStokes(gvis, gcache)     jgphase = jonesStokes(gphase, gcachep)     return JonesModel(jgamp</em>jgphase) end</p><h1 id="Before-we-move-on,-let&#39;s-go-into-the-model-function-a-bit.-This-function-takes-two-arguments"><a class="docs-heading-anchor" href="#Before-we-move-on,-let&#39;s-go-into-the-model-function-a-bit.-This-function-takes-two-arguments">Before we move on, let&#39;s go into the <code>model</code> function a bit. This function takes two arguments</a><a id="Before-we-move-on,-let&#39;s-go-into-the-model-function-a-bit.-This-function-takes-two-arguments-1"></a><a class="docs-heading-anchor-permalink" href="#Before-we-move-on,-let&#39;s-go-into-the-model-function-a-bit.-This-function-takes-two-arguments" title="Permalink"></a></h1><h1 id="θ-and-metadata.-The-θ-argument-is-a-named-tuple-of-parameters-that-are-fit"><a class="docs-heading-anchor" href="#θ-and-metadata.-The-θ-argument-is-a-named-tuple-of-parameters-that-are-fit"><code>θ</code> and <code>metadata</code>. The <code>θ</code> argument is a named tuple of parameters that are fit</a><a id="θ-and-metadata.-The-θ-argument-is-a-named-tuple-of-parameters-that-are-fit-1"></a><a class="docs-heading-anchor-permalink" href="#θ-and-metadata.-The-θ-argument-is-a-named-tuple-of-parameters-that-are-fit" title="Permalink"></a></h1><h1 id="to-the-data.-The-metadata-argument-is-all-the-ancillary-information-we-need-to-construct-the-model."><a class="docs-heading-anchor" href="#to-the-data.-The-metadata-argument-is-all-the-ancillary-information-we-need-to-construct-the-model.">to the data. The <code>metadata</code> argument is all the ancillary information we need to construct the model.</a><a id="to-the-data.-The-metadata-argument-is-all-the-ancillary-information-we-need-to-construct-the-model.-1"></a><a class="docs-heading-anchor-permalink" href="#to-the-data.-The-metadata-argument-is-all-the-ancillary-information-we-need-to-construct-the-model." title="Permalink"></a></h1><h1 id="For-our-hybrid-model,-we-will-need-two-variables-for-the-metadata,-a-grid-that-specifies"><a class="docs-heading-anchor" href="#For-our-hybrid-model,-we-will-need-two-variables-for-the-metadata,-a-grid-that-specifies">For our hybrid model, we will need two variables for the metadata, a <code>grid</code> that specifies</a><a id="For-our-hybrid-model,-we-will-need-two-variables-for-the-metadata,-a-grid-that-specifies-1"></a><a class="docs-heading-anchor-permalink" href="#For-our-hybrid-model,-we-will-need-two-variables-for-the-metadata,-a-grid-that-specifies" title="Permalink"></a></h1><h1 id="the-locations-of-the-image-pixels-and-a-cache-that-defines-the-algorithm-used-to-calculate"><a class="docs-heading-anchor" href="#the-locations-of-the-image-pixels-and-a-cache-that-defines-the-algorithm-used-to-calculate">the locations of the image pixels and a <code>cache</code> that defines the algorithm used to calculate</a><a id="the-locations-of-the-image-pixels-and-a-cache-that-defines-the-algorithm-used-to-calculate-1"></a><a class="docs-heading-anchor-permalink" href="#the-locations-of-the-image-pixels-and-a-cache-that-defines-the-algorithm-used-to-calculate" title="Permalink"></a></h1><h1 id="the-visibilities-given-the-image-model.-This-is-required-since-ContinuousImage-is-most-easily"><a class="docs-heading-anchor" href="#the-visibilities-given-the-image-model.-This-is-required-since-ContinuousImage-is-most-easily">the visibilities given the image model. This is required since <code>ContinuousImage</code> is most easily</a><a id="the-visibilities-given-the-image-model.-This-is-required-since-ContinuousImage-is-most-easily-1"></a><a class="docs-heading-anchor-permalink" href="#the-visibilities-given-the-image-model.-This-is-required-since-ContinuousImage-is-most-easily" title="Permalink"></a></h1><h1 id="computed-using-number-Fourier-transforms-like-the-[NFFT](https://github.com/JuliaMath/NFFT.jl)"><a class="docs-heading-anchor" href="#computed-using-number-Fourier-transforms-like-the-[NFFT](https://github.com/JuliaMath/NFFT.jl)">computed using number Fourier transforms like the <a href="https://github.com/JuliaMath/NFFT.jl"><code>NFFT</code></a></a><a id="computed-using-number-Fourier-transforms-like-the-[NFFT](https://github.com/JuliaMath/NFFT.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#computed-using-number-Fourier-transforms-like-the-[NFFT](https://github.com/JuliaMath/NFFT.jl)" title="Permalink"></a></h1><h1 id="or-[FFT](https://github.com/JuliaMath/FFTW.jl)."><a class="docs-heading-anchor" href="#or-[FFT](https://github.com/JuliaMath/FFTW.jl).">or <a href="https://github.com/JuliaMath/FFTW.jl">FFT</a>.</a><a id="or-[FFT](https://github.com/JuliaMath/FFTW.jl).-1"></a><a class="docs-heading-anchor-permalink" href="#or-[FFT](https://github.com/JuliaMath/FFTW.jl)." title="Permalink"></a></h1><h1 id="To-combine-the-models,-we-use-Comrade&#39;s-overloaded-operators,-which-will-combine-the"><a class="docs-heading-anchor" href="#To-combine-the-models,-we-use-Comrade&#39;s-overloaded-operators,-which-will-combine-the">To combine the models, we use <code>Comrade</code>&#39;s overloaded <code>+</code> operators, which will combine the</a><a id="To-combine-the-models,-we-use-Comrade&#39;s-overloaded-operators,-which-will-combine-the-1"></a><a class="docs-heading-anchor-permalink" href="#To-combine-the-models,-we-use-Comrade&#39;s-overloaded-operators,-which-will-combine-the" title="Permalink"></a></h1><h1 id="images-such-that-their-intensities-and-visibilities-are-added-pointwise."><a class="docs-heading-anchor" href="#images-such-that-their-intensities-and-visibilities-are-added-pointwise.">images such that their intensities and visibilities are added pointwise.</a><a id="images-such-that-their-intensities-and-visibilities-are-added-pointwise.-1"></a><a class="docs-heading-anchor-permalink" href="#images-such-that-their-intensities-and-visibilities-are-added-pointwise." title="Permalink"></a></h1><h1 id="Now-let&#39;s-define-our-metadata.-First-we-will-define-the-cache-for-the-image.-This-is"><a class="docs-heading-anchor" href="#Now-let&#39;s-define-our-metadata.-First-we-will-define-the-cache-for-the-image.-This-is">Now let&#39;s define our metadata. First we will define the cache for the image. This is</a><a id="Now-let&#39;s-define-our-metadata.-First-we-will-define-the-cache-for-the-image.-This-is-1"></a><a class="docs-heading-anchor-permalink" href="#Now-let&#39;s-define-our-metadata.-First-we-will-define-the-cache-for-the-image.-This-is" title="Permalink"></a></h1><h1 id="required-to-compute-the-numerical-Fourier-transform."><a class="docs-heading-anchor" href="#required-to-compute-the-numerical-Fourier-transform.">required to compute the numerical Fourier transform.</a><a id="required-to-compute-the-numerical-Fourier-transform.-1"></a><a class="docs-heading-anchor-permalink" href="#required-to-compute-the-numerical-Fourier-transform." title="Permalink"></a></h1><p>fovxy  = μas2rad(200.0) npix   = 32 grid   = imagepixels(fovxy, fovxy, npix, npix)</p><h1 id="For-our-image,-we-will-use-the"><a class="docs-heading-anchor" href="#For-our-image,-we-will-use-the">For our image, we will use the</a><a id="For-our-image,-we-will-use-the-1"></a><a class="docs-heading-anchor-permalink" href="#For-our-image,-we-will-use-the" title="Permalink"></a></h1><h1 id="non-uniform-Fourier-transform-(NFFTAlg)-to-compute-the-numerical-FT."><a class="docs-heading-anchor" href="#non-uniform-Fourier-transform-(NFFTAlg)-to-compute-the-numerical-FT.">non-uniform Fourier transform (<code>NFFTAlg</code>) to compute the numerical FT.</a><a id="non-uniform-Fourier-transform-(NFFTAlg)-to-compute-the-numerical-FT.-1"></a><a class="docs-heading-anchor-permalink" href="#non-uniform-Fourier-transform-(NFFTAlg)-to-compute-the-numerical-FT." title="Permalink"></a></h1><h1 id="The-last-argument-to-the-create_cache-call-is-the-image"><a class="docs-heading-anchor" href="#The-last-argument-to-the-create_cache-call-is-the-image">The last argument to the <code>create_cache</code> call is the image</a><a id="The-last-argument-to-the-create_cache-call-is-the-image-1"></a><a class="docs-heading-anchor-permalink" href="#The-last-argument-to-the-create_cache-call-is-the-image" title="Permalink"></a></h1><h1 id="*kernel*-or-*pulse*-defines-the-continuous-function-we-convolve-our-image-with"><a class="docs-heading-anchor" href="#*kernel*-or-*pulse*-defines-the-continuous-function-we-convolve-our-image-with"><em>kernel</em> or <em>pulse</em> defines the continuous function we convolve our image with</a><a id="*kernel*-or-*pulse*-defines-the-continuous-function-we-convolve-our-image-with-1"></a><a class="docs-heading-anchor-permalink" href="#*kernel*-or-*pulse*-defines-the-continuous-function-we-convolve-our-image-with" title="Permalink"></a></h1><h1 id="to-produce-a-continuous-on-sky-image."><a class="docs-heading-anchor" href="#to-produce-a-continuous-on-sky-image.">to produce a continuous on-sky image.</a><a id="to-produce-a-continuous-on-sky-image.-1"></a><a class="docs-heading-anchor-permalink" href="#to-produce-a-continuous-on-sky-image." title="Permalink"></a></h1><p>cache  = create_cache(NFFTAlg(dvis), grid, BSplinePulse{3}())</p><h1 id="Now-we-form-the-metadata"><a class="docs-heading-anchor" href="#Now-we-form-the-metadata">Now we form the metadata</a><a id="Now-we-form-the-metadata-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-form-the-metadata" title="Permalink"></a></h1><p>skymetadata = (;ftot=1.1, cache)</p><h1 id="Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains"><a class="docs-heading-anchor" href="#Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains">Second, we now construct our instrument model cache. This tells us how to map from the gains</a><a id="Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains-1"></a><a class="docs-heading-anchor-permalink" href="#Second,-we-now-construct-our-instrument-model-cache.-This-tells-us-how-to-map-from-the-gains" title="Permalink"></a></h1><h1 id="to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation"><a class="docs-heading-anchor" href="#to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation">to the model visibilities. However, to construct this map, we also need to specify the observation</a><a id="to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation-1"></a><a class="docs-heading-anchor-permalink" href="#to-the-model-visibilities.-However,-to-construct-this-map,-we-also-need-to-specify-the-observation" title="Permalink"></a></h1><h1 id="segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument"><a class="docs-heading-anchor" href="#segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument">segmentation over which we expect the gains to change. This is specified in the second argument</a><a id="segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument-1"></a><a class="docs-heading-anchor-permalink" href="#segmentation-over-which-we-expect-the-gains-to-change.-This-is-specified-in-the-second-argument" title="Permalink"></a></h1><h1 id="to-jonescache,-and-currently,-there-are-two-options"><a class="docs-heading-anchor" href="#to-jonescache,-and-currently,-there-are-two-options">to <code>jonescache</code>, and currently, there are two options</a><a id="to-jonescache,-and-currently,-there-are-two-options-1"></a><a class="docs-heading-anchor-permalink" href="#to-jonescache,-and-currently,-there-are-two-options" title="Permalink"></a></h1><h1 id="FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations"><a class="docs-heading-anchor" href="#FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations">- <code>FixedSeg(val)</code>: Fixes the corruption to the value <code>val</code> for all time. This is usefule for reference stations</a><a id="FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations-1"></a><a class="docs-heading-anchor-permalink" href="#FixedSeg(val):-Fixes-the-corruption-to-the-value-val-for-all-time.-This-is-usefule-for-reference-stations" title="Permalink"></a></h1><h1 id="ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan"><a class="docs-heading-anchor" href="#ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan">- <code>ScanSeg()</code>: which forces the corruptions to only change from scan-to-scan</a><a id="ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan-1"></a><a class="docs-heading-anchor-permalink" href="#ScanSeg():-which-forces-the-corruptions-to-only-change-from-scan-to-scan" title="Permalink"></a></h1><h1 id="TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation"><a class="docs-heading-anchor" href="#TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation">- <code>TrackSeg()</code>: which forces the corruptions to be constant over a night&#39;s observation</a><a id="TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation-1"></a><a class="docs-heading-anchor-permalink" href="#TrackSeg():-which-forces-the-corruptions-to-be-constant-over-a-night&#39;s-observation" title="Permalink"></a></h1><h1 id="For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly"><a class="docs-heading-anchor" href="#For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly">For this work, we use the scan segmentation for the gain amplitudes since that is roughly</a><a id="For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly-1"></a><a class="docs-heading-anchor-permalink" href="#For-this-work,-we-use-the-scan-segmentation-for-the-gain-amplitudes-since-that-is-roughly" title="Permalink"></a></h1><h1 id="the-timescale-we-expect-them-to-vary.-For-the-phases-we-need-to-set-a-reference-station-for"><a class="docs-heading-anchor" href="#the-timescale-we-expect-them-to-vary.-For-the-phases-we-need-to-set-a-reference-station-for">the timescale we expect them to vary. For the phases we need to set a reference station for</a><a id="the-timescale-we-expect-them-to-vary.-For-the-phases-we-need-to-set-a-reference-station-for-1"></a><a class="docs-heading-anchor-permalink" href="#the-timescale-we-expect-them-to-vary.-For-the-phases-we-need-to-set-a-reference-station-for" title="Permalink"></a></h1><h1 id="each-scan-to-prevent-a-global-phase-offset-degeneracy.-To-do-this-we-select-a-reference"><a class="docs-heading-anchor" href="#each-scan-to-prevent-a-global-phase-offset-degeneracy.-To-do-this-we-select-a-reference">each scan to prevent a global phase offset degeneracy. To do this we select a reference</a><a id="each-scan-to-prevent-a-global-phase-offset-degeneracy.-To-do-this-we-select-a-reference-1"></a><a class="docs-heading-anchor-permalink" href="#each-scan-to-prevent-a-global-phase-offset-degeneracy.-To-do-this-we-select-a-reference" title="Permalink"></a></h1><h1 id="station-for-each-scan-based-on-the-SEFD-of-each-telescope.-The-telescope-with-the-lowest"><a class="docs-heading-anchor" href="#station-for-each-scan-based-on-the-SEFD-of-each-telescope.-The-telescope-with-the-lowest">station for each scan based on the SEFD of each telescope. The telescope with the lowest</a><a id="station-for-each-scan-based-on-the-SEFD-of-each-telescope.-The-telescope-with-the-lowest-1"></a><a class="docs-heading-anchor-permalink" href="#station-for-each-scan-based-on-the-SEFD-of-each-telescope.-The-telescope-with-the-lowest" title="Permalink"></a></h1><h1 id="SEFD-that-is-in-each-scan-is-selected.-For-M87-2017-this-is-almost-always-ALMA."><a class="docs-heading-anchor" href="#SEFD-that-is-in-each-scan-is-selected.-For-M87-2017-this-is-almost-always-ALMA.">SEFD that is in each scan is selected. For M87 2017 this is almost always ALMA.</a><a id="SEFD-that-is-in-each-scan-is-selected.-For-M87-2017-this-is-almost-always-ALMA.-1"></a><a class="docs-heading-anchor-permalink" href="#SEFD-that-is-in-each-scan-is-selected.-For-M87-2017-this-is-almost-always-ALMA." title="Permalink"></a></h1><p>gcache = jonescache(dvis, ScanSeg()) gcachep = jonescache(dvis, ScanSeg(), autoref=SEFDReference(1.0 + 0.0im)) intmetadata = (;gcache, gcachep)</p><h1 id="This-is-everything-we-need-to-form-our-likelihood.-Note-the-first-two-arguments-must-be"><a class="docs-heading-anchor" href="#This-is-everything-we-need-to-form-our-likelihood.-Note-the-first-two-arguments-must-be">This is everything we need to form our likelihood. Note the first two arguments must be</a><a id="This-is-everything-we-need-to-form-our-likelihood.-Note-the-first-two-arguments-must-be-1"></a><a class="docs-heading-anchor-permalink" href="#This-is-everything-we-need-to-form-our-likelihood.-Note-the-first-two-arguments-must-be" title="Permalink"></a></h1><h1 id="the-model-and-then-the-metadata-for-the-likelihood.-The-rest-of-the-arguments-are-required"><a class="docs-heading-anchor" href="#the-model-and-then-the-metadata-for-the-likelihood.-The-rest-of-the-arguments-are-required">the model and then the metadata for the likelihood. The rest of the arguments are required</a><a id="the-model-and-then-the-metadata-for-the-likelihood.-The-rest-of-the-arguments-are-required-1"></a><a class="docs-heading-anchor-permalink" href="#the-model-and-then-the-metadata-for-the-likelihood.-The-rest-of-the-arguments-are-required" title="Permalink"></a></h1><h1 id="to-be-[Comrade.EHTObservation](@ref)"><a class="docs-heading-anchor" href="#to-be-[Comrade.EHTObservation](@ref)">to be <a href="../../api/#Comrade.EHTObservation"><code>Comrade.EHTObservation</code></a></a><a id="to-be-[Comrade.EHTObservation](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#to-be-[Comrade.EHTObservation](@ref)" title="Permalink"></a></h1><p>lklhd = RadioLikelihood(sky, instrument, dvis;                         skymeta=skymetadata, instrumentmeta=intmetadata)</p><h1 id="The-next-step-is-defining-our-image-priors."><a class="docs-heading-anchor" href="#The-next-step-is-defining-our-image-priors.">The next step is defining our image priors.</a><a id="The-next-step-is-defining-our-image-priors.-1"></a><a class="docs-heading-anchor-permalink" href="#The-next-step-is-defining-our-image-priors." title="Permalink"></a></h1><h1 id="For-our-raster-c,-we-will-use-a-Gaussian-markov-random-field-prior,-with-the-softmax"><a class="docs-heading-anchor" href="#For-our-raster-c,-we-will-use-a-Gaussian-markov-random-field-prior,-with-the-softmax">For our raster <code>c</code>, we will use a Gaussian markov random field prior, with the softmax</a><a id="For-our-raster-c,-we-will-use-a-Gaussian-markov-random-field-prior,-with-the-softmax-1"></a><a class="docs-heading-anchor-permalink" href="#For-our-raster-c,-we-will-use-a-Gaussian-markov-random-field-prior,-with-the-softmax" title="Permalink"></a></h1><h1 id="or-centered-log-ratio-transform-so-that-it-lives-on-the-simplex.-That-is,-the-sum-of-all-the-numbers-from-a-Dirichlet"><a class="docs-heading-anchor" href="#or-centered-log-ratio-transform-so-that-it-lives-on-the-simplex.-That-is,-the-sum-of-all-the-numbers-from-a-Dirichlet">or centered log-ratio transform so that it lives on the simplex. That is, the sum of all the numbers from a <code>Dirichlet</code></a><a id="or-centered-log-ratio-transform-so-that-it-lives-on-the-simplex.-That-is,-the-sum-of-all-the-numbers-from-a-Dirichlet-1"></a><a class="docs-heading-anchor-permalink" href="#or-centered-log-ratio-transform-so-that-it-lives-on-the-simplex.-That-is,-the-sum-of-all-the-numbers-from-a-Dirichlet" title="Permalink"></a></h1><h1 id="distribution-always-equals-unity.-First-we-load-VLBIImagePriors-which-containts-a-large-number"><a class="docs-heading-anchor" href="#distribution-always-equals-unity.-First-we-load-VLBIImagePriors-which-containts-a-large-number">distribution always equals unity. First we load <code>VLBIImagePriors</code> which containts a large number</a><a id="distribution-always-equals-unity.-First-we-load-VLBIImagePriors-which-containts-a-large-number-1"></a><a class="docs-heading-anchor-permalink" href="#distribution-always-equals-unity.-First-we-load-VLBIImagePriors-which-containts-a-large-number" title="Permalink"></a></h1><h1 id="of-priors-and-transformations-that-are-useful-for-imaging."><a class="docs-heading-anchor" href="#of-priors-and-transformations-that-are-useful-for-imaging.">of priors and transformations that are useful for imaging.</a><a id="of-priors-and-transformations-that-are-useful-for-imaging.-1"></a><a class="docs-heading-anchor-permalink" href="#of-priors-and-transformations-that-are-useful-for-imaging." title="Permalink"></a></h1><p>using VLBIImagePriors</p><h1 id="Part-of-hybrid-imaging-is-to-force-a-scale-separation-between"><a class="docs-heading-anchor" href="#Part-of-hybrid-imaging-is-to-force-a-scale-separation-between">Part of hybrid imaging is to force a scale separation between</a><a id="Part-of-hybrid-imaging-is-to-force-a-scale-separation-between-1"></a><a class="docs-heading-anchor-permalink" href="#Part-of-hybrid-imaging-is-to-force-a-scale-separation-between" title="Permalink"></a></h1><h1 id="the-different-model-components-to-make-them-identifiable."><a class="docs-heading-anchor" href="#the-different-model-components-to-make-them-identifiable.">the different model components to make them identifiable.</a><a id="the-different-model-components-to-make-them-identifiable.-1"></a><a class="docs-heading-anchor-permalink" href="#the-different-model-components-to-make-them-identifiable." title="Permalink"></a></h1><h1 id="To-enforce-this-we-will-set-the"><a class="docs-heading-anchor" href="#To-enforce-this-we-will-set-the">To enforce this we will set the</a><a id="To-enforce-this-we-will-set-the-1"></a><a class="docs-heading-anchor-permalink" href="#To-enforce-this-we-will-set-the" title="Permalink"></a></h1><h1 id="length-scale-of-the-raster-component-equal-to-the-beam-size-of-the-telescope-in-units-of"><a class="docs-heading-anchor" href="#length-scale-of-the-raster-component-equal-to-the-beam-size-of-the-telescope-in-units-of">length scale of the raster component equal to the beam size of the telescope in units of</a><a id="length-scale-of-the-raster-component-equal-to-the-beam-size-of-the-telescope-in-units-of-1"></a><a class="docs-heading-anchor-permalink" href="#length-scale-of-the-raster-component-equal-to-the-beam-size-of-the-telescope-in-units-of" title="Permalink"></a></h1><h1 id="pixel-length,-which-is-given-by"><a class="docs-heading-anchor" href="#pixel-length,-which-is-given-by">pixel length, which is given by</a><a id="pixel-length,-which-is-given-by-1"></a><a class="docs-heading-anchor-permalink" href="#pixel-length,-which-is-given-by" title="Permalink"></a></h1><p>beam = beamsize(dvis) rat = (beam/(step(grid.X))) cprior = GaussMarkovRandomField(rat, size(grid); order=2)</p><h1 id="additionlly-we-will-fix-the-standard-deviation-of-the-field-to-unity-and-instead"><a class="docs-heading-anchor" href="#additionlly-we-will-fix-the-standard-deviation-of-the-field-to-unity-and-instead">additionlly we will fix the standard deviation of the field to unity and instead</a><a id="additionlly-we-will-fix-the-standard-deviation-of-the-field-to-unity-and-instead-1"></a><a class="docs-heading-anchor-permalink" href="#additionlly-we-will-fix-the-standard-deviation-of-the-field-to-unity-and-instead" title="Permalink"></a></h1><h1 id="use-a-pseudo-non-centered-parameterization-for-the-field."><a class="docs-heading-anchor" href="#use-a-pseudo-non-centered-parameterization-for-the-field.">use a pseudo non-centered parameterization for the field.</a><a id="use-a-pseudo-non-centered-parameterization-for-the-field.-1"></a><a class="docs-heading-anchor-permalink" href="#use-a-pseudo-non-centered-parameterization-for-the-field." title="Permalink"></a></h1><h1 id="GaussMarkovRandomField(meanpr,-0.1*rat,-1.0,-crcache)"><a class="docs-heading-anchor" href="#GaussMarkovRandomField(meanpr,-0.1*rat,-1.0,-crcache)">GaussMarkovRandomField(meanpr, 0.1*rat, 1.0, crcache)</a><a id="GaussMarkovRandomField(meanpr,-0.1*rat,-1.0,-crcache)-1"></a><a class="docs-heading-anchor-permalink" href="#GaussMarkovRandomField(meanpr,-0.1*rat,-1.0,-crcache)" title="Permalink"></a></h1><h1 id="Now-we-can-construct-the-instrument-model-prior"><a class="docs-heading-anchor" href="#Now-we-can-construct-the-instrument-model-prior">Now we can construct the instrument model prior</a><a id="Now-we-can-construct-the-instrument-model-prior-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-can-construct-the-instrument-model-prior" title="Permalink"></a></h1><h1 id="Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases."><a class="docs-heading-anchor" href="#Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases.">Each station requires its own prior on both the amplitudes and phases.</a><a id="Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases.-1"></a><a class="docs-heading-anchor-permalink" href="#Each-station-requires-its-own-prior-on-both-the-amplitudes-and-phases." title="Permalink"></a></h1><h1 id="For-the-amplitudes"><a class="docs-heading-anchor" href="#For-the-amplitudes">For the amplitudes</a><a id="For-the-amplitudes-1"></a><a class="docs-heading-anchor-permalink" href="#For-the-amplitudes" title="Permalink"></a></h1><h1 id="we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)"><a class="docs-heading-anchor" href="#we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)">we assume that the gains are apriori well calibrated around unit gains (or 0 log gain amplitudes)</a><a id="we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)-1"></a><a class="docs-heading-anchor-permalink" href="#we-assume-that-the-gains-are-apriori-well-calibrated-around-unit-gains-(or-0-log-gain-amplitudes)" title="Permalink"></a></h1><h1 id="which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for"><a class="docs-heading-anchor" href="#which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for">which corresponds to no instrument corruption. The gain dispersion is then set to 10% for</a><a id="which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for-1"></a><a class="docs-heading-anchor-permalink" href="#which-corresponds-to-no-instrument-corruption.-The-gain-dispersion-is-then-set-to-10%-for" title="Permalink"></a></h1><h1 id="all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT"><a class="docs-heading-anchor" href="#all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT">all stations except LMT, representing that we expect 10% deviations from scan-to-scan. For LMT</a><a id="all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT-1"></a><a class="docs-heading-anchor-permalink" href="#all-stations-except-LMT,-representing-that-we-expect-10%-deviations-from-scan-to-scan.-For-LMT" title="Permalink"></a></h1><h1 id="we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017."><a class="docs-heading-anchor" href="#we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017.">we let the prior expand to 100% due to the known pointing issues LMT had in 2017.</a><a id="we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017.-1"></a><a class="docs-heading-anchor-permalink" href="#we-let-the-prior-expand-to-100%-due-to-the-known-pointing-issues-LMT-had-in-2017." title="Permalink"></a></h1><p>using Distributions using DistributionsAD distamp = station_tuple(dvis, Normal(0.0, 0.1); LM = Normal(0.0, 1.0))</p><h1 id="For-the-phases,-as-mentioned-above,-we-will-use-a-segmented-gain-prior."><a class="docs-heading-anchor" href="#For-the-phases,-as-mentioned-above,-we-will-use-a-segmented-gain-prior.">For the phases, as mentioned above, we will use a segmented gain prior.</a><a id="For-the-phases,-as-mentioned-above,-we-will-use-a-segmented-gain-prior.-1"></a><a class="docs-heading-anchor-permalink" href="#For-the-phases,-as-mentioned-above,-we-will-use-a-segmented-gain-prior." title="Permalink"></a></h1><h1 id="This-means-that-rather-than-the-parameters"><a class="docs-heading-anchor" href="#This-means-that-rather-than-the-parameters">This means that rather than the parameters</a><a id="This-means-that-rather-than-the-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#This-means-that-rather-than-the-parameters" title="Permalink"></a></h1><h1 id="being-directly-the-gains,-we-fit-the-first-gain-for-each-site,-and-then"><a class="docs-heading-anchor" href="#being-directly-the-gains,-we-fit-the-first-gain-for-each-site,-and-then">being directly the gains, we fit the first gain for each site, and then</a><a id="being-directly-the-gains,-we-fit-the-first-gain-for-each-site,-and-then-1"></a><a class="docs-heading-anchor-permalink" href="#being-directly-the-gains,-we-fit-the-first-gain-for-each-site,-and-then" title="Permalink"></a></h1><h1 id="the-other-parameters-are-the-segmented-gains-compared-to-the-previous-time.-To-model-this"><a class="docs-heading-anchor" href="#the-other-parameters-are-the-segmented-gains-compared-to-the-previous-time.-To-model-this">the other parameters are the segmented gains compared to the previous time. To model this</a><a id="the-other-parameters-are-the-segmented-gains-compared-to-the-previous-time.-To-model-this-1"></a><a class="docs-heading-anchor-permalink" href="#the-other-parameters-are-the-segmented-gains-compared-to-the-previous-time.-To-model-this" title="Permalink"></a></h1><p>#, we break the gain phase prior into two parts. The first is the prior</p><h1 id="for-the-first-observing-timestamp-of-each-site,-distphase0,-and-the-second-is-the"><a class="docs-heading-anchor" href="#for-the-first-observing-timestamp-of-each-site,-distphase0,-and-the-second-is-the">for the first observing timestamp of each site, <code>distphase0</code>, and the second is the</a><a id="for-the-first-observing-timestamp-of-each-site,-distphase0,-and-the-second-is-the-1"></a><a class="docs-heading-anchor-permalink" href="#for-the-first-observing-timestamp-of-each-site,-distphase0,-and-the-second-is-the" title="Permalink"></a></h1><h1 id="prior-for-segmented-gain-ϵₜ-from-time-i-to-i1,-given-by-distphase.-For-the-EHT,-we-are"><a class="docs-heading-anchor" href="#prior-for-segmented-gain-ϵₜ-from-time-i-to-i1,-given-by-distphase.-For-the-EHT,-we-are">prior for segmented gain ϵₜ from time i to i+1, given by <code>distphase</code>. For the EHT, we are</a><a id="prior-for-segmented-gain-ϵₜ-from-time-i-to-i1,-given-by-distphase.-For-the-EHT,-we-are-1"></a><a class="docs-heading-anchor-permalink" href="#prior-for-segmented-gain-ϵₜ-from-time-i-to-i1,-given-by-distphase.-For-the-EHT,-we-are" title="Permalink"></a></h1><h1 id="dealing-with-pre-calibrated-data,-so-often,-the-gain-phase-jumps-from-scan-to-scan-are"><a class="docs-heading-anchor" href="#dealing-with-pre-calibrated-data,-so-often,-the-gain-phase-jumps-from-scan-to-scan-are">dealing with pre-calibrated data, so often, the gain phase jumps from scan to scan are</a><a id="dealing-with-pre-calibrated-data,-so-often,-the-gain-phase-jumps-from-scan-to-scan-are-1"></a><a class="docs-heading-anchor-permalink" href="#dealing-with-pre-calibrated-data,-so-often,-the-gain-phase-jumps-from-scan-to-scan-are" title="Permalink"></a></h1><h1 id="minor.-As-such,-we-can-put-a-more-informative-prior-on-distphase."><a class="docs-heading-anchor" href="#minor.-As-such,-we-can-put-a-more-informative-prior-on-distphase.">minor. As such, we can put a more informative prior on <code>distphase</code>.</a><a id="minor.-As-such,-we-can-put-a-more-informative-prior-on-distphase.-1"></a><a class="docs-heading-anchor-permalink" href="#minor.-As-such,-we-can-put-a-more-informative-prior-on-distphase." title="Permalink"></a></h1><h1 id="!!!-warning"><a class="docs-heading-anchor" href="#!!!-warning">!!! warning</a><a id="!!!-warning-1"></a><a class="docs-heading-anchor-permalink" href="#!!!-warning" title="Permalink"></a></h1><h1 id="We-use-AA-(ALMA)-as-a-reference-station-so-we-do-not-have-to-specify-a-gain-prior-for-it."><a class="docs-heading-anchor" href="#We-use-AA-(ALMA)-as-a-reference-station-so-we-do-not-have-to-specify-a-gain-prior-for-it.">We use AA (ALMA) as a reference station so we do not have to specify a gain prior for it.</a><a id="We-use-AA-(ALMA)-as-a-reference-station-so-we-do-not-have-to-specify-a-gain-prior-for-it.-1"></a><a class="docs-heading-anchor-permalink" href="#We-use-AA-(ALMA)-as-a-reference-station-so-we-do-not-have-to-specify-a-gain-prior-for-it." title="Permalink"></a></h1><p>#- distphase = station_tuple(dvis, DiagonalVonMises(0.0, inv(π^2)))</p><h1 id="Finally-we-can-put-form-the-total-model-prior"><a class="docs-heading-anchor" href="#Finally-we-can-put-form-the-total-model-prior">Finally we can put form the total model prior</a><a id="Finally-we-can-put-form-the-total-model-prior-1"></a><a class="docs-heading-anchor-permalink" href="#Finally-we-can-put-form-the-total-model-prior" title="Permalink"></a></h1><p>prior = NamedDist(           c  = cprior,           ## We use a strong smoothing prior since we want to limit the amount of high-frequency structure in the raster.           σimg = truncated(Normal(0.0, 0.1); lower=0.01),           f  = Uniform(0.0, 1.0),           r  = Uniform(μas2rad(10.0), μas2rad(30.0)),           σ  = Uniform(μas2rad(0.1), μas2rad(10.0)),           τ  = truncated(Normal(0.0, 0.1); lower=0.0, upper=1.0),           ξτ = Uniform(-π/2, π/2),           ma = ntuple(<em>-&gt;Uniform(0.0, 0.5), 2),           mp = ntuple(</em>-&gt;Uniform(0.0, 2π), 2),           fg = Uniform(0.0, 1.0),           lgamp = CalPrior(distamp, gcache),           gphase = CalPrior(distphase, gcachep),         )</p><h1 id="This-is-everything-we-need-to-specify-our-posterior-distribution,-which-our-is-the-main"><a class="docs-heading-anchor" href="#This-is-everything-we-need-to-specify-our-posterior-distribution,-which-our-is-the-main">This is everything we need to specify our posterior distribution, which our is the main</a><a id="This-is-everything-we-need-to-specify-our-posterior-distribution,-which-our-is-the-main-1"></a><a class="docs-heading-anchor-permalink" href="#This-is-everything-we-need-to-specify-our-posterior-distribution,-which-our-is-the-main" title="Permalink"></a></h1><h1 id="object-of-interest-in-image-reconstructions-when-using-Bayesian-inference."><a class="docs-heading-anchor" href="#object-of-interest-in-image-reconstructions-when-using-Bayesian-inference.">object of interest in image reconstructions when using Bayesian inference.</a><a id="object-of-interest-in-image-reconstructions-when-using-Bayesian-inference.-1"></a><a class="docs-heading-anchor-permalink" href="#object-of-interest-in-image-reconstructions-when-using-Bayesian-inference." title="Permalink"></a></h1><p>post = Posterior(lklhd, prior)</p><h1 id="To-sample-from-our-prior-we-can-do"><a class="docs-heading-anchor" href="#To-sample-from-our-prior-we-can-do">To sample from our prior we can do</a><a id="To-sample-from-our-prior-we-can-do-1"></a><a class="docs-heading-anchor-permalink" href="#To-sample-from-our-prior-we-can-do" title="Permalink"></a></h1><p>xrand = prior_sample(rng, post)</p><h1 id="and-then-plot-the-results"><a class="docs-heading-anchor" href="#and-then-plot-the-results">and then plot the results</a><a id="and-then-plot-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#and-then-plot-the-results" title="Permalink"></a></h1><p>import CairoMakie as CM CM.activate!(type = &quot;png&quot;, px<em>per</em>unit=3) #hide g = imagepixels(μas2rad(150.0), μas2rad(150.0), 128, 128) #imageviz(intensitymap(skymodel(post, xrand), g), size=(400, 400))</p><h1 id="-Reconstructing-the-Image"><a class="docs-heading-anchor" href="###-Reconstructing-the-Image">## Reconstructing the Image</a><a id="-Reconstructing-the-Image-1"></a><a class="docs-heading-anchor-permalink" href="###-Reconstructing-the-Image" title="Permalink"></a></h1><h1 id="To-sample-from-this-posterior,-it-is-convenient-to-first-move-from-our-constrained-parameter-space"><a class="docs-heading-anchor" href="#To-sample-from-this-posterior,-it-is-convenient-to-first-move-from-our-constrained-parameter-space">To sample from this posterior, it is convenient to first move from our constrained parameter space</a><a id="To-sample-from-this-posterior,-it-is-convenient-to-first-move-from-our-constrained-parameter-space-1"></a><a class="docs-heading-anchor-permalink" href="#To-sample-from-this-posterior,-it-is-convenient-to-first-move-from-our-constrained-parameter-space" title="Permalink"></a></h1><h1 id="to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is"><a class="docs-heading-anchor" href="#to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is">to an unconstrained one (i.e., the support of the transformed posterior is (-∞, ∞)). This is</a><a id="to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is-1"></a><a class="docs-heading-anchor-permalink" href="#to-an-unconstrained-one-(i.e.,-the-support-of-the-transformed-posterior-is-(-,-)).-This-is" title="Permalink"></a></h1><h1 id="done-using-the-asflat-function."><a class="docs-heading-anchor" href="#done-using-the-asflat-function.">done using the <code>asflat</code> function.</a><a id="done-using-the-asflat-function.-1"></a><a class="docs-heading-anchor-permalink" href="#done-using-the-asflat-function." title="Permalink"></a></h1><p>tpost = asflat(post)</p><h1 id="We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-will-sample."><a class="docs-heading-anchor" href="#We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-will-sample.">We can now also find the dimension of our posterior or the number of parameters we will sample.</a><a id="We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-will-sample.-1"></a><a class="docs-heading-anchor-permalink" href="#We-can-now-also-find-the-dimension-of-our-posterior-or-the-number-of-parameters-we-will-sample." title="Permalink"></a></h1><h1 id="!!!-warning-2"><a class="docs-heading-anchor" href="#!!!-warning-2">!!! warning</a><a class="docs-heading-anchor-permalink" href="#!!!-warning-2" title="Permalink"></a></h1><h1 id="This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using"><a class="docs-heading-anchor" href="#This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using">This can often be different from what you would expect. This is especially true when using</a><a id="This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using-1"></a><a class="docs-heading-anchor-permalink" href="#This-can-often-be-different-from-what-you-would-expect.-This-is-especially-true-when-using" title="Permalink"></a></h1><h1 id="angular-variables,-where-we-often-artificially-increase-the-dimension"><a class="docs-heading-anchor" href="#angular-variables,-where-we-often-artificially-increase-the-dimension">angular variables, where we often artificially increase the dimension</a><a id="angular-variables,-where-we-often-artificially-increase-the-dimension-1"></a><a class="docs-heading-anchor-permalink" href="#angular-variables,-where-we-often-artificially-increase-the-dimension" title="Permalink"></a></h1><h1 id="of-the-parameter-space-to-make-sampling-easier."><a class="docs-heading-anchor" href="#of-the-parameter-space-to-make-sampling-easier.">of the parameter space to make sampling easier.</a><a id="of-the-parameter-space-to-make-sampling-easier.-1"></a><a class="docs-heading-anchor-permalink" href="#of-the-parameter-space-to-make-sampling-easier." title="Permalink"></a></h1><p>#- ndim = dimension(tpost)</p><h1 id="Now-we-optimize-using-LBFGS"><a class="docs-heading-anchor" href="#Now-we-optimize-using-LBFGS">Now we optimize using LBFGS</a><a id="Now-we-optimize-using-LBFGS-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-optimize-using-LBFGS" title="Permalink"></a></h1><p>using ComradeOptimization using OptimizationOptimJL using Zygote f = OptimizationFunction(tpost, Optimization.AutoZygote()) prob = Optimization.OptimizationProblem(f, prior<em>sample(rng, tpost), nothing) sol = solve(prob, LBFGS(); maxiters=2000, g</em>tol=1e-0);</p><h1 id="Before-we-analyze-our-solution-we-first-need-to-transform-back-to-parameter-space."><a class="docs-heading-anchor" href="#Before-we-analyze-our-solution-we-first-need-to-transform-back-to-parameter-space.">Before we analyze our solution we first need to transform back to parameter space.</a><a id="Before-we-analyze-our-solution-we-first-need-to-transform-back-to-parameter-space.-1"></a><a class="docs-heading-anchor-permalink" href="#Before-we-analyze-our-solution-we-first-need-to-transform-back-to-parameter-space." title="Permalink"></a></h1><p>xopt = transform(tpost, sol)</p><h1 id="First-we-will-evaluate-our-fit-by-plotting-the-residuals"><a class="docs-heading-anchor" href="#First-we-will-evaluate-our-fit-by-plotting-the-residuals">First we will evaluate our fit by plotting the residuals</a><a id="First-we-will-evaluate-our-fit-by-plotting-the-residuals-1"></a><a class="docs-heading-anchor-permalink" href="#First-we-will-evaluate-our-fit-by-plotting-the-residuals" title="Permalink"></a></h1><p>using Plots residual(vlbimodel(post, xopt), dvis, ylabel=&quot;Correlated Flux Residual&quot;)</p><h1 id="and-now-closure-phases"><a class="docs-heading-anchor" href="#and-now-closure-phases">and now closure phases</a><a id="and-now-closure-phases-1"></a><a class="docs-heading-anchor-permalink" href="#and-now-closure-phases" title="Permalink"></a></h1><p>#-</p><h1 id="Now-these-residuals-look-a-bit-high.-However,-it-turns-out-this-is-because-the-MAP-is-typically"><a class="docs-heading-anchor" href="#Now-these-residuals-look-a-bit-high.-However,-it-turns-out-this-is-because-the-MAP-is-typically">Now these residuals look a bit high. However, it turns out this is because the MAP is typically</a><a id="Now-these-residuals-look-a-bit-high.-However,-it-turns-out-this-is-because-the-MAP-is-typically-1"></a><a class="docs-heading-anchor-permalink" href="#Now-these-residuals-look-a-bit-high.-However,-it-turns-out-this-is-because-the-MAP-is-typically" title="Permalink"></a></h1><h1 id="not-a-great-estimator-and-will-not-provide-very-predictive-measurements-of-the-data.-We"><a class="docs-heading-anchor" href="#not-a-great-estimator-and-will-not-provide-very-predictive-measurements-of-the-data.-We">not a great estimator and will not provide very predictive measurements of the data. We</a><a id="not-a-great-estimator-and-will-not-provide-very-predictive-measurements-of-the-data.-We-1"></a><a class="docs-heading-anchor-permalink" href="#not-a-great-estimator-and-will-not-provide-very-predictive-measurements-of-the-data.-We" title="Permalink"></a></h1><h1 id="will-show-this-below-after-sampling-from-the-posterior."><a class="docs-heading-anchor" href="#will-show-this-below-after-sampling-from-the-posterior.">will show this below after sampling from the posterior.</a><a id="will-show-this-below-after-sampling-from-the-posterior.-1"></a><a class="docs-heading-anchor-permalink" href="#will-show-this-below-after-sampling-from-the-posterior." title="Permalink"></a></h1><h1 id="CM.image(g,-skymodel(post,-xopt),-axis(aspect1,-xreversedtrue,-title&quot;MAP&quot;),-colormap:afmhot,-figure(;resolution(400,-400),))"><a class="docs-heading-anchor" href="#CM.image(g,-skymodel(post,-xopt),-axis(aspect1,-xreversedtrue,-title&quot;MAP&quot;),-colormap:afmhot,-figure(;resolution(400,-400),))">CM.image(g, skymodel(post, xopt), axis=(aspect=1, xreversed=true, title=&quot;MAP&quot;), colormap=:afmhot, figure=(;resolution=(400, 400),))</a><a id="CM.image(g,-skymodel(post,-xopt),-axis(aspect1,-xreversedtrue,-title&quot;MAP&quot;),-colormap:afmhot,-figure(;resolution(400,-400),))-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image(g,-skymodel(post,-xopt),-axis(aspect1,-xreversedtrue,-title&quot;MAP&quot;),-colormap:afmhot,-figure(;resolution(400,-400),))" title="Permalink"></a></h1><h1 id="We-will-now-move-directly-to-sampling-at-this-point."><a class="docs-heading-anchor" href="#We-will-now-move-directly-to-sampling-at-this-point.">We will now move directly to sampling at this point.</a><a id="We-will-now-move-directly-to-sampling-at-this-point.-1"></a><a class="docs-heading-anchor-permalink" href="#We-will-now-move-directly-to-sampling-at-this-point." title="Permalink"></a></h1><p>using ComradeAHMC metric = DiagEuclideanMetric(ndim) chain, stats = sample(rng, post, AHMC(;metric, autodiff=Val(:Zygote)), 700; n<em>adapts=500, initial</em>params=xopt, progress=false)</p><h1 id="We-then-remove-the-adaptation/warmup-phase-from-our-chain"><a class="docs-heading-anchor" href="#We-then-remove-the-adaptation/warmup-phase-from-our-chain">We then remove the adaptation/warmup phase from our chain</a><a id="We-then-remove-the-adaptation/warmup-phase-from-our-chain-1"></a><a class="docs-heading-anchor-permalink" href="#We-then-remove-the-adaptation/warmup-phase-from-our-chain" title="Permalink"></a></h1><p>chain = chain[501:end] stats = stats[501:end]</p><h1 id="!!!-warning-3"><a class="docs-heading-anchor" href="#!!!-warning-3">!!! warning</a><a class="docs-heading-anchor-permalink" href="#!!!-warning-3" title="Permalink"></a></h1><h1 id="This-should-be-run-for-2-3x-more-steps-to-properly-estimate-expectations-of-the-posterior"><a class="docs-heading-anchor" href="#This-should-be-run-for-2-3x-more-steps-to-properly-estimate-expectations-of-the-posterior">This should be run for 2-3x more steps to properly estimate expectations of the posterior</a><a id="This-should-be-run-for-2-3x-more-steps-to-properly-estimate-expectations-of-the-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#This-should-be-run-for-2-3x-more-steps-to-properly-estimate-expectations-of-the-posterior" title="Permalink"></a></h1><p>#-</p><h1 id="Now-lets-plot-the-mean-image-and-standard-deviation-images."><a class="docs-heading-anchor" href="#Now-lets-plot-the-mean-image-and-standard-deviation-images.">Now lets plot the mean image and standard deviation images.</a><a id="Now-lets-plot-the-mean-image-and-standard-deviation-images.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-lets-plot-the-mean-image-and-standard-deviation-images." title="Permalink"></a></h1><h1 id="To-do-this-we-first-clip-the-first-250-MCMC-steps-since-that-is-during-tuning-and"><a class="docs-heading-anchor" href="#To-do-this-we-first-clip-the-first-250-MCMC-steps-since-that-is-during-tuning-and">To do this we first clip the first 250 MCMC steps since that is during tuning and</a><a id="To-do-this-we-first-clip-the-first-250-MCMC-steps-since-that-is-during-tuning-and-1"></a><a class="docs-heading-anchor-permalink" href="#To-do-this-we-first-clip-the-first-250-MCMC-steps-since-that-is-during-tuning-and" title="Permalink"></a></h1><h1 id="so-the-posterior-is-not-sampling-from-the-correct-stationary-distribution."><a class="docs-heading-anchor" href="#so-the-posterior-is-not-sampling-from-the-correct-stationary-distribution.">so the posterior is not sampling from the correct stationary distribution.</a><a id="so-the-posterior-is-not-sampling-from-the-correct-stationary-distribution.-1"></a><a class="docs-heading-anchor-permalink" href="#so-the-posterior-is-not-sampling-from-the-correct-stationary-distribution." title="Permalink"></a></h1><p>using StatsBase msamples = skymodel.(Ref(post), chain[begin:2:end]);</p><h1 id="The-mean-image-is-then-given-by"><a class="docs-heading-anchor" href="#The-mean-image-is-then-given-by">The mean image is then given by</a><a id="The-mean-image-is-then-given-by-1"></a><a class="docs-heading-anchor-permalink" href="#The-mean-image-is-then-given-by" title="Permalink"></a></h1><p>imgs = intensitymap.(msamples, fovxy, fovxy, 128, 128) #imageviz(mean(imgs), colormap=:afmhot, size=(400, 400)) #- #imageviz(std(imgs), colormap=:batlow, size=(400, 400)) #-</p><h1 id><a class="docs-heading-anchor" href="#"></a><a id="-1"></a><a class="docs-heading-anchor-permalink" href="#" title="Permalink"></a></h1><h1 id="We-can-also-split-up-the-model-into-its-components-and-analyze-each-separately"><a class="docs-heading-anchor" href="#We-can-also-split-up-the-model-into-its-components-and-analyze-each-separately">We can also split up the model into its components and analyze each separately</a><a id="We-can-also-split-up-the-model-into-its-components-and-analyze-each-separately-1"></a><a class="docs-heading-anchor-permalink" href="#We-can-also-split-up-the-model-into-its-components-and-analyze-each-separately" title="Permalink"></a></h1><p>comp = Comrade.components.(msamples) ring<em>samples = getindex.(comp, 2) rast</em>samples = first.(comp) ring<em>imgs = intensitymap.(ring</em>samples, fovxy, fovxy, 128, 128) rast<em>imgs = intensitymap.(rast</em>samples, fovxy, fovxy, 128, 128)</p><p>ring<em>mean, ring</em>std = mean<em>and</em>std(ring<em>imgs) rast</em>mean, rast<em>std = mean</em>and<em>std(rast</em>imgs)</p><h1 id="fig-CM.Figure(;-resolution(400,-400));"><a class="docs-heading-anchor" href="#fig-CM.Figure(;-resolution(400,-400));">fig = CM.Figure(; resolution=(400, 400));</a><a id="fig-CM.Figure(;-resolution(400,-400));-1"></a><a class="docs-heading-anchor-permalink" href="#fig-CM.Figure(;-resolution(400,-400));" title="Permalink"></a></h1><h1 id="axes-[CM.Axis(fig[i,-j],-xreversedtrue,-aspectCM.DataAspect())-for-i-in-1:2,-j-in-1:2]"><a class="docs-heading-anchor" href="#axes-[CM.Axis(fig[i,-j],-xreversedtrue,-aspectCM.DataAspect())-for-i-in-1:2,-j-in-1:2]">axes = [CM.Axis(fig[i, j], xreversed=true, aspect=CM.DataAspect()) for i in 1:2, j in 1:2]</a><a id="axes-[CM.Axis(fig[i,-j],-xreversedtrue,-aspectCM.DataAspect())-for-i-in-1:2,-j-in-1:2]-1"></a><a class="docs-heading-anchor-permalink" href="#axes-[CM.Axis(fig[i,-j],-xreversedtrue,-aspectCM.DataAspect())-for-i-in-1:2,-j-in-1:2]" title="Permalink"></a></h1><h1 id="CM.image!(axes[1,1],-ring_mean,-colormap:afmhot);-axes[1,1].title-&quot;Ring-Mean&quot;"><a class="docs-heading-anchor" href="#CM.image!(axes[1,1],-ring_mean,-colormap:afmhot);-axes[1,1].title-&quot;Ring-Mean&quot;">CM.image!(axes[1,1], ring_mean, colormap=:afmhot); axes[1,1].title = &quot;Ring Mean&quot;</a><a id="CM.image!(axes[1,1],-ring_mean,-colormap:afmhot);-axes[1,1].title-&quot;Ring-Mean&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image!(axes[1,1],-ring_mean,-colormap:afmhot);-axes[1,1].title-&quot;Ring-Mean&quot;" title="Permalink"></a></h1><h1 id="CM.image!(axes[1,2],-ring_std,-colormap:afmhot);-axes[1,2].title-&quot;Ring-Std.-Dev.&quot;"><a class="docs-heading-anchor" href="#CM.image!(axes[1,2],-ring_std,-colormap:afmhot);-axes[1,2].title-&quot;Ring-Std.-Dev.&quot;">CM.image!(axes[1,2], ring_std, colormap=:afmhot); axes[1,2].title = &quot;Ring Std. Dev.&quot;</a><a id="CM.image!(axes[1,2],-ring_std,-colormap:afmhot);-axes[1,2].title-&quot;Ring-Std.-Dev.&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image!(axes[1,2],-ring_std,-colormap:afmhot);-axes[1,2].title-&quot;Ring-Std.-Dev.&quot;" title="Permalink"></a></h1><h1 id="CM.image!(axes[2,1],-rast_mean,-colormap:afmhot);-axes[2,1].title-&quot;Rast-Mean&quot;"><a class="docs-heading-anchor" href="#CM.image!(axes[2,1],-rast_mean,-colormap:afmhot);-axes[2,1].title-&quot;Rast-Mean&quot;">CM.image!(axes[2,1], rast_mean, colormap=:afmhot); axes[2,1].title = &quot;Rast Mean&quot;</a><a id="CM.image!(axes[2,1],-rast_mean,-colormap:afmhot);-axes[2,1].title-&quot;Rast-Mean&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image!(axes[2,1],-rast_mean,-colormap:afmhot);-axes[2,1].title-&quot;Rast-Mean&quot;" title="Permalink"></a></h1><h1 id="CM.image!(axes[2,2],-rast_std,-colormap:afmhot);-axes[2,2].title-&quot;Rast-Std.-Dev.&quot;"><a class="docs-heading-anchor" href="#CM.image!(axes[2,2],-rast_std,-colormap:afmhot);-axes[2,2].title-&quot;Rast-Std.-Dev.&quot;">CM.image!(axes[2,2], rast_std, colormap=:afmhot); axes[2,2].title = &quot;Rast Std. Dev.&quot;</a><a id="CM.image!(axes[2,2],-rast_std,-colormap:afmhot);-axes[2,2].title-&quot;Rast-Std.-Dev.&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#CM.image!(axes[2,2],-rast_std,-colormap:afmhot);-axes[2,2].title-&quot;Rast-Std.-Dev.&quot;" title="Permalink"></a></h1><h1 id="CM.hidedecorations!.(axes)"><a class="docs-heading-anchor" href="#CM.hidedecorations!.(axes)">CM.hidedecorations!.(axes)</a><a id="CM.hidedecorations!.(axes)-1"></a><a class="docs-heading-anchor-permalink" href="#CM.hidedecorations!.(axes)" title="Permalink"></a></h1><h1 id="fig"><a class="docs-heading-anchor" href="#fig">fig</a><a id="fig-1"></a><a class="docs-heading-anchor-permalink" href="#fig" title="Permalink"></a></h1><h1 id="Finally,-let&#39;s-take-a-look-at-some-of-the-ring-parameters"><a class="docs-heading-anchor" href="#Finally,-let&#39;s-take-a-look-at-some-of-the-ring-parameters">Finally, let&#39;s take a look at some of the ring parameters</a><a id="Finally,-let&#39;s-take-a-look-at-some-of-the-ring-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Finally,-let&#39;s-take-a-look-at-some-of-the-ring-parameters" title="Permalink"></a></h1><h1 id="figd-CM.Figure(;resolution(600,-400));"><a class="docs-heading-anchor" href="#figd-CM.Figure(;resolution(600,-400));">figd = CM.Figure(;resolution=(600, 400));</a><a id="figd-CM.Figure(;resolution(600,-400));-1"></a><a class="docs-heading-anchor-permalink" href="#figd-CM.Figure(;resolution(600,-400));" title="Permalink"></a></h1><h1 id="p1-CM.density(figd[1,1],-rad2μas(chain.r)*2,-axis(xlabel&quot;Ring-Diameter-(μas)&quot;,))"><a class="docs-heading-anchor" href="#p1-CM.density(figd[1,1],-rad2μas(chain.r)*2,-axis(xlabel&quot;Ring-Diameter-(μas)&quot;,))">p1 = CM.density(figd[1,1], rad2μas(chain.r)*2, axis=(xlabel=&quot;Ring Diameter (μas)&quot;,))</a><a id="p1-CM.density(figd[1,1],-rad2μas(chain.r)*2,-axis(xlabel&quot;Ring-Diameter-(μas)&quot;,))-1"></a><a class="docs-heading-anchor-permalink" href="#p1-CM.density(figd[1,1],-rad2μas(chain.r)*2,-axis(xlabel&quot;Ring-Diameter-(μas)&quot;,))" title="Permalink"></a></h1><h1 id="p2-CM.density(figd[1,2],-rad2μas(chain.σ)*2*sqrt(2*log(2)),-axis(xlabel&quot;Ring-FWHM-(μas)&quot;,))"><a class="docs-heading-anchor" href="#p2-CM.density(figd[1,2],-rad2μas(chain.σ)*2*sqrt(2*log(2)),-axis(xlabel&quot;Ring-FWHM-(μas)&quot;,))">p2 = CM.density(figd[1,2], rad2μas(chain.σ)<em>2</em>sqrt(2*log(2)), axis=(xlabel=&quot;Ring FWHM (μas)&quot;,))</a><a id="p2-CM.density(figd[1,2],-rad2μas(chain.σ)*2*sqrt(2*log(2)),-axis(xlabel&quot;Ring-FWHM-(μas)&quot;,))-1"></a><a class="docs-heading-anchor-permalink" href="#p2-CM.density(figd[1,2],-rad2μas(chain.σ)*2*sqrt(2*log(2)),-axis(xlabel&quot;Ring-FWHM-(μas)&quot;,))" title="Permalink"></a></h1><h1 id="p3-CM.density(figd[1,3],-rad2deg.(getindex.(chain.mp,-1))-.-360.0,-axis(xlabel-&quot;Ring-PA-(deg)-E-of-N&quot;,))"><a class="docs-heading-anchor" href="#p3-CM.density(figd[1,3],-rad2deg.(getindex.(chain.mp,-1))-.-360.0,-axis(xlabel-&quot;Ring-PA-(deg)-E-of-N&quot;,))">p3 = CM.density(figd[1,3], -rad2deg.(getindex.(chain.mp, 1)) .+ 360.0, axis=(xlabel = &quot;Ring PA (deg) E of N&quot;,))</a><a id="p3-CM.density(figd[1,3],-rad2deg.(getindex.(chain.mp,-1))-.-360.0,-axis(xlabel-&quot;Ring-PA-(deg)-E-of-N&quot;,))-1"></a><a class="docs-heading-anchor-permalink" href="#p3-CM.density(figd[1,3],-rad2deg.(getindex.(chain.mp,-1))-.-360.0,-axis(xlabel-&quot;Ring-PA-(deg)-E-of-N&quot;,))" title="Permalink"></a></h1><h1 id="p4-CM.density(figd[2,1],-2*getindex.(chain.ma,-2),-axis(xlabel&quot;Brightness-asymmetry&quot;,))"><a class="docs-heading-anchor" href="#p4-CM.density(figd[2,1],-2*getindex.(chain.ma,-2),-axis(xlabel&quot;Brightness-asymmetry&quot;,))">p4 = CM.density(figd[2,1], 2*getindex.(chain.ma, 2), axis=(xlabel=&quot;Brightness asymmetry&quot;,))</a><a id="p4-CM.density(figd[2,1],-2*getindex.(chain.ma,-2),-axis(xlabel&quot;Brightness-asymmetry&quot;,))-1"></a><a class="docs-heading-anchor-permalink" href="#p4-CM.density(figd[2,1],-2*getindex.(chain.ma,-2),-axis(xlabel&quot;Brightness-asymmetry&quot;,))" title="Permalink"></a></h1><h1 id="p5-CM.density(figd[2,2],-1-.-chain.f,-axis(xlabel&quot;Ring-flux-fraction&quot;,))"><a class="docs-heading-anchor" href="#p5-CM.density(figd[2,2],-1-.-chain.f,-axis(xlabel&quot;Ring-flux-fraction&quot;,))">p5 = CM.density(figd[2,2], 1 .- chain.f, axis=(xlabel=&quot;Ring flux fraction&quot;,))</a><a id="p5-CM.density(figd[2,2],-1-.-chain.f,-axis(xlabel&quot;Ring-flux-fraction&quot;,))-1"></a><a class="docs-heading-anchor-permalink" href="#p5-CM.density(figd[2,2],-1-.-chain.f,-axis(xlabel&quot;Ring-flux-fraction&quot;,))" title="Permalink"></a></h1><h1 id="figd"><a class="docs-heading-anchor" href="#figd">figd</a><a id="figd-1"></a><a class="docs-heading-anchor-permalink" href="#figd" title="Permalink"></a></h1><h1 id="Now-let&#39;s-check-the-residuals-using-draws-from-the-posterior"><a class="docs-heading-anchor" href="#Now-let&#39;s-check-the-residuals-using-draws-from-the-posterior">Now let&#39;s check the residuals using draws from the posterior</a><a id="Now-let&#39;s-check-the-residuals-using-draws-from-the-posterior-1"></a><a class="docs-heading-anchor-permalink" href="#Now-let&#39;s-check-the-residuals-using-draws-from-the-posterior" title="Permalink"></a></h1><p>p = Plots.plot(); for s in sample(chain, 10)     residual!(p, vlbimodel(post, s), dvis) end p</p><h1 id="And-everything-looks-pretty-good!-Now-comes-the-hard-part:-interpreting-the-results..."><a class="docs-heading-anchor" href="#And-everything-looks-pretty-good!-Now-comes-the-hard-part:-interpreting-the-results...">And everything looks pretty good! Now comes the hard part: interpreting the results...</a><a id="And-everything-looks-pretty-good!-Now-comes-the-hard-part:-interpreting-the-results...-1"></a><a class="docs-heading-anchor-permalink" href="#And-everything-looks-pretty-good!-Now-comes-the-hard-part:-interpreting-the-results..." title="Permalink"></a></h1><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../GeometricModeling/">« Geometric Modeling of EHT Data</a><a class="docs-footer-nextpage" href="../LoadingData/">Loading Data into Comrade »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 23 January 2024 17:08">Tuesday 23 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
